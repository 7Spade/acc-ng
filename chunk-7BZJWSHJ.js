import{a as Bh,b as qh,c as Uh,d as jh,e as Kt,f as $h,g as Gh,k as Kh,p as Qh}from"./chunk-QB3BZJ2K.js";import{E as ne,F as Vh,G as re,H as kh,K as zh,L as Fh,M as Oh,N as Mh,P as Lh,R as Hr,e as bh,h as Ta,i as Ah,j as Sh,k as xh,l as Dh,r as Rh,v as Ph,y as Nh}from"./chunk-VAGS5EVQ.js";import{d as ns}from"./chunk-LTOHUVYO.js";import{Ba as Vn,Ca as id,Da as sd,G as ls,H as hs,I as Xr,Ia as Ve,J as Yr,Ja as ke,Ka as ze,La as fs,Ma as gs,Na as ys,Oa as _s,Pa as vs,a as Wh,da as Dn,e as rs,ea as Rn,f as ie,fa as Pn,g as xn,h as is,ja as Yh,l as Hh,la as Jh,lb as od,m as ss,ma as Zh,mb as ad,na as td,o as os,oa as ed,pa as nd,qa as rd,r as as,ta as ds,v as cs,va as ms,w as Xh,wa as ps,x as us,xa as Nn}from"./chunk-R2TQUHLO.js";import{$ as De,$b as lh,Ac as Tn,Bb as Re,Bc as ph,Be as In,Cb as Pe,Db as Ne,Ea as D,Gc as Zi,Hb as wn,Hd as fe,Ia as sh,Ib as Xi,Ic as fh,Jb as fa,Ka as oh,La as Y,Ma as Kr,Mb as R,Na as da,Nb as Wr,O as rh,Ob as Mt,Oc as gh,Pc as Z,Pd as yh,Ra as Yt,Rg as es,Ta as St,Td as _h,U as la,Ua as Qr,Wa as ah,a as th,aa as $r,ab as qt,ac as hh,ba as Je,c as eh,cb as Ut,da as Q,dg as _a,dh as Ih,e as nh,ea as ih,ec as dh,eg as va,eh as Ch,fg as Ea,gg as wa,gi as Fe,hb as F,hc as mh,hi as Oe,ia as Et,ib as z,ic as Yi,ja as wt,jb as O,kb as ot,lb as et,lg as wh,ma as Ki,mb as nt,mg as Th,n as En,na as Qi,ng as Cn,o as Xt,oa as Wi,ob as ma,pb as pa,pe as ga,r as Ye,ra as Gr,rb as Gt,re as vh,ta as ha,td as ts,tg as bn,ub as ct,va as Hi,vg as An,w as ee,we as ya,wg as Sn,xb as ut,yb as ch,zb as uh,zc as Ji,ze as Eh}from"./chunk-GG7EQGVV.js";import{a as vn,b as ca,g as ua,i as V}from"./chunk-57BLH6QZ.js";var Ia=class{_document;_textarea;constructor(t,e){this._document=e;let r=this._textarea=this._document.createElement("textarea"),s=r.style;s.position="fixed",s.top=s.opacity="0",s.left="-999em",r.setAttribute("aria-hidden","true"),r.value=t,r.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(r)}copy(){let t=this._textarea,e=!1;try{if(t){let r=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),e=this._document.execCommand("copy"),r&&r.focus()}}catch{}return e}destroy(){let t=this._textarea;t&&(t.remove(),this._textarea=void 0)}},cd=(()=>{class n{_document=Q(Qi);constructor(){}copy(e){let r=this.beginCopy(e),s=r.copy();return r.destroy(),s}beginCopy(e){return new Ia(e,this._document)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=De({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Ca=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275dir=da({type:n,selectors:[["button","nz-trans-button",""]],hostVars:8,hostBindings:function(r,s){r&2&&Xi("border","0")("background","transparent")("padding","0")("line-height","inherit")}})}return n})(),ba=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=Kr({type:n});static \u0275inj=$r({})}return n})();function qf(n,t){if(n&1&&(ma(0),ot(1,"nz-icon",2),pa()),n&2){let e=t.$implicit;D(),F("nzType",e)}}var Uf=["textarea"];function jf(n,t){if(n&1){let e=Gt();z(0,"textarea",2,0),ct("blur",function(){Et(e);let s=ut();return wt(s.confirm())}),O(),z(2,"button",3),ct("click",function(){Et(e);let s=ut();return wt(s.confirm())}),ot(3,"nz-icon",4),O()}}function $f(n,t){if(n&1&&(ma(0),ot(1,"nz-icon",7),pa()),n&2){let e=t.$implicit;D(),F("nzType",e)}}function Gf(n,t){if(n&1){let e=Gt();z(0,"button",5),ct("click",function(){Et(e);let s=ut();return wt(s.onClick())}),Yt(1,$f,2,1,"ng-container",6),O()}if(n&2){let e=ut();F("nzTooltipTitle",e.tooltip===null?null:e.tooltip||(e.locale==null?null:e.locale.edit)),D(),F("nzStringTemplateOutlet",e.icon)}}var Kf=["ellipsisContainer"],Qf=["expandable"],Wf=["contentTemplate"],Hf=["*"],Xf=n=>({content:n});function Yf(n,t){n&1&&uh(0)}function Jf(n,t){if(n&1&&(qt(0,Yf,1,0),R(1)),n&2){let e=t.content;Ut(e?-1:0),D(),Mt(" ",e," ")}}function Zf(n,t){}function tg(n,t){if(n&1&&R(0),n&2){let e=ut(3);Mt(" ",e.nzSuffix," ")}}function eg(n,t){if(n&1&&(Yt(0,Zf,0,0,"ng-template",5),qt(1,tg,1,1)),n&2){let e=ut(2),r=wn(1);F("ngTemplateOutlet",r)("ngTemplateOutletContext",hh(3,Xf,e.nzContent)),D(),Ut(e.nzSuffix?1:-1)}}function ng(n,t){if(n&1&&R(0),n&2){let e=ut(3);Mt(" ",e.ellipsisStr," ")}}function rg(n,t){if(n&1&&R(0),n&2){let e=ut(3);Mt(" ",e.nzSuffix," ")}}function ig(n,t){if(n&1){let e=Gt();z(0,"a",7,2),ct("click",function(){Et(e);let s=ut(3);return wt(s.onExpand())}),R(2),O()}if(n&2){let e=ut(3);D(2),Mt(" ",e.locale==null?null:e.locale.expand," ")}}function sg(n,t){if(n&1&&(ot(0,"span",null,1),qt(2,ng,1,1),qt(3,rg,1,1),qt(4,ig,3,1,"a",6)),n&2){let e=ut(2);D(2),Ut(e.isEllipsis?2:-1),D(),Ut(e.nzSuffix?3:-1),D(),Ut(e.nzExpandable&&e.isEllipsis?4:-1)}}function og(n,t){if(n&1&&qt(0,eg,2,5)(1,sg,5,3),n&2){let e=ut();Ut(e.expanded||!e.hasOperationsWithEllipsis&&e.nzEllipsisRows===1&&!e.hasEllipsisObservers||e.canCssEllipsis||e.nzSuffix&&e.expanded?0:1)}}function ag(n,t){if(n&1){let e=Gt();z(0,"nz-text-edit",8),ct("endEditing",function(s){Et(e);let o=ut();return wt(o.onEndEditing(s))})("startEditing",function(){Et(e);let s=ut();return wt(s.onStartEditing())}),O()}if(n&2){let e=ut();F("text",e.nzContent)("icon",e.nzEditIcon)("tooltip",e.nzEditTooltip)}}function cg(n,t){if(n&1){let e=Gt();z(0,"nz-text-copy",9),ct("textCopy",function(s){Et(e);let o=ut();return wt(o.onTextCopy(s))}),O()}if(n&2){let e=ut();F("text",e.copyText)("tooltips",e.nzCopyTooltips)("icons",e.nzCopyIcons)}}var Aa=(()=>{class n{cdr=Q(Ji);clipboard=Q(cd);i18n=Q(es);destroyRef=Q(Wi);copied=!1;copyId;locale;nativeElement=Q(Hi).nativeElement;copyTooltip=null;copedTooltip=null;copyIcon="copy";copedIcon="check";text;tooltips;icons=["copy","check"];textCopy=new St;constructor(){this.destroyRef.onDestroy(()=>{clearTimeout(this.copyId)})}ngOnInit(){this.i18n.localeChange.pipe(fe(this.destroyRef)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Text"),this.updateTooltips(),this.cdr.markForCheck()})}ngOnChanges(e){let{tooltips:r,icons:s}=e;r&&this.updateTooltips(),s&&this.updateIcons()}onClick(){if(this.copied)return;this.copied=!0,this.cdr.detectChanges();let e=this.text;this.textCopy.emit(e),this.clipboard.copy(e),this.onCopied()}onCopied(){clearTimeout(this.copyId),this.copyId=setTimeout(()=>{this.copied=!1,this.cdr.detectChanges()},3e3)}updateTooltips(){if(this.tooltips===null)this.copedTooltip=null,this.copyTooltip=null;else if(Array.isArray(this.tooltips)){let[e,r]=this.tooltips;this.copyTooltip=e||this.locale?.copy,this.copedTooltip=r||this.locale?.copied}else this.copyTooltip=this.locale?.copy,this.copedTooltip=this.locale?.copied;this.cdr.markForCheck()}updateIcons(){let[e,r]=this.icons;this.copyIcon=e,this.copedIcon=r,this.cdr.markForCheck()}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Y({type:n,selectors:[["nz-text-copy"]],inputs:{text:"text",tooltips:"tooltips",icons:"icons"},outputs:{textCopy:"textCopy"},exportAs:["nzTextCopy"],features:[ha],decls:2,vars:4,consts:[["type","button","nz-tooltip","","nz-trans-button","",1,"ant-typography-copy",3,"click","nzTooltipTitle"],[4,"nzStringTemplateOutlet"],[3,"nzType"]],template:function(r,s){r&1&&(z(0,"button",0),ct("click",function(){return s.onClick()}),Yt(1,qf,2,1,"ng-container",1),O()),r&2&&(fa("ant-typography-copy-success",s.copied),F("nzTooltipTitle",s.copied?s.copedTooltip:s.copyTooltip),D(),F("nzStringTemplateOutlet",s.copied?s.copedIcon:s.copyIcon))},dependencies:[Yr,Xr,ba,Ca,va,_a,wa,Ea],encapsulation:2,changeDetection:0})}return n})(),Sa=(()=>{class n{ngZone=Q(Qr);cdr=Q(Ji);i18n=Q(es);destroyRef=Q(Wi);editing=!1;locale;text;icon="edit";tooltip;startEditing=new St;endEditing=new St(!0);set textarea(e){this.textarea$.next(e)}autosizeDirective;beforeText;currentText;nativeElement=Q(Hi).nativeElement;textarea$=new nh(null);injector=Q(Ki);ngOnInit(){this.i18n.localeChange.pipe(fe(this.destroyRef)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Text"),this.cdr.markForCheck()}),this.textarea$.pipe(la(e=>ya(e?.nativeElement,"keydown")),fe(this.destroyRef)).subscribe(e=>{e.keyCode!==27&&e.keyCode!==13||this.ngZone.run(()=>{e.keyCode===27?this.onCancel():this.onEnter(e),this.cdr.markForCheck()})}),this.textarea$.pipe(la(e=>ya(e?.nativeElement,"input")),fe(this.destroyRef)).subscribe(e=>{this.currentText=e.target.value})}onClick(){this.beforeText=this.text,this.currentText=this.beforeText,this.editing=!0,this.startEditing.emit(),this.focusAndSetValue()}confirm(){this.editing=!1,this.endEditing.emit(this.currentText)}onEnter(e){e.stopPropagation(),e.preventDefault(),this.confirm()}onCancel(){this.currentText=this.beforeText,this.confirm()}focusAndSetValue(){let{injector:e}=this;ah(()=>{this.textarea$.pipe(rh(r=>r!=null),fe(this.destroyRef)).subscribe(r=>{r.nativeElement.focus(),r.nativeElement.value=this.currentText||"",this.autosizeDirective.resizeToFitContent(),this.cdr.markForCheck()})},{injector:e})}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Y({type:n,selectors:[["nz-text-edit"]],viewQuery:function(r,s){if(r&1&&(Re(Uf,5),Re(ps,5)),r&2){let o;Pe(o=Ne())&&(s.textarea=o.first),Pe(o=Ne())&&(s.autosizeDirective=o.first)}},inputs:{text:"text",icon:"icon",tooltip:"tooltip"},outputs:{startEditing:"startEditing",endEditing:"endEditing"},exportAs:["nzTextEdit"],decls:2,vars:1,consts:[["textarea",""],["nz-tooltip","","nz-trans-button","",1,"ant-typography-edit",3,"nzTooltipTitle"],["nz-input","","nzAutosize","",3,"blur"],["nz-trans-button","",1,"ant-typography-edit-content-confirm",3,"click"],["nzType","enter"],["nz-tooltip","","nz-trans-button","",1,"ant-typography-edit",3,"click","nzTooltipTitle"],[4,"nzStringTemplateOutlet"],[3,"nzType"]],template:function(r,s){r&1&&qt(0,jf,4,0)(1,Gf,2,2,"button",1),r&2&&Ut(s.editing?0:1)},dependencies:[Vn,Nn,ps,ba,Ca,va,_a,Yr,Xr,wa,Ea],encapsulation:2,changeDetection:0})}return n})(),ug="typography",lg="ant-typography-expand",Jr=(()=>{var B;let n,t=[],e=[],r,s=[],o=[],c,l=[],h=[],m,f=[],v=[],C,S=[],L=[];return B=class{_nzModuleName=ug;nzConfigService=Q(Eh);el=Q(Hi).nativeElement;cdr=Q(Ji);viewContainerRef=Q(oh);renderer=Q(sh);platform=Q(yh);i18n=Q(es);resizeService=Q(Wh);directionality=Q(_h);document=Q(Qi);destroyRef=Q(Wi);nzCopyable=!1;nzEditable=!1;nzDisabled=!1;nzExpandable=!1;nzEllipsis=!1;nzCopyTooltips=Xt(this,t,void 0);nzCopyIcons=(Xt(this,e),Xt(this,s,["copy","check"]));nzEditTooltip=(Xt(this,o),Xt(this,l,void 0));nzEditIcon=(Xt(this,h),Xt(this,f,"edit"));nzContent=Xt(this,v);nzEllipsisRows=Xt(this,S,1);nzType=Xt(this,L);nzCopyText;nzSuffix;nzContentChange=new St;nzCopy=new St;nzExpandChange=new St;nzOnEllipsis=new St;textEditRef;textCopyRef;ellipsisContainer;expandableBtn;contentTemplate;locale;expandableBtnElementCache=null;editing=!1;ellipsisText;cssEllipsis=!1;isEllipsis=!0;expanded=!1;ellipsisStr="...";dir="ltr";get hasEllipsisObservers(){return this.nzOnEllipsis.observers.length>0}get canCssEllipsis(){return this.nzEllipsis&&this.cssEllipsis&&!this.expanded&&!this.hasEllipsisObservers}get hasOperationsWithEllipsis(){return(this.nzCopyable||this.nzEditable||this.nzExpandable)&&this.nzEllipsis}viewInit=!1;requestId=-1;windowResizeSubscription=th.EMPTY;get copyText(){return typeof this.nzCopyText=="string"?this.nzCopyText:this.nzContent}constructor(){this.destroyRef.onDestroy(()=>{this.expandableBtnElementCache=null,this.windowResizeSubscription.unsubscribe()})}onTextCopy(U){this.nzCopy.emit(U)}onStartEditing(){this.editing=!0}onEndEditing(U){this.editing=!1,this.nzContentChange.emit(U),this.nzContent===U&&this.renderOnNextFrame(),this.cdr.markForCheck()}onExpand(){this.isEllipsis=!1,this.expanded=!0,this.nzExpandChange.emit(),this.nzOnEllipsis.emit(!1)}canUseCSSEllipsis(){return this.nzEditable||this.nzCopyable||this.nzExpandable||this.nzSuffix||this.hasEllipsisObservers?!1:this.nzEllipsisRows===1?ga("textOverflow"):ga("webkitLineClamp")}renderOnNextFrame(){Ch(this.requestId),!(!this.viewInit||!this.nzEllipsis||this.nzEllipsisRows<0||this.expanded||!this.platform.isBrowser)&&(this.requestId=Ih(()=>this.syncEllipsis()))}getOriginContentViewRef(){let U=this.viewContainerRef.createEmbeddedView(this.contentTemplate,{content:this.nzContent});return U.detectChanges(),{viewRef:U,removeView:()=>this.viewContainerRef.remove(this.viewContainerRef.indexOf(U))}}syncEllipsis(){if(this.cssEllipsis)return;let{viewRef:U,removeView:P}=this.getOriginContentViewRef(),N=[this.textCopyRef,this.textEditRef].filter(g=>g&&g.nativeElement).map(g=>g.nativeElement),X=this.getExpandableBtnElement();X&&N.push(X);let{contentNodes:xt,text:st,ellipsis:E}=vh(this.el,this.nzEllipsisRows,U.rootNodes,N,this.ellipsisStr,this.nzSuffix);P(),this.ellipsisText=st,E!==this.isEllipsis&&(this.isEllipsis=E,this.nzOnEllipsis.emit(E));let p=this.ellipsisContainer.nativeElement;for(;p.firstChild;)this.renderer.removeChild(p,p.firstChild);xt.forEach(g=>{this.renderer.appendChild(p,g.cloneNode(!0))}),this.cdr.markForCheck()}getExpandableBtnElement(){if(this.nzExpandable){let U=this.locale?this.locale.expand:"",P=this.expandableBtnElementCache;if(!P||P.innerText===U){let N=this.document.createElement("a");N.className=lg,N.innerText=U,this.expandableBtnElementCache=N}return this.expandableBtnElementCache}else return this.expandableBtnElementCache=null,null}renderAndSubscribeWindowResize(){this.platform.isBrowser&&(this.windowResizeSubscription.unsubscribe(),this.cssEllipsis=this.canUseCSSEllipsis(),this.renderOnNextFrame(),this.windowResizeSubscription=this.resizeService.connect().pipe(fe(this.destroyRef)).subscribe(()=>this.renderOnNextFrame()))}ngOnInit(){this.i18n.localeChange.pipe(fe(this.destroyRef)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Text"),this.cdr.markForCheck()}),this.directionality.change?.pipe(fe(this.destroyRef)).subscribe(U=>{this.dir=U,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngAfterViewInit(){this.viewInit=!0,this.renderAndSubscribeWindowResize()}ngOnChanges(U){let{nzCopyable:P,nzEditable:N,nzExpandable:X,nzEllipsis:xt,nzContent:st,nzEllipsisRows:E,nzSuffix:p}=U;(P||N||X||xt||st||E||p)&&this.nzEllipsis&&(this.expanded?this.windowResizeSubscription.unsubscribe():this.renderAndSubscribeWindowResize())}},(()=>{let U=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;n=[In()],r=[In()],c=[In()],m=[In()],C=[In()],En(null,null,n,{kind:"field",name:"nzCopyTooltips",static:!1,private:!1,access:{has:P=>"nzCopyTooltips"in P,get:P=>P.nzCopyTooltips,set:(P,N)=>{P.nzCopyTooltips=N}},metadata:U},t,e),En(null,null,r,{kind:"field",name:"nzCopyIcons",static:!1,private:!1,access:{has:P=>"nzCopyIcons"in P,get:P=>P.nzCopyIcons,set:(P,N)=>{P.nzCopyIcons=N}},metadata:U},s,o),En(null,null,c,{kind:"field",name:"nzEditTooltip",static:!1,private:!1,access:{has:P=>"nzEditTooltip"in P,get:P=>P.nzEditTooltip,set:(P,N)=>{P.nzEditTooltip=N}},metadata:U},l,h),En(null,null,m,{kind:"field",name:"nzEditIcon",static:!1,private:!1,access:{has:P=>"nzEditIcon"in P,get:P=>P.nzEditIcon,set:(P,N)=>{P.nzEditIcon=N}},metadata:U},f,v),En(null,null,C,{kind:"field",name:"nzEllipsisRows",static:!1,private:!1,access:{has:P=>"nzEllipsisRows"in P,get:P=>P.nzEllipsisRows,set:(P,N)=>{P.nzEllipsisRows=N}},metadata:U},S,L),U&&Object.defineProperty(B,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:U})})(),ua(B,"\u0275fac",function(P){return new(P||B)}),ua(B,"\u0275cmp",Y({type:B,selectors:[["nz-typography"],["","nz-typography",""],["p","nz-paragraph",""],["span","nz-text",""],["h1","nz-title",""],["h2","nz-title",""],["h3","nz-title",""],["h4","nz-title",""]],viewQuery:function(P,N){if(P&1&&(Re(Sa,5),Re(Aa,5),Re(Kf,5),Re(Qf,5),Re(Wf,5)),P&2){let X;Pe(X=Ne())&&(N.textEditRef=X.first),Pe(X=Ne())&&(N.textCopyRef=X.first),Pe(X=Ne())&&(N.ellipsisContainer=X.first),Pe(X=Ne())&&(N.expandableBtn=X.first),Pe(X=Ne())&&(N.contentTemplate=X.first)}},hostVars:26,hostBindings:function(P,N){P&2&&(Xi("-webkit-line-clamp",N.canCssEllipsis&&N.nzEllipsisRows>1?N.nzEllipsisRows:null),fa("ant-typography",!N.editing)("ant-typography-rtl",N.dir==="rtl")("ant-typography-edit-content",N.editing)("ant-typography-secondary",N.nzType==="secondary")("ant-typography-warning",N.nzType==="warning")("ant-typography-danger",N.nzType==="danger")("ant-typography-success",N.nzType==="success")("ant-typography-disabled",N.nzDisabled)("ant-typography-ellipsis",N.nzEllipsis&&!N.expanded)("ant-typography-single-line",N.nzEllipsis&&N.nzEllipsisRows===1)("ant-typography-ellipsis-single-line",N.canCssEllipsis&&N.nzEllipsisRows===1)("ant-typography-ellipsis-multiple-line",N.canCssEllipsis&&N.nzEllipsisRows>1))},inputs:{nzCopyable:[2,"nzCopyable","nzCopyable",Tn],nzEditable:[2,"nzEditable","nzEditable",Tn],nzDisabled:[2,"nzDisabled","nzDisabled",Tn],nzExpandable:[2,"nzExpandable","nzExpandable",Tn],nzEllipsis:[2,"nzEllipsis","nzEllipsis",Tn],nzCopyTooltips:"nzCopyTooltips",nzCopyIcons:"nzCopyIcons",nzEditTooltip:"nzEditTooltip",nzEditIcon:"nzEditIcon",nzContent:"nzContent",nzEllipsisRows:[2,"nzEllipsisRows","nzEllipsisRows",ph],nzType:"nzType",nzCopyText:"nzCopyText",nzSuffix:"nzSuffix"},outputs:{nzContentChange:"nzContentChange",nzCopy:"nzCopy",nzExpandChange:"nzExpandChange",nzOnEllipsis:"nzOnEllipsis"},exportAs:["nzTypography"],features:[ha],ngContentSelectors:Hf,decls:5,vars:3,consts:[["contentTemplate",""],["ellipsisContainer",""],["expandable",""],[3,"text","icon","tooltip"],[3,"text","tooltips","icons"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ant-typography-expand"],[1,"ant-typography-expand",3,"click"],[3,"endEditing","startEditing","text","icon","tooltip"],[3,"textCopy","text","tooltips","icons"]],template:function(P,N){P&1&&(ch(),Yt(0,Jf,2,2,"ng-template",null,0,Yi),qt(2,og,2,1),qt(3,ag,1,3,"nz-text-edit",3),qt(4,cg,1,3,"nz-text-copy",4)),P&2&&(D(2),Ut(N.editing?-1:2),D(),Ut(N.nzEditable?3:-1),D(),Ut(N.nzCopyable&&!N.editing?4:-1))},dependencies:[fh,Sa,Aa],encapsulation:2,changeDetection:0})),B})(),Es=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=Kr({type:n});static \u0275inj=$r({imports:[Jr,Aa,Sa]})}return n})();var hd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},dd={};var ge,xa;(function(){var n;function t(E,p){function g(){}g.prototype=p.prototype,E.D=p.prototype,E.prototype=new g,E.prototype.constructor=E,E.C=function(_,w,I){for(var y=Array(arguments.length-2),de=2;de<arguments.length;de++)y[de-2]=arguments[de];return p.prototype[w].apply(_,y)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,p,g){g||(g=0);var _=Array(16);if(typeof p=="string")for(var w=0;16>w;++w)_[w]=p.charCodeAt(g++)|p.charCodeAt(g++)<<8|p.charCodeAt(g++)<<16|p.charCodeAt(g++)<<24;else for(w=0;16>w;++w)_[w]=p[g++]|p[g++]<<8|p[g++]<<16|p[g++]<<24;p=E.g[0],g=E.g[1],w=E.g[2];var I=E.g[3],y=p+(I^g&(w^I))+_[0]+3614090360&4294967295;p=g+(y<<7&4294967295|y>>>25),y=I+(w^p&(g^w))+_[1]+3905402710&4294967295,I=p+(y<<12&4294967295|y>>>20),y=w+(g^I&(p^g))+_[2]+606105819&4294967295,w=I+(y<<17&4294967295|y>>>15),y=g+(p^w&(I^p))+_[3]+3250441966&4294967295,g=w+(y<<22&4294967295|y>>>10),y=p+(I^g&(w^I))+_[4]+4118548399&4294967295,p=g+(y<<7&4294967295|y>>>25),y=I+(w^p&(g^w))+_[5]+1200080426&4294967295,I=p+(y<<12&4294967295|y>>>20),y=w+(g^I&(p^g))+_[6]+2821735955&4294967295,w=I+(y<<17&4294967295|y>>>15),y=g+(p^w&(I^p))+_[7]+4249261313&4294967295,g=w+(y<<22&4294967295|y>>>10),y=p+(I^g&(w^I))+_[8]+1770035416&4294967295,p=g+(y<<7&4294967295|y>>>25),y=I+(w^p&(g^w))+_[9]+2336552879&4294967295,I=p+(y<<12&4294967295|y>>>20),y=w+(g^I&(p^g))+_[10]+4294925233&4294967295,w=I+(y<<17&4294967295|y>>>15),y=g+(p^w&(I^p))+_[11]+2304563134&4294967295,g=w+(y<<22&4294967295|y>>>10),y=p+(I^g&(w^I))+_[12]+1804603682&4294967295,p=g+(y<<7&4294967295|y>>>25),y=I+(w^p&(g^w))+_[13]+4254626195&4294967295,I=p+(y<<12&4294967295|y>>>20),y=w+(g^I&(p^g))+_[14]+2792965006&4294967295,w=I+(y<<17&4294967295|y>>>15),y=g+(p^w&(I^p))+_[15]+1236535329&4294967295,g=w+(y<<22&4294967295|y>>>10),y=p+(w^I&(g^w))+_[1]+4129170786&4294967295,p=g+(y<<5&4294967295|y>>>27),y=I+(g^w&(p^g))+_[6]+3225465664&4294967295,I=p+(y<<9&4294967295|y>>>23),y=w+(p^g&(I^p))+_[11]+643717713&4294967295,w=I+(y<<14&4294967295|y>>>18),y=g+(I^p&(w^I))+_[0]+3921069994&4294967295,g=w+(y<<20&4294967295|y>>>12),y=p+(w^I&(g^w))+_[5]+3593408605&4294967295,p=g+(y<<5&4294967295|y>>>27),y=I+(g^w&(p^g))+_[10]+38016083&4294967295,I=p+(y<<9&4294967295|y>>>23),y=w+(p^g&(I^p))+_[15]+3634488961&4294967295,w=I+(y<<14&4294967295|y>>>18),y=g+(I^p&(w^I))+_[4]+3889429448&4294967295,g=w+(y<<20&4294967295|y>>>12),y=p+(w^I&(g^w))+_[9]+568446438&4294967295,p=g+(y<<5&4294967295|y>>>27),y=I+(g^w&(p^g))+_[14]+3275163606&4294967295,I=p+(y<<9&4294967295|y>>>23),y=w+(p^g&(I^p))+_[3]+4107603335&4294967295,w=I+(y<<14&4294967295|y>>>18),y=g+(I^p&(w^I))+_[8]+1163531501&4294967295,g=w+(y<<20&4294967295|y>>>12),y=p+(w^I&(g^w))+_[13]+2850285829&4294967295,p=g+(y<<5&4294967295|y>>>27),y=I+(g^w&(p^g))+_[2]+4243563512&4294967295,I=p+(y<<9&4294967295|y>>>23),y=w+(p^g&(I^p))+_[7]+1735328473&4294967295,w=I+(y<<14&4294967295|y>>>18),y=g+(I^p&(w^I))+_[12]+2368359562&4294967295,g=w+(y<<20&4294967295|y>>>12),y=p+(g^w^I)+_[5]+4294588738&4294967295,p=g+(y<<4&4294967295|y>>>28),y=I+(p^g^w)+_[8]+2272392833&4294967295,I=p+(y<<11&4294967295|y>>>21),y=w+(I^p^g)+_[11]+1839030562&4294967295,w=I+(y<<16&4294967295|y>>>16),y=g+(w^I^p)+_[14]+4259657740&4294967295,g=w+(y<<23&4294967295|y>>>9),y=p+(g^w^I)+_[1]+2763975236&4294967295,p=g+(y<<4&4294967295|y>>>28),y=I+(p^g^w)+_[4]+1272893353&4294967295,I=p+(y<<11&4294967295|y>>>21),y=w+(I^p^g)+_[7]+4139469664&4294967295,w=I+(y<<16&4294967295|y>>>16),y=g+(w^I^p)+_[10]+3200236656&4294967295,g=w+(y<<23&4294967295|y>>>9),y=p+(g^w^I)+_[13]+681279174&4294967295,p=g+(y<<4&4294967295|y>>>28),y=I+(p^g^w)+_[0]+3936430074&4294967295,I=p+(y<<11&4294967295|y>>>21),y=w+(I^p^g)+_[3]+3572445317&4294967295,w=I+(y<<16&4294967295|y>>>16),y=g+(w^I^p)+_[6]+76029189&4294967295,g=w+(y<<23&4294967295|y>>>9),y=p+(g^w^I)+_[9]+3654602809&4294967295,p=g+(y<<4&4294967295|y>>>28),y=I+(p^g^w)+_[12]+3873151461&4294967295,I=p+(y<<11&4294967295|y>>>21),y=w+(I^p^g)+_[15]+530742520&4294967295,w=I+(y<<16&4294967295|y>>>16),y=g+(w^I^p)+_[2]+3299628645&4294967295,g=w+(y<<23&4294967295|y>>>9),y=p+(w^(g|~I))+_[0]+4096336452&4294967295,p=g+(y<<6&4294967295|y>>>26),y=I+(g^(p|~w))+_[7]+1126891415&4294967295,I=p+(y<<10&4294967295|y>>>22),y=w+(p^(I|~g))+_[14]+2878612391&4294967295,w=I+(y<<15&4294967295|y>>>17),y=g+(I^(w|~p))+_[5]+4237533241&4294967295,g=w+(y<<21&4294967295|y>>>11),y=p+(w^(g|~I))+_[12]+1700485571&4294967295,p=g+(y<<6&4294967295|y>>>26),y=I+(g^(p|~w))+_[3]+2399980690&4294967295,I=p+(y<<10&4294967295|y>>>22),y=w+(p^(I|~g))+_[10]+4293915773&4294967295,w=I+(y<<15&4294967295|y>>>17),y=g+(I^(w|~p))+_[1]+2240044497&4294967295,g=w+(y<<21&4294967295|y>>>11),y=p+(w^(g|~I))+_[8]+1873313359&4294967295,p=g+(y<<6&4294967295|y>>>26),y=I+(g^(p|~w))+_[15]+4264355552&4294967295,I=p+(y<<10&4294967295|y>>>22),y=w+(p^(I|~g))+_[6]+2734768916&4294967295,w=I+(y<<15&4294967295|y>>>17),y=g+(I^(w|~p))+_[13]+1309151649&4294967295,g=w+(y<<21&4294967295|y>>>11),y=p+(w^(g|~I))+_[4]+4149444226&4294967295,p=g+(y<<6&4294967295|y>>>26),y=I+(g^(p|~w))+_[11]+3174756917&4294967295,I=p+(y<<10&4294967295|y>>>22),y=w+(p^(I|~g))+_[2]+718787259&4294967295,w=I+(y<<15&4294967295|y>>>17),y=g+(I^(w|~p))+_[9]+3951481745&4294967295,E.g[0]=E.g[0]+p&4294967295,E.g[1]=E.g[1]+(w+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+w&4294967295,E.g[3]=E.g[3]+I&4294967295}r.prototype.u=function(E,p){p===void 0&&(p=E.length);for(var g=p-this.blockSize,_=this.B,w=this.h,I=0;I<p;){if(w==0)for(;I<=g;)s(this,E,I),I+=this.blockSize;if(typeof E=="string"){for(;I<p;)if(_[w++]=E.charCodeAt(I++),w==this.blockSize){s(this,_),w=0;break}}else for(;I<p;)if(_[w++]=E[I++],w==this.blockSize){s(this,_),w=0;break}}this.h=w,this.o+=p},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var p=1;p<E.length-8;++p)E[p]=0;var g=8*this.o;for(p=E.length-8;p<E.length;++p)E[p]=g&255,g/=256;for(this.u(E),E=Array(16),p=g=0;4>p;++p)for(var _=0;32>_;_+=8)E[g++]=this.g[p]>>>_&255;return E};function o(E,p){var g=l;return Object.prototype.hasOwnProperty.call(g,E)?g[E]:g[E]=p(E)}function c(E,p){this.h=p;for(var g=[],_=!0,w=E.length-1;0<=w;w--){var I=E[w]|0;_&&I==p||(g[w]=I,_=!1)}this.g=g}var l={};function h(E){return-128<=E&&128>E?o(E,function(p){return new c([p|0],0>p?-1:0)}):new c([E|0],0>E?-1:0)}function m(E){if(isNaN(E)||!isFinite(E))return v;if(0>E)return M(m(-E));for(var p=[],g=1,_=0;E>=g;_++)p[_]=E/g|0,g*=4294967296;return new c(p,0)}function f(E,p){if(E.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(E.charAt(0)=="-")return M(f(E.substring(1),p));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var g=m(Math.pow(p,8)),_=v,w=0;w<E.length;w+=8){var I=Math.min(8,E.length-w),y=parseInt(E.substring(w,w+I),p);8>I?(I=m(Math.pow(p,I)),_=_.j(I).add(m(y))):(_=_.j(g),_=_.add(m(y)))}return _}var v=h(0),C=h(1),S=h(16777216);n=c.prototype,n.m=function(){if(B(this))return-M(this).m();for(var E=0,p=1,g=0;g<this.g.length;g++){var _=this.i(g);E+=(0<=_?_:4294967296+_)*p,p*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(L(this))return"0";if(B(this))return"-"+M(this).toString(E);for(var p=m(Math.pow(E,6)),g=this,_="";;){var w=X(g,p).g;g=U(g,w.j(p));var I=((0<g.g.length?g.g[0]:g.h)>>>0).toString(E);if(g=w,L(g))return I+_;for(;6>I.length;)I="0"+I;_=I+_}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function L(E){if(E.h!=0)return!1;for(var p=0;p<E.g.length;p++)if(E.g[p]!=0)return!1;return!0}function B(E){return E.h==-1}n.l=function(E){return E=U(this,E),B(E)?-1:L(E)?0:1};function M(E){for(var p=E.g.length,g=[],_=0;_<p;_++)g[_]=~E.g[_];return new c(g,~E.h).add(C)}n.abs=function(){return B(this)?M(this):this},n.add=function(E){for(var p=Math.max(this.g.length,E.g.length),g=[],_=0,w=0;w<=p;w++){var I=_+(this.i(w)&65535)+(E.i(w)&65535),y=(I>>>16)+(this.i(w)>>>16)+(E.i(w)>>>16);_=y>>>16,I&=65535,y&=65535,g[w]=y<<16|I}return new c(g,g[g.length-1]&-2147483648?-1:0)};function U(E,p){return E.add(M(p))}n.j=function(E){if(L(this)||L(E))return v;if(B(this))return B(E)?M(this).j(M(E)):M(M(this).j(E));if(B(E))return M(this.j(M(E)));if(0>this.l(S)&&0>E.l(S))return m(this.m()*E.m());for(var p=this.g.length+E.g.length,g=[],_=0;_<2*p;_++)g[_]=0;for(_=0;_<this.g.length;_++)for(var w=0;w<E.g.length;w++){var I=this.i(_)>>>16,y=this.i(_)&65535,de=E.i(w)>>>16,br=E.i(w)&65535;g[2*_+2*w]+=y*br,P(g,2*_+2*w),g[2*_+2*w+1]+=I*br,P(g,2*_+2*w+1),g[2*_+2*w+1]+=y*de,P(g,2*_+2*w+1),g[2*_+2*w+2]+=I*de,P(g,2*_+2*w+2)}for(_=0;_<p;_++)g[_]=g[2*_+1]<<16|g[2*_];for(_=p;_<2*p;_++)g[_]=0;return new c(g,0)};function P(E,p){for(;(E[p]&65535)!=E[p];)E[p+1]+=E[p]>>>16,E[p]&=65535,p++}function N(E,p){this.g=E,this.h=p}function X(E,p){if(L(p))throw Error("division by zero");if(L(E))return new N(v,v);if(B(E))return p=X(M(E),p),new N(M(p.g),M(p.h));if(B(p))return p=X(E,M(p)),new N(M(p.g),p.h);if(30<E.g.length){if(B(E)||B(p))throw Error("slowDivide_ only works with positive integers.");for(var g=C,_=p;0>=_.l(E);)g=xt(g),_=xt(_);var w=st(g,1),I=st(_,1);for(_=st(_,2),g=st(g,2);!L(_);){var y=I.add(_);0>=y.l(E)&&(w=w.add(g),I=y),_=st(_,1),g=st(g,1)}return p=U(E,w.j(p)),new N(w,p)}for(w=v;0<=E.l(p);){for(g=Math.max(1,Math.floor(E.m()/p.m())),_=Math.ceil(Math.log(g)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),I=m(g),y=I.j(p);B(y)||0<y.l(E);)g-=_,I=m(g),y=I.j(p);L(I)&&(I=C),w=w.add(I),E=U(E,y)}return new N(w,E)}n.A=function(E){return X(this,E).h},n.and=function(E){for(var p=Math.max(this.g.length,E.g.length),g=[],_=0;_<p;_++)g[_]=this.i(_)&E.i(_);return new c(g,this.h&E.h)},n.or=function(E){for(var p=Math.max(this.g.length,E.g.length),g=[],_=0;_<p;_++)g[_]=this.i(_)|E.i(_);return new c(g,this.h|E.h)},n.xor=function(E){for(var p=Math.max(this.g.length,E.g.length),g=[],_=0;_<p;_++)g[_]=this.i(_)^E.i(_);return new c(g,this.h^E.h)};function xt(E){for(var p=E.g.length+1,g=[],_=0;_<p;_++)g[_]=E.i(_)<<1|E.i(_-1)>>>31;return new c(g,E.h)}function st(E,p){var g=p>>5;p%=32;for(var _=E.g.length-g,w=[],I=0;I<_;I++)w[I]=0<p?E.i(I+g)>>>p|E.i(I+g+1)<<32-p:E.i(I+g);return new c(w,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,xa=dd.Md5=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=m,c.fromString=f,ge=dd.Integer=c}).apply(typeof hd<"u"?hd:typeof self<"u"?self:typeof window<"u"?window:{});var ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ye={};var Da,hg,kn,Ra,Zr,Ts,Pa,Na,Va;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,u){return i==Array.prototype||i==Object.prototype||(i[a]=u.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof ws=="object"&&ws];for(var a=0;a<i.length;++a){var u=i[a];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=e(this);function s(i,a){if(a)t:{var u=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var T=i[d];if(!(T in u))break t;u=u[T]}i=i[i.length-1],d=u[i],a=a(d),a!=d&&a!=null&&t(u,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var u=0,d=!1,T={next:function(){if(!d&&u<i.length){var b=u++;return{value:a(b,i[b]),done:!1}}return d=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,u){return u})}});var c=c||{},l=this||self;function h(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function m(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function f(i,a,u){return i.call.apply(i.bind,arguments)}function v(i,a,u){if(!i)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,d),i.apply(a,T)}}return function(){return i.apply(a,arguments)}}function C(i,a,u){return C=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:v,C.apply(null,arguments)}function S(i,a){var u=Array.prototype.slice.call(arguments,1);return function(){var d=u.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function L(i,a){function u(){}u.prototype=a.prototype,i.aa=a.prototype,i.prototype=new u,i.prototype.constructor=i,i.Qb=function(d,T,b){for(var k=Array(arguments.length-2),at=2;at<arguments.length;at++)k[at-2]=arguments[at];return a.prototype[T].apply(d,k)}}function B(i){let a=i.length;if(0<a){let u=Array(a);for(let d=0;d<a;d++)u[d]=i[d];return u}return[]}function M(i,a){for(let u=1;u<arguments.length;u++){let d=arguments[u];if(h(d)){let T=i.length||0,b=d.length||0;i.length=T+b;for(let k=0;k<b;k++)i[T+k]=d[k]}else i.push(d)}}class U{constructor(a,u){this.i=a,this.j=u,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function P(i){return/^[\s\xa0]*$/.test(i)}function N(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function X(i){return X[" "](i),i}X[" "]=function(){};var xt=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function st(i,a,u){for(let d in i)a.call(u,i[d],d,i)}function E(i,a){for(let u in i)a.call(void 0,i[u],u,i)}function p(i){let a={};for(let u in i)a[u]=i[u];return a}let g="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(i,a){let u,d;for(let T=1;T<arguments.length;T++){d=arguments[T];for(u in d)i[u]=d[u];for(let b=0;b<g.length;b++)u=g[b],Object.prototype.hasOwnProperty.call(d,u)&&(i[u]=d[u])}}function w(i){var a=1;i=i.split(":");let u=[];for(;0<a&&i.length;)u.push(i.shift()),a--;return i.length&&u.push(i.join(":")),u}function I(i){l.setTimeout(()=>{throw i},0)}function y(){var i=Oo;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class de{constructor(){this.h=this.g=null}add(a,u){let d=br.get();d.set(a,u),this.h?this.h.next=d:this.g=d,this.h=d}}var br=new U(()=>new rf,i=>i.reset());class rf{constructor(){this.next=this.g=this.h=null}set(a,u){this.h=a,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let Ar,Sr=!1,Oo=new de,Zu=()=>{let i=l.Promise.resolve(void 0);Ar=()=>{i.then(sf)}};var sf=()=>{for(var i;i=y();){try{i.h.call(i.g)}catch(u){I(u)}var a=br;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}Sr=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Dt(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}Dt.prototype.h=function(){this.defaultPrevented=!0};var of=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let u=()=>{};l.addEventListener("test",u,a),l.removeEventListener("test",u,a)}catch{}return i}();function xr(i,a){if(Dt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var u=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(xt){t:{try{X(a.nodeName);var T=!0;break t}catch{}T=!1}T||(a=null)}}else u=="mouseover"?a=i.fromElement:u=="mouseout"&&(a=i.toElement);this.relatedTarget=a,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:af[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&xr.aa.h.call(this)}}L(xr,Dt);var af={2:"touch",3:"pen",4:"mouse"};xr.prototype.h=function(){xr.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Dr="closure_listenable_"+(1e6*Math.random()|0),cf=0;function uf(i,a,u,d,T){this.listener=i,this.proxy=null,this.src=a,this.type=u,this.capture=!!d,this.ha=T,this.key=++cf,this.da=this.fa=!1}function Di(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Ri(i){this.src=i,this.g={},this.h=0}Ri.prototype.add=function(i,a,u,d,T){var b=i.toString();i=this.g[b],i||(i=this.g[b]=[],this.h++);var k=Lo(i,a,d,T);return-1<k?(a=i[k],u||(a.fa=!1)):(a=new uf(a,this.src,b,!!d,T),a.fa=u,i.push(a)),a};function Mo(i,a){var u=a.type;if(u in i.g){var d=i.g[u],T=Array.prototype.indexOf.call(d,a,void 0),b;(b=0<=T)&&Array.prototype.splice.call(d,T,1),b&&(Di(a),i.g[u].length==0&&(delete i.g[u],i.h--))}}function Lo(i,a,u,d){for(var T=0;T<i.length;++T){var b=i[T];if(!b.da&&b.listener==a&&b.capture==!!u&&b.ha==d)return T}return-1}var Bo="closure_lm_"+(1e6*Math.random()|0),qo={};function tl(i,a,u,d,T){if(d&&d.once)return nl(i,a,u,d,T);if(Array.isArray(a)){for(var b=0;b<a.length;b++)tl(i,a[b],u,d,T);return null}return u=Go(u),i&&i[Dr]?i.K(a,u,m(d)?!!d.capture:!!d,T):el(i,a,u,!1,d,T)}function el(i,a,u,d,T,b){if(!a)throw Error("Invalid event type");var k=m(T)?!!T.capture:!!T,at=jo(i);if(at||(i[Bo]=at=new Ri(i)),u=at.add(a,u,d,k,b),u.proxy)return u;if(d=lf(),u.proxy=d,d.src=i,d.listener=u,i.addEventListener)of||(T=k),T===void 0&&(T=!1),i.addEventListener(a.toString(),d,T);else if(i.attachEvent)i.attachEvent(il(a.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return u}function lf(){function i(u){return a.call(i.src,i.listener,u)}let a=hf;return i}function nl(i,a,u,d,T){if(Array.isArray(a)){for(var b=0;b<a.length;b++)nl(i,a[b],u,d,T);return null}return u=Go(u),i&&i[Dr]?i.L(a,u,m(d)?!!d.capture:!!d,T):el(i,a,u,!0,d,T)}function rl(i,a,u,d,T){if(Array.isArray(a))for(var b=0;b<a.length;b++)rl(i,a[b],u,d,T);else d=m(d)?!!d.capture:!!d,u=Go(u),i&&i[Dr]?(i=i.i,a=String(a).toString(),a in i.g&&(b=i.g[a],u=Lo(b,u,d,T),-1<u&&(Di(b[u]),Array.prototype.splice.call(b,u,1),b.length==0&&(delete i.g[a],i.h--)))):i&&(i=jo(i))&&(a=i.g[a.toString()],i=-1,a&&(i=Lo(a,u,d,T)),(u=-1<i?a[i]:null)&&Uo(u))}function Uo(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[Dr])Mo(a.i,i);else{var u=i.type,d=i.proxy;a.removeEventListener?a.removeEventListener(u,d,i.capture):a.detachEvent?a.detachEvent(il(u),d):a.addListener&&a.removeListener&&a.removeListener(d),(u=jo(a))?(Mo(u,i),u.h==0&&(u.src=null,a[Bo]=null)):Di(i)}}}function il(i){return i in qo?qo[i]:qo[i]="on"+i}function hf(i,a){if(i.da)i=!0;else{a=new xr(a,this);var u=i.listener,d=i.ha||i.src;i.fa&&Uo(i),i=u.call(d,a)}return i}function jo(i){return i=i[Bo],i instanceof Ri?i:null}var $o="__closure_events_fn_"+(1e9*Math.random()>>>0);function Go(i){return typeof i=="function"?i:(i[$o]||(i[$o]=function(a){return i.handleEvent(a)}),i[$o])}function Rt(){be.call(this),this.i=new Ri(this),this.M=this,this.F=null}L(Rt,be),Rt.prototype[Dr]=!0,Rt.prototype.removeEventListener=function(i,a,u,d){rl(this,i,a,u,d)};function Ft(i,a){var u,d=i.F;if(d)for(u=[];d;d=d.F)u.push(d);if(i=i.M,d=a.type||a,typeof a=="string")a=new Dt(a,i);else if(a instanceof Dt)a.target=a.target||i;else{var T=a;a=new Dt(d,i),_(a,T)}if(T=!0,u)for(var b=u.length-1;0<=b;b--){var k=a.g=u[b];T=Pi(k,d,!0,a)&&T}if(k=a.g=i,T=Pi(k,d,!0,a)&&T,T=Pi(k,d,!1,a)&&T,u)for(b=0;b<u.length;b++)k=a.g=u[b],T=Pi(k,d,!1,a)&&T}Rt.prototype.N=function(){if(Rt.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var u=i.g[a],d=0;d<u.length;d++)Di(u[d]);delete i.g[a],i.h--}}this.F=null},Rt.prototype.K=function(i,a,u,d){return this.i.add(String(i),a,!1,u,d)},Rt.prototype.L=function(i,a,u,d){return this.i.add(String(i),a,!0,u,d)};function Pi(i,a,u,d){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var T=!0,b=0;b<a.length;++b){var k=a[b];if(k&&!k.da&&k.capture==u){var at=k.listener,At=k.ha||k.src;k.fa&&Mo(i.i,k),T=at.call(At,d)!==!1&&T}}return T&&!d.defaultPrevented}function sl(i,a,u){if(typeof i=="function")u&&(i=C(i,u));else if(i&&typeof i.handleEvent=="function")i=C(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function ol(i){i.g=sl(()=>{i.g=null,i.i&&(i.i=!1,ol(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class df extends be{constructor(a,u){super(),this.m=a,this.l=u,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:ol(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rr(i){be.call(this),this.h=i,this.g={}}L(Rr,be);var al=[];function cl(i){st(i.g,function(a,u){this.g.hasOwnProperty(u)&&Uo(a)},i),i.g={}}Rr.prototype.N=function(){Rr.aa.N.call(this),cl(this)},Rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ko=l.JSON.stringify,mf=l.JSON.parse,pf=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Qo(){}Qo.prototype.h=null;function ul(i){return i.h||(i.h=i.i())}function ll(){}var Pr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Wo(){Dt.call(this,"d")}L(Wo,Dt);function Ho(){Dt.call(this,"c")}L(Ho,Dt);var Qe={},hl=null;function Ni(){return hl=hl||new Rt}Qe.La="serverreachability";function dl(i){Dt.call(this,Qe.La,i)}L(dl,Dt);function Nr(i){let a=Ni();Ft(a,new dl(a))}Qe.STAT_EVENT="statevent";function ml(i,a){Dt.call(this,Qe.STAT_EVENT,i),this.stat=a}L(ml,Dt);function Ot(i){let a=Ni();Ft(a,new ml(a,i))}Qe.Ma="timingevent";function pl(i,a){Dt.call(this,Qe.Ma,i),this.size=a}L(pl,Dt);function Vr(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function kr(){this.g=!0}kr.prototype.xa=function(){this.g=!1};function ff(i,a,u,d,T,b){i.info(function(){if(i.g)if(b)for(var k="",at=b.split("&"),At=0;At<at.length;At++){var rt=at[At].split("=");if(1<rt.length){var Pt=rt[0];rt=rt[1];var Nt=Pt.split("_");k=2<=Nt.length&&Nt[1]=="type"?k+(Pt+"="+rt+"&"):k+(Pt+"=redacted&")}}else k=null;else k=b;return"XMLHTTP REQ ("+d+") [attempt "+T+"]: "+a+`
`+u+`
`+k})}function gf(i,a,u,d,T,b,k){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+T+"]: "+a+`
`+u+`
`+b+" "+k})}function fn(i,a,u,d){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+_f(i,u)+(d?" "+d:"")})}function yf(i,a){i.info(function(){return"TIMEOUT: "+a})}kr.prototype.info=function(){};function _f(i,a){if(!i.g)return a;if(!a)return null;try{var u=JSON.parse(a);if(u){for(i=0;i<u.length;i++)if(Array.isArray(u[i])){var d=u[i];if(!(2>d.length)){var T=d[1];if(Array.isArray(T)&&!(1>T.length)){var b=T[0];if(b!="noop"&&b!="stop"&&b!="close")for(var k=1;k<T.length;k++)T[k]=""}}}}return Ko(u)}catch{return a}}var Vi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},fl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Xo;function ki(){}L(ki,Qo),ki.prototype.g=function(){return new XMLHttpRequest},ki.prototype.i=function(){return{}},Xo=new ki;function Ae(i,a,u,d){this.j=i,this.i=a,this.l=u,this.R=d||1,this.U=new Rr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new gl}function gl(){this.i=null,this.g="",this.h=!1}var yl={},Yo={};function Jo(i,a,u){i.L=1,i.v=Mi(me(a)),i.m=u,i.P=!0,_l(i,null)}function _l(i,a){i.F=Date.now(),zi(i),i.A=me(i.v);var u=i.A,d=i.R;Array.isArray(d)||(d=[String(d)]),Nl(u.i,"t",d),i.C=0,u=i.j.J,i.h=new gl,i.g=Xl(i.j,u?a:null,!i.m),0<i.O&&(i.M=new df(C(i.Y,i,i.g),i.O)),a=i.U,u=i.g,d=i.ca;var T="readystatechange";Array.isArray(T)||(T&&(al[0]=T.toString()),T=al);for(var b=0;b<T.length;b++){var k=tl(u,T[b],d||a.handleEvent,!1,a.h||a);if(!k)break;a.g[k.key]=k}a=i.H?p(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),Nr(),ff(i.i,i.u,i.A,i.l,i.R,i.m)}Ae.prototype.ca=function(i){i=i.target;let a=this.M;a&&pe(i)==3?a.j():this.Y(i)},Ae.prototype.Y=function(i){try{if(i==this.g)t:{let Nt=pe(this.g);var a=this.g.Ba();let _n=this.g.Z();if(!(3>Nt)&&(Nt!=3||this.g&&(this.h.h||this.g.oa()||Ll(this.g)))){this.J||Nt!=4||a==7||(a==8||0>=_n?Nr(3):Nr(2)),Zo(this);var u=this.g.Z();this.X=u;e:if(vl(this)){var d=Ll(this.g);i="";var T=d.length,b=pe(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){We(this),zr(this);var k="";break e}this.h.i=new l.TextDecoder}for(a=0;a<T;a++)this.h.h=!0,i+=this.h.i.decode(d[a],{stream:!(b&&a==T-1)});d.length=0,this.h.g+=i,this.C=0,k=this.h.g}else k=this.g.oa();if(this.o=u==200,gf(this.i,this.u,this.A,this.l,this.R,Nt,u),this.o){if(this.T&&!this.K){e:{if(this.g){var at,At=this.g;if((at=At.g?At.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(at)){var rt=at;break e}}rt=null}if(u=rt)fn(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ta(this,u);else{this.o=!1,this.s=3,Ot(12),We(this),zr(this);break t}}if(this.P){u=!0;let Ht;for(;!this.J&&this.C<k.length;)if(Ht=vf(this,k),Ht==Yo){Nt==4&&(this.s=4,Ot(14),u=!1),fn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ht==yl){this.s=4,Ot(15),fn(this.i,this.l,k,"[Invalid Chunk]"),u=!1;break}else fn(this.i,this.l,Ht,null),ta(this,Ht);if(vl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Nt!=4||k.length!=0||this.h.h||(this.s=1,Ot(16),u=!1),this.o=this.o&&u,!u)fn(this.i,this.l,k,"[Invalid Chunked Response]"),We(this),zr(this);else if(0<k.length&&!this.W){this.W=!0;var Pt=this.j;Pt.g==this&&Pt.ba&&!Pt.M&&(Pt.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),oa(Pt),Pt.M=!0,Ot(11))}}else fn(this.i,this.l,k,null),ta(this,k);Nt==4&&We(this),this.o&&!this.J&&(Nt==4?Kl(this.j,this):(this.o=!1,zi(this)))}else Ff(this.g),u==400&&0<k.indexOf("Unknown SID")?(this.s=3,Ot(12)):(this.s=0,Ot(13)),We(this),zr(this)}}}catch{}finally{}};function vl(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function vf(i,a){var u=i.C,d=a.indexOf(`
`,u);return d==-1?Yo:(u=Number(a.substring(u,d)),isNaN(u)?yl:(d+=1,d+u>a.length?Yo:(a=a.slice(d,d+u),i.C=d+u,a)))}Ae.prototype.cancel=function(){this.J=!0,We(this)};function zi(i){i.S=Date.now()+i.I,El(i,i.I)}function El(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=Vr(C(i.ba,i),a)}function Zo(i){i.B&&(l.clearTimeout(i.B),i.B=null)}Ae.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(yf(this.i,this.A),this.L!=2&&(Nr(),Ot(17)),We(this),this.s=2,zr(this)):El(this,this.S-i)};function zr(i){i.j.G==0||i.J||Kl(i.j,i)}function We(i){Zo(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,cl(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function ta(i,a){try{var u=i.j;if(u.G!=0&&(u.g==i||ea(u.h,i))){if(!i.K&&ea(u.h,i)&&u.G==3){try{var d=u.Da.g.parse(a)}catch{d=null}if(Array.isArray(d)&&d.length==3){var T=d;if(T[0]==0){t:if(!u.u){if(u.g)if(u.g.F+3e3<i.F)ji(u),qi(u);else break t;sa(u),Ot(18)}}else u.za=T[1],0<u.za-u.T&&37500>T[2]&&u.F&&u.v==0&&!u.C&&(u.C=Vr(C(u.Za,u),6e3));if(1>=Il(u.h)&&u.ca){try{u.ca()}catch{}u.ca=void 0}}else Xe(u,11)}else if((i.K||u.g==i)&&ji(u),!P(a))for(T=u.Da.g.parse(a),a=0;a<T.length;a++){let rt=T[a];if(u.T=rt[0],rt=rt[1],u.G==2)if(rt[0]=="c"){u.K=rt[1],u.ia=rt[2];let Pt=rt[3];Pt!=null&&(u.la=Pt,u.j.info("VER="+u.la));let Nt=rt[4];Nt!=null&&(u.Aa=Nt,u.j.info("SVER="+u.Aa));let _n=rt[5];_n!=null&&typeof _n=="number"&&0<_n&&(d=1.5*_n,u.L=d,u.j.info("backChannelRequestTimeoutMs_="+d)),d=u;let Ht=i.g;if(Ht){let Gi=Ht.g?Ht.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Gi){var b=d.h;b.g||Gi.indexOf("spdy")==-1&&Gi.indexOf("quic")==-1&&Gi.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(na(b,b.h),b.h=null))}if(d.D){let aa=Ht.g?Ht.g.getResponseHeader("X-HTTP-Session-Id"):null;aa&&(d.ya=aa,lt(d.I,d.D,aa))}}u.G=3,u.l&&u.l.ua(),u.ba&&(u.R=Date.now()-i.F,u.j.info("Handshake RTT: "+u.R+"ms")),d=u;var k=i;if(d.qa=Hl(d,d.J?d.ia:null,d.W),k.K){Cl(d.h,k);var at=k,At=d.L;At&&(at.I=At),at.B&&(Zo(at),zi(at)),d.g=k}else $l(d);0<u.i.length&&Ui(u)}else rt[0]!="stop"&&rt[0]!="close"||Xe(u,7);else u.G==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?Xe(u,7):ia(u):rt[0]!="noop"&&u.l&&u.l.ta(rt),u.v=0)}}Nr(4)}catch{}}var Ef=class{constructor(i,a){this.g=i,this.map=a}};function wl(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Tl(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Il(i){return i.h?1:i.g?i.g.size:0}function ea(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function na(i,a){i.g?i.g.add(a):i.h=a}function Cl(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}wl.prototype.cancel=function(){if(this.i=bl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function bl(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let u of i.g.values())a=a.concat(u.D);return a}return B(i.i)}function wf(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(h(i)){for(var a=[],u=i.length,d=0;d<u;d++)a.push(i[d]);return a}a=[],u=0;for(d in i)a[u++]=i[d];return a}function Tf(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(h(i)||typeof i=="string"){var a=[];i=i.length;for(var u=0;u<i;u++)a.push(u);return a}a=[],u=0;for(let d in i)a[u++]=d;return a}}}function Al(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(h(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var u=Tf(i),d=wf(i),T=d.length,b=0;b<T;b++)a.call(void 0,d[b],u&&u[b],i)}var Sl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function If(i,a){if(i){i=i.split("&");for(var u=0;u<i.length;u++){var d=i[u].indexOf("="),T=null;if(0<=d){var b=i[u].substring(0,d);T=i[u].substring(d+1)}else b=i[u];a(b,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function He(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof He){this.h=i.h,Fi(this,i.j),this.o=i.o,this.g=i.g,Oi(this,i.s),this.l=i.l;var a=i.i,u=new Mr;u.i=a.i,a.g&&(u.g=new Map(a.g),u.h=a.h),xl(this,u),this.m=i.m}else i&&(a=String(i).match(Sl))?(this.h=!1,Fi(this,a[1]||"",!0),this.o=Fr(a[2]||""),this.g=Fr(a[3]||"",!0),Oi(this,a[4]),this.l=Fr(a[5]||"",!0),xl(this,a[6]||"",!0),this.m=Fr(a[7]||"")):(this.h=!1,this.i=new Mr(null,this.h))}He.prototype.toString=function(){var i=[],a=this.j;a&&i.push(Or(a,Dl,!0),":");var u=this.g;return(u||a=="file")&&(i.push("//"),(a=this.o)&&i.push(Or(a,Dl,!0),"@"),i.push(encodeURIComponent(String(u)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.s,u!=null&&i.push(":",String(u))),(u=this.l)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(Or(u,u.charAt(0)=="/"?Af:bf,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",Or(u,xf)),i.join("")};function me(i){return new He(i)}function Fi(i,a,u){i.j=u?Fr(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function Oi(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function xl(i,a,u){a instanceof Mr?(i.i=a,Df(i.i,i.h)):(u||(a=Or(a,Sf)),i.i=new Mr(a,i.h))}function lt(i,a,u){i.i.set(a,u)}function Mi(i){return lt(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function Fr(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Or(i,a,u){return typeof i=="string"?(i=encodeURI(i).replace(a,Cf),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Cf(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Dl=/[#\/\?@]/g,bf=/[#\?:]/g,Af=/[#\?]/g,Sf=/[#\?@]/g,xf=/#/g;function Mr(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function Se(i){i.g||(i.g=new Map,i.h=0,i.i&&If(i.i,function(a,u){i.add(decodeURIComponent(a.replace(/\+/g," ")),u)}))}n=Mr.prototype,n.add=function(i,a){Se(this),this.i=null,i=gn(this,i);var u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(a),this.h+=1,this};function Rl(i,a){Se(i),a=gn(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function Pl(i,a){return Se(i),a=gn(i,a),i.g.has(a)}n.forEach=function(i,a){Se(this),this.g.forEach(function(u,d){u.forEach(function(T){i.call(a,T,d,this)},this)},this)},n.na=function(){Se(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),u=[];for(let d=0;d<a.length;d++){let T=i[d];for(let b=0;b<T.length;b++)u.push(a[d])}return u},n.V=function(i){Se(this);let a=[];if(typeof i=="string")Pl(this,i)&&(a=a.concat(this.g.get(gn(this,i))));else{i=Array.from(this.g.values());for(let u=0;u<i.length;u++)a=a.concat(i[u])}return a},n.set=function(i,a){return Se(this),this.i=null,i=gn(this,i),Pl(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},n.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function Nl(i,a,u){Rl(i,a),0<u.length&&(i.i=null,i.g.set(gn(i,a),B(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var u=0;u<a.length;u++){var d=a[u];let b=encodeURIComponent(String(d)),k=this.V(d);for(d=0;d<k.length;d++){var T=b;k[d]!==""&&(T+="="+encodeURIComponent(String(k[d]))),i.push(T)}}return this.i=i.join("&")};function gn(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Df(i,a){a&&!i.j&&(Se(i),i.i=null,i.g.forEach(function(u,d){var T=d.toLowerCase();d!=T&&(Rl(this,d),Nl(this,T,u))},i)),i.j=a}function Rf(i,a){let u=new kr;if(l.Image){let d=new Image;d.onload=S(xe,u,"TestLoadImage: loaded",!0,a,d),d.onerror=S(xe,u,"TestLoadImage: error",!1,a,d),d.onabort=S(xe,u,"TestLoadImage: abort",!1,a,d),d.ontimeout=S(xe,u,"TestLoadImage: timeout",!1,a,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else a(!1)}function Pf(i,a){let u=new kr,d=new AbortController,T=setTimeout(()=>{d.abort(),xe(u,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:d.signal}).then(b=>{clearTimeout(T),b.ok?xe(u,"TestPingServer: ok",!0,a):xe(u,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(T),xe(u,"TestPingServer: error",!1,a)})}function xe(i,a,u,d,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),d(u)}catch{}}function Nf(){this.g=new pf}function Vf(i,a,u){let d=u||"";try{Al(i,function(T,b){let k=T;m(T)&&(k=Ko(T)),a.push(d+b+"="+encodeURIComponent(k))})}catch(T){throw a.push(d+"type="+encodeURIComponent("_badmap")),T}}function Lr(i){this.l=i.Ub||null,this.j=i.eb||!1}L(Lr,Qo),Lr.prototype.g=function(){return new Li(this.l,this.j)},Lr.prototype.i=function(i){return function(){return i}}({});function Li(i,a){Rt.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(Li,Rt),n=Li.prototype,n.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,qr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Br(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,qr(this)),this.g&&(this.readyState=3,qr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Vl(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function Vl(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?Br(this):qr(this),this.readyState==3&&Vl(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,Br(this))},n.Qa=function(i){this.g&&(this.response=i,Br(this))},n.ga=function(){this.g&&Br(this)};function Br(i){i.readyState=4,i.l=null,i.j=null,i.v=null,qr(i)}n.setRequestHeader=function(i,a){this.u.append(i,a)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var u=a.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=a.next();return i.join(`\r
`)};function qr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Li.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function kl(i){let a="";return st(i,function(u,d){a+=d,a+=":",a+=u,a+=`\r
`}),a}function ra(i,a,u){t:{for(d in u){var d=!1;break t}d=!0}d||(u=kl(u),typeof i=="string"?u!=null&&encodeURIComponent(String(u)):lt(i,a,u))}function mt(i){Rt.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(mt,Rt);var kf=/^https?$/i,zf=["POST","PUT"];n=mt.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,a,u,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Xo.g(),this.v=this.o?ul(this.o):ul(Xo),this.g.onreadystatechange=C(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(b){zl(this,b);return}if(i=u||"",u=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var T in d)u.set(T,d[T]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())u.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(u.keys()).find(b=>b.toLowerCase()=="content-type"),T=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(zf,a,void 0))||d||T||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,k]of u)this.g.setRequestHeader(b,k);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ml(this),this.u=!0,this.g.send(i),this.u=!1}catch(b){zl(this,b)}};function zl(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,Fl(i),Bi(i)}function Fl(i){i.A||(i.A=!0,Ft(i,"complete"),Ft(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,Ft(this,"complete"),Ft(this,"abort"),Bi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bi(this,!0)),mt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ol(this):this.bb())},n.bb=function(){Ol(this)};function Ol(i){if(i.h&&typeof c<"u"&&(!i.v[1]||pe(i)!=4||i.Z()!=2)){if(i.u&&pe(i)==4)sl(i.Ea,0,i);else if(Ft(i,"readystatechange"),pe(i)==4){i.h=!1;try{let k=i.Z();t:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var u;if(!(u=a)){var d;if(d=k===0){var T=String(i.D).match(Sl)[1]||null;!T&&l.self&&l.self.location&&(T=l.self.location.protocol.slice(0,-1)),d=!kf.test(T?T.toLowerCase():"")}u=d}if(u)Ft(i,"complete"),Ft(i,"success");else{i.m=6;try{var b=2<pe(i)?i.g.statusText:""}catch{b=""}i.l=b+" ["+i.Z()+"]",Fl(i)}}finally{Bi(i)}}}}function Bi(i,a){if(i.g){Ml(i);let u=i.g,d=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||Ft(i,"ready");try{u.onreadystatechange=d}catch{}}}function Ml(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function pe(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<pe(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),mf(a)}};function Ll(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Ff(i){let a={};i=(i.g&&2<=pe(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(P(i[d]))continue;var u=w(i[d]);let T=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();let b=a[T]||[];a[T]=b,b.push(u)}E(a,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ur(i,a,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||a}function Bl(i){this.Aa=0,this.i=[],this.j=new kr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ur("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ur("baseRetryDelayMs",5e3,i),this.cb=Ur("retryDelaySeedMs",1e4,i),this.Wa=Ur("forwardChannelMaxRetries",2,i),this.wa=Ur("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new wl(i&&i.concurrentRequestLimit),this.Da=new Nf,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bl.prototype,n.la=8,n.G=1,n.connect=function(i,a,u,d){Ot(0),this.W=i,this.H=a||{},u&&d!==void 0&&(this.H.OSID=u,this.H.OAID=d),this.F=this.X,this.I=Hl(this,null,this.W),Ui(this)};function ia(i){if(ql(i),i.G==3){var a=i.U++,u=me(i.I);if(lt(u,"SID",i.K),lt(u,"RID",a),lt(u,"TYPE","terminate"),jr(i,u),a=new Ae(i,i.j,a),a.L=2,a.v=Mi(me(u)),u=!1,l.navigator&&l.navigator.sendBeacon)try{u=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!u&&l.Image&&(new Image().src=a.v,u=!0),u||(a.g=Xl(a.j,null),a.g.ea(a.v)),a.F=Date.now(),zi(a)}Wl(i)}function qi(i){i.g&&(oa(i),i.g.cancel(),i.g=null)}function ql(i){qi(i),i.u&&(l.clearTimeout(i.u),i.u=null),ji(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function Ui(i){if(!Tl(i.h)&&!i.s){i.s=!0;var a=i.Ga;Ar||Zu(),Sr||(Ar(),Sr=!0),Oo.add(a,i),i.B=0}}function Of(i,a){return Il(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=Vr(C(i.Ga,i,a),Ql(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let T=new Ae(this,this.j,i),b=this.o;if(this.S&&(b?(b=p(b),_(b,this.S)):b=this.S),this.m!==null||this.O||(T.H=b,b=null),this.P)t:{for(var a=0,u=0;u<this.i.length;u++){e:{var d=this.i[u];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(a+=d,4096<a){a=u;break t}if(a===4096||u===this.i.length-1){a=u+1;break t}}a=1e3}else a=1e3;a=jl(this,T,a),u=me(this.I),lt(u,"RID",i),lt(u,"CVER",22),this.D&&lt(u,"X-HTTP-Session-Id",this.D),jr(this,u),b&&(this.O?a="headers="+encodeURIComponent(String(kl(b)))+"&"+a:this.m&&ra(u,this.m,b)),na(this.h,T),this.Ua&&lt(u,"TYPE","init"),this.P?(lt(u,"$req",a),lt(u,"SID","null"),T.T=!0,Jo(T,u,null)):Jo(T,u,a),this.G=2}}else this.G==3&&(i?Ul(this,i):this.i.length==0||Tl(this.h)||Ul(this))};function Ul(i,a){var u;a?u=a.l:u=i.U++;let d=me(i.I);lt(d,"SID",i.K),lt(d,"RID",u),lt(d,"AID",i.T),jr(i,d),i.m&&i.o&&ra(d,i.m,i.o),u=new Ae(i,i.j,u,i.B+1),i.m===null&&(u.H=i.o),a&&(i.i=a.D.concat(i.i)),a=jl(i,u,1e3),u.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),na(i.h,u),Jo(u,d,a)}function jr(i,a){i.H&&st(i.H,function(u,d){lt(a,d,u)}),i.l&&Al({},function(u,d){lt(a,d,u)})}function jl(i,a,u){u=Math.min(i.i.length,u);var d=i.l?C(i.l.Na,i.l,i):null;t:{var T=i.i;let b=-1;for(;;){let k=["count="+u];b==-1?0<u?(b=T[0].g,k.push("ofs="+b)):b=0:k.push("ofs="+b);let at=!0;for(let At=0;At<u;At++){let rt=T[At].g,Pt=T[At].map;if(rt-=b,0>rt)b=Math.max(0,T[At].g-100),at=!1;else try{Vf(Pt,k,"req"+rt+"_")}catch{d&&d(Pt)}}if(at){d=k.join("&");break t}}}return i=i.i.splice(0,u),a.D=i,d}function $l(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;Ar||Zu(),Sr||(Ar(),Sr=!0),Oo.add(a,i),i.v=0}}function sa(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=Vr(C(i.Fa,i),Ql(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,Gl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=Vr(C(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ot(10),qi(this),Gl(this))};function oa(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function Gl(i){i.g=new Ae(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=me(i.qa);lt(a,"RID","rpc"),lt(a,"SID",i.K),lt(a,"AID",i.T),lt(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&lt(a,"TO",i.ja),lt(a,"TYPE","xmlhttp"),jr(i,a),i.m&&i.o&&ra(a,i.m,i.o),i.L&&(i.g.I=i.L);var u=i.g;i=i.ia,u.L=1,u.v=Mi(me(a)),u.m=null,u.P=!0,_l(u,i)}n.Za=function(){this.C!=null&&(this.C=null,qi(this),sa(this),Ot(19))};function ji(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function Kl(i,a){var u=null;if(i.g==a){ji(i),oa(i),i.g=null;var d=2}else if(ea(i.h,a))u=a.D,Cl(i.h,a),d=1;else return;if(i.G!=0){if(a.o)if(d==1){u=a.m?a.m.length:0,a=Date.now()-a.F;var T=i.B;d=Ni(),Ft(d,new pl(d,u)),Ui(i)}else $l(i);else if(T=a.s,T==3||T==0&&0<a.X||!(d==1&&Of(i,a)||d==2&&sa(i)))switch(u&&0<u.length&&(a=i.h,a.i=a.i.concat(u)),T){case 1:Xe(i,5);break;case 4:Xe(i,10);break;case 3:Xe(i,6);break;default:Xe(i,2)}}}function Ql(i,a){let u=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(u*=2),u*a}function Xe(i,a){if(i.j.info("Error code "+a),a==2){var u=C(i.fb,i),d=i.Xa;let T=!d;d=new He(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Fi(d,"https"),Mi(d),T?Rf(d.toString(),u):Pf(d.toString(),u)}else Ot(2);i.G=0,i.l&&i.l.sa(a),Wl(i),ql(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),Ot(2)):(this.j.info("Failed to ping google.com"),Ot(1))};function Wl(i){if(i.G=0,i.ka=[],i.l){let a=bl(i.h);(a.length!=0||i.i.length!=0)&&(M(i.ka,a),M(i.ka,i.i),i.h.i.length=0,B(i.i),i.i.length=0),i.l.ra()}}function Hl(i,a,u){var d=u instanceof He?me(u):new He(u);if(d.g!="")a&&(d.g=a+"."+d.g),Oi(d,d.s);else{var T=l.location;d=T.protocol,a=a?a+"."+T.hostname:T.hostname,T=+T.port;var b=new He(null);d&&Fi(b,d),a&&(b.g=a),T&&Oi(b,T),u&&(b.l=u),d=b}return u=i.D,a=i.ya,u&&a&&lt(d,u,a),lt(d,"VER",i.la),jr(i,d),d}function Xl(i,a,u){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new mt(new Lr({eb:u})):new mt(i.pa),a.Ha(i.J),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Yl(){}n=Yl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $i(){}$i.prototype.g=function(i,a){return new Bt(i,a)};function Bt(i,a){Rt.call(this),this.g=new Bl(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!P(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!P(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new yn(this)}L(Bt,Rt),Bt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bt.prototype.close=function(){ia(this.g)},Bt.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.u&&(u={},u.__data__=Ko(i),i=u);a.i.push(new Ef(a.Ya++,i)),a.G==3&&Ui(a)},Bt.prototype.N=function(){this.g.l=null,delete this.j,ia(this.g),delete this.g,Bt.aa.N.call(this)};function Jl(i){Wo.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let u in a){i=u;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}L(Jl,Wo);function Zl(){Ho.call(this),this.status=1}L(Zl,Ho);function yn(i){this.g=i}L(yn,Yl),yn.prototype.ua=function(){Ft(this.g,"a")},yn.prototype.ta=function(i){Ft(this.g,new Jl(i))},yn.prototype.sa=function(i){Ft(this.g,new Zl)},yn.prototype.ra=function(){Ft(this.g,"b")},$i.prototype.createWebChannel=$i.prototype.g,Bt.prototype.send=Bt.prototype.o,Bt.prototype.open=Bt.prototype.m,Bt.prototype.close=Bt.prototype.close,Va=ye.createWebChannelTransport=function(){return new $i},Na=ye.getStatEventTarget=function(){return Ni()},Pa=ye.Event=Qe,Ts=ye.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vi.NO_ERROR=0,Vi.TIMEOUT=8,Vi.HTTP_ERROR=6,Zr=ye.ErrorCode=Vi,fl.COMPLETE="complete",Ra=ye.EventType=fl,ll.EventType=Pr,Pr.OPEN="a",Pr.CLOSE="b",Pr.ERROR="c",Pr.MESSAGE="d",Rt.prototype.listen=Rt.prototype.K,kn=ye.WebChannel=ll,hg=ye.FetchXmlHttpFactory=Lr,mt.prototype.listenOnce=mt.prototype.L,mt.prototype.getLastError=mt.prototype.Ka,mt.prototype.getLastErrorCode=mt.prototype.Ba,mt.prototype.getStatus=mt.prototype.Z,mt.prototype.getResponseJson=mt.prototype.Oa,mt.prototype.getResponseText=mt.prototype.oa,mt.prototype.send=mt.prototype.ea,mt.prototype.setWithCredentials=mt.prototype.Ha,Da=ye.XhrIo=mt}).apply(typeof ws<"u"?ws:typeof self<"u"?self:typeof window<"u"?window:{});var md="@firebase/firestore",pd="4.8.0";var It=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};It.UNAUTHENTICATED=new It(null),It.GOOGLE_CREDENTIALS=new It("google-credentials-uid"),It.FIRST_PARTY=new It("first-party-uid"),It.MOCK_USER=new It("mock-user");var nr="11.10.0";var sn=new kh("@firebase/firestore");function zn(){return sn.logLevel}function q(n,...t){if(sn.logLevel<=re.DEBUG){let e=t.map(_u);sn.debug(`Firestore (${nr}): ${n}`,...e)}}function _e(n,...t){if(sn.logLevel<=re.ERROR){let e=t.map(_u);sn.error(`Firestore (${nr}): ${n}`,...e)}}function Ue(n,...t){if(sn.logLevel<=re.WARN){let e=t.map(_u);sn.warn(`Firestore (${nr}): ${n}`,...e)}}function _u(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function G(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,rm(n,r,e)}function rm(n,t,e){let r=`FIRESTORE (${nr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw _e(r),new Error(r)}function it(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||rm(t,s,r)}function K(n,t){return n}var A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},j=class extends Ph{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Jt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Ds=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Ma=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(It.UNAUTHENTICATED))}shutdown(){}},La=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ba=class{constructor(t){this.t=t,this.currentUser=It.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){it(this.o===void 0,42304);let r=this.i,s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve(),o=new Jt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Jt,t.enqueueRetryable(()=>s(this.currentUser))};let c=()=>{let h=o;t.enqueueRetryable(()=>V(this,null,function*(){yield h.promise,yield s(this.currentUser)}))},l=h=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Jt)}},0),c()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(it(typeof r.accessToken=="string",31837,{l:r}),new Ds(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return it(t===null||typeof t=="string",2055,{h:t}),new It(t)}},qa=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=It.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Ua=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new qa(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(It.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Rs=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ja=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Oh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){it(this.o===void 0,3512);let r=o=>{o.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let c=o.token!==this.m;return this.m=o.token,q("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?s(o):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Rs(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(it(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Rs(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function dg(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}function im(){return new TextEncoder}var si=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=dg(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}};function H(n,t){return n<t?-1:n>t?1:0}function $a(n,t){let e=0;for(;e<n.length&&e<t.length;){let r=n.codePointAt(e),s=t.codePointAt(e);if(r!==s){if(r<128&&s<128)return H(r,s);{let o=im(),c=mg(o.encode(fd(n,e)),o.encode(fd(t,e)));return c!==0?c:H(r,s)}}e+=r>65535?2:1}return H(n.length,t.length)}function fd(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function mg(n,t){for(let e=0;e<n.length&&e<t.length;++e)if(n[e]!==t[e])return H(n[e],t[e]);return H(n.length,t.length)}function Un(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var gd="__name__",Ps=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&G(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&G(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=n.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return H(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):$a(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ge.fromString(t.substring(4,t.length-2))}},dt=class n extends Ps{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new j(A.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},pg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,$t=class n extends Ps{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return pg.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===gd}static keyField(){return new n([gd])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new j(A.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},c=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new j(A.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new j(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(c=!c,s++):l!=="."||c?(r+=l,s++):(o(),s++)}if(o(),c)throw new j(A.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var $=class n{constructor(t){this.path=t}static fromPath(t){return new n(dt.fromString(t))}static fromName(t){return new n(dt.fromString(t).popFirst(5))}static empty(){return new n(dt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&dt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return dt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new dt(t.slice()))}};function sm(n,t,e){if(!e)throw new j(A.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function fg(n,t,e,r){if(t===!0&&r===!0)throw new j(A.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function yd(n){if(!$.isDocumentKey(n))throw new j(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _d(n){if($.isDocumentKey(n))throw new j(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function om(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function vu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":G(12329,{type:typeof n})}function Lt(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new j(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=vu(n);throw new j(A.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function _t(n,t){let e={typeString:n};return t&&(e.value=t),e}function Ei(n,t){if(!om(n))throw new j(A.INVALID_ARGUMENT,"JSON must be an object");let e;for(let r in t)if(t[r]){let s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}let c=n[r];if(s&&typeof c!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&c!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new j(A.INVALID_ARGUMENT,e);return!0}var vd=-62135596800,Ed=1e6,vt=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Ed);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new j(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new j(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<vd)throw new j(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new j(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ed}_compareTo(t){return this.seconds===t.seconds?H(this.nanoseconds,t.nanoseconds):H(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Ei(t,n._jsonSchema))return new n(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-vd;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};vt._jsonSchemaVersion="firestore/timestamp/1.0",vt._jsonSchema={type:_t("string",vt._jsonSchemaVersion),seconds:_t("number"),nanoseconds:_t("number")};var W=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new vt(0,0))}static max(){return new n(new vt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var oi=-1,Ga=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};Ga.UNKNOWN_ID=-1;function gg(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=W.fromTimestamp(r===1e9?new vt(e+1,0):new vt(e,r));return new on(s,$.empty(),t)}function yg(n){return new on(n.readTime,n.key,oi)}var on=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(W.min(),$.empty(),oi)}static max(){return new n(W.max(),$.empty(),oi)}};function _g(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=$.comparator(n.documentKey,t.documentKey),e!==0?e:H(n.largestBatchId,t.largestBatchId))}var vg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ka=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function rr(n){return V(this,null,function*(){if(n.code!==A.FAILED_PRECONDITION||n.message!==vg)throw n;q("LocalStore","Unexpectedly lost primary lease")})}var x=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&G(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,c=!1;t.forEach(l=>{++s,l.next(()=>{++o,c&&o===s&&e()},h=>r(h))}),c=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,c=new Array(o),l=0;for(let h=0;h<o;h++){let m=h;e(t[m]).next(f=>{c[m]=f,++l,l===o&&r(c)},f=>s(f))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function Eg(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function ir(n){return n.name==="IndexedDbTransactionError"}var Eu=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this._e(s),this.ae=s=>r.writeSequenceNumber(s))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}n.ue=-1;return n})(),wu=-1;function ao(n){return n==null}function ai(n){return n===0&&1/n==-1/0}function wg(n){return typeof n=="number"&&Number.isInteger(n)&&!ai(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var am="";function Tg(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=wd(t)),t=Ig(n.get(e),t);return wd(t)}function Ig(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let o=n.charAt(s);switch(o){case"\0":e+="";break;case am:e+="";break;default:e+=o}}return e}function wd(n){return n+am+""}var Cg="remoteDocuments",cm="owner";var um="mutationQueues";var lm="mutations";var hm="documentMutations",bg="remoteDocumentsV14";var dm="remoteDocumentGlobal";var mm="targets";var pm="targetDocuments";var fm="targetGlobal",gm="collectionParents";var ym="clientMetadata";var _m="bundles";var vm="namedQueries";var Ag="indexConfiguration";var Sg="indexState";var xg="indexEntries";var Em="documentOverlays";var Dg="globals";var Rg=[um,lm,hm,Cg,mm,cm,fm,pm,ym,dm,gm,_m,vm],x0=[...Rg,Em],Pg=[um,lm,hm,bg,mm,cm,fm,pm,ym,dm,gm,_m,vm,Em],Ng=Pg,Vg=[...Ng,Ag,Sg,xg];var D0=[...Vg,Dg];function Td(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Ke(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function wm(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var ft=class n{constructor(t,e){this.comparator=t,this.root=e||se.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,se.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,se.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ln(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ln(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ln(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ln(this.root,t,this.comparator,!0)}},Ln=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},se=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw G(43730,{key:this.key,value:this.value});if(this.right.isRed())throw G(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw G(27949);return t+(this.isRed()?0:1)}};se.EMPTY=null,se.RED=!0,se.BLACK=!1;se.EMPTY=new class{constructor(){this.size=0}get key(){throw G(57766)}get value(){throw G(16141)}get color(){throw G(16727)}get left(){throw G(29726)}get right(){throw G(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new se(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ct=class n{constructor(t){this.comparator=t,this.data=new ft(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ns(this.data.getIterator())}getIteratorFrom(t){return new Ns(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Ns=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Wt=class n{constructor(t){this.fields=t,t.sort($t.comparator)}static empty(){return new n([])}unionWith(t){let e=new Ct($t.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Un(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Vs=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var kt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Vs("Invalid base64 string: "+o):o}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let o="";for(let c=0;c<s.length;++c)o+=String.fromCharCode(s[c]);return o}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return H(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};kt.EMPTY_BYTE_STRING=new kt("");var kg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ve(n){if(it(!!n,39018),typeof n=="string"){let t=0,e=kg.exec(n);if(it(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ht(n.seconds),nanos:ht(n.nanos)}}function ht(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ee(n){return typeof n=="string"?kt.fromBase64String(n):kt.fromUint8Array(n)}var Tm="server_timestamp",Im="__type__",Cm="__previous_value__",bm="__local_write_time__";function Tu(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Im])===null||e===void 0?void 0:e.stringValue)===Tm}function co(n){let t=n.mapValue.fields[Cm];return Tu(t)?co(t):t}function ci(n){let t=ve(n.mapValue.fields[bm].timestampValue);return new vt(t.seconds,t.nanos)}var Qa=class{constructor(t,e,r,s,o,c,l,h,m,f){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=c,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=f}},ks="(default)",zs=class n{constructor(t,e){this.projectId=t,this.database=e||ks}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===ks}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Iu="__type__",Am="__max__",Is={mapValue:{fields:{__type__:{stringValue:Am}}}},Cu="__vector__",jn="value";function je(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Tu(n)?4:xm(n)?9007199254740991:Sm(n)?10:11:G(28295,{value:n})}function ue(n,t){if(n===t)return!0;let e=je(n);if(e!==je(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return ci(n).isEqual(ci(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let c=ve(s.timestampValue),l=ve(o.timestampValue);return c.seconds===l.seconds&&c.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,o){return Ee(s.bytesValue).isEqual(Ee(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,o){return ht(s.geoPointValue.latitude)===ht(o.geoPointValue.latitude)&&ht(s.geoPointValue.longitude)===ht(o.geoPointValue.longitude)}(n,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return ht(s.integerValue)===ht(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let c=ht(s.doubleValue),l=ht(o.doubleValue);return c===l?ai(c)===ai(l):isNaN(c)&&isNaN(l)}return!1}(n,t);case 9:return Un(n.arrayValue.values||[],t.arrayValue.values||[],ue);case 10:case 11:return function(s,o){let c=s.mapValue.fields||{},l=o.mapValue.fields||{};if(Td(c)!==Td(l))return!1;for(let h in c)if(c.hasOwnProperty(h)&&(l[h]===void 0||!ue(c[h],l[h])))return!1;return!0}(n,t);default:return G(52216,{left:n})}}function ui(n,t){return(n.values||[]).find(e=>ue(e,t))!==void 0}function $n(n,t){if(n===t)return 0;let e=je(n),r=je(t);if(e!==r)return H(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return H(n.booleanValue,t.booleanValue);case 2:return function(o,c){let l=ht(o.integerValue||o.doubleValue),h=ht(c.integerValue||c.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,t);case 3:return Id(n.timestampValue,t.timestampValue);case 4:return Id(ci(n),ci(t));case 5:return $a(n.stringValue,t.stringValue);case 6:return function(o,c){let l=Ee(o),h=Ee(c);return l.compareTo(h)}(n.bytesValue,t.bytesValue);case 7:return function(o,c){let l=o.split("/"),h=c.split("/");for(let m=0;m<l.length&&m<h.length;m++){let f=H(l[m],h[m]);if(f!==0)return f}return H(l.length,h.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,c){let l=H(ht(o.latitude),ht(c.latitude));return l!==0?l:H(ht(o.longitude),ht(c.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return Cd(n.arrayValue,t.arrayValue);case 10:return function(o,c){var l,h,m,f;let v=o.fields||{},C=c.fields||{},S=(l=v[jn])===null||l===void 0?void 0:l.arrayValue,L=(h=C[jn])===null||h===void 0?void 0:h.arrayValue,B=H(((m=S?.values)===null||m===void 0?void 0:m.length)||0,((f=L?.values)===null||f===void 0?void 0:f.length)||0);return B!==0?B:Cd(S,L)}(n.mapValue,t.mapValue);case 11:return function(o,c){if(o===Is.mapValue&&c===Is.mapValue)return 0;if(o===Is.mapValue)return 1;if(c===Is.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),m=c.fields||{},f=Object.keys(m);h.sort(),f.sort();for(let v=0;v<h.length&&v<f.length;++v){let C=$a(h[v],f[v]);if(C!==0)return C;let S=$n(l[h[v]],m[f[v]]);if(S!==0)return S}return H(h.length,f.length)}(n.mapValue,t.mapValue);default:throw G(23264,{le:e})}}function Id(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return H(n,t);let e=ve(n),r=ve(t),s=H(e.seconds,r.seconds);return s!==0?s:H(e.nanos,r.nanos)}function Cd(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=$n(e[s],r[s]);if(o)return o}return H(e.length,r.length)}function Gn(n){return Wa(n)}function Wa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=ve(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Ee(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return $.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=Wa(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let c of r)o?o=!1:s+=",",s+=`${c}:${Wa(e.fields[c])}`;return s+"}"}(n.mapValue):G(61005,{value:n})}function As(n){switch(je(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=co(n);return t?16+As(t):16;case 5:return 2*n.stringValue.length;case 6:return Ee(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+As(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Ke(r.fields,(o,c)=>{s+=o.length+As(c)}),s}(n.mapValue);default:throw G(13486,{value:n})}}function Ha(n){return!!n&&"integerValue"in n}function bu(n){return!!n&&"arrayValue"in n}function bd(n){return!!n&&"nullValue"in n}function Ad(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ss(n){return!!n&&"mapValue"in n}function Sm(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Iu])===null||e===void 0?void 0:e.stringValue)===Cu}function ei(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return Ke(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ei(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ei(n.arrayValue.values[e]);return t}return Object.assign({},n)}function xm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Am}var P0={mapValue:{fields:{[Iu]:{stringValue:Cu},[jn]:{arrayValue:{}}}}};var jt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Ss(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ei(e)}setAll(t){let e=$t.emptyPath(),r={},s=[];t.forEach((c,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}c?r[l.lastSegment()]=ei(c):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());Ss(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ue(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Ss(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Ke(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(ei(this.value))}};function Dm(n){let t=[];return Ke(n.fields,(e,r)=>{let s=new $t([e]);if(Ss(r)){let o=Dm(r.mapValue).fields;if(o.length===0)t.push(s);else for(let c of o)t.push(s.child(c))}else t.push(s)}),new Wt(t)}var Zt=class n{constructor(t,e,r,s,o,c,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=c,this.documentState=l}static newInvalidDocument(t){return new n(t,0,W.min(),W.min(),W.min(),jt.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,W.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,W.min(),W.min(),jt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,W.min(),W.min(),jt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=jt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=jt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Kn=class{constructor(t,e){this.position=t,this.inclusive=e}};function Sd(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],c=n.position[s];if(o.field.isKeyField()?r=$.comparator($.fromName(c.referenceValue),e.key):r=$n(c,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function xd(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ue(n.position[e],t.position[e]))return!1;return!0}var Qn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function zg(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Fs=class{},Tt=class n extends Fs{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Ya(t,e,r):e==="array-contains"?new tc(t,r):e==="in"?new ec(t,r):e==="not-in"?new nc(t,r):e==="array-contains-any"?new rc(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Ja(t,r):new Za(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison($n(e,this.value)):e!==null&&je(this.value)===je(e)&&this.matchesComparison($n(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return G(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},le=class n extends Fs{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new n(t,e)}matches(t){return Rm(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function Rm(n){return n.op==="and"}function Pm(n){return Fg(n)&&Rm(n)}function Fg(n){for(let t of n.filters)if(t instanceof le)return!1;return!0}function Xa(n){if(n instanceof Tt)return n.field.canonicalString()+n.op.toString()+Gn(n.value);if(Pm(n))return n.filters.map(t=>Xa(t)).join(",");{let t=n.filters.map(e=>Xa(e)).join(",");return`${n.op}(${t})`}}function Nm(n,t){return n instanceof Tt?function(r,s){return s instanceof Tt&&r.op===s.op&&r.field.isEqual(s.field)&&ue(r.value,s.value)}(n,t):n instanceof le?function(r,s){return s instanceof le&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,c,l)=>o&&Nm(c,s.filters[l]),!0):!1}(n,t):void G(19439)}function Vm(n){return n instanceof Tt?function(e){return`${e.field.canonicalString()} ${e.op} ${Gn(e.value)}`}(n):n instanceof le?function(e){return e.op.toString()+" {"+e.getFilters().map(Vm).join(" ,")+"}"}(n):"Filter"}var Ya=class extends Tt{constructor(t,e,r){super(t,e,r),this.key=$.fromName(r.referenceValue)}matches(t){let e=$.comparator(t.key,this.key);return this.matchesComparison(e)}},Ja=class extends Tt{constructor(t,e){super(t,"in",e),this.keys=km("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Za=class extends Tt{constructor(t,e){super(t,"not-in",e),this.keys=km("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function km(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>$.fromName(r.referenceValue))}var tc=class extends Tt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return bu(e)&&ui(e.arrayValue,this.value)}},ec=class extends Tt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ui(this.value.arrayValue,e)}},nc=class extends Tt{constructor(t,e){super(t,"not-in",e)}matches(t){if(ui(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ui(this.value.arrayValue,e)}},rc=class extends Tt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!bu(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>ui(this.value.arrayValue,r))}};var ic=class{constructor(t,e=null,r=[],s=[],o=null,c=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=c,this.endAt=l,this.Pe=null}};function Dd(n,t=null,e=[],r=[],s=null,o=null,c=null){return new ic(n,t,e,r,s,o,c)}function Au(n){let t=K(n);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>Xa(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ao(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>Gn(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>Gn(r)).join(",")),t.Pe=e}return t.Pe}function Su(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!zg(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Nm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!xd(n.startAt,t.startAt)&&xd(n.endAt,t.endAt)}function sc(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Wn=class{constructor(t,e=null,r=[],s=[],o=null,c="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=c,this.startAt=l,this.endAt=h,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function Og(n,t,e,r,s,o,c,l){return new Wn(n,t,e,r,s,o,c,l)}function uo(n){return new Wn(n)}function Rd(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Mg(n){return n.collectionGroup!==null}function ni(n){let t=K(n);if(t.Te===null){t.Te=[];let e=new Set;for(let o of t.explicitOrderBy)t.Te.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(c){let l=new Ct($t.comparator);return c.filters.forEach(h=>{h.getFlattenedFilters().forEach(m=>{m.isInequality()&&(l=l.add(m.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.Te.push(new Qn(o,r))}),e.has($t.keyField().canonicalString())||t.Te.push(new Qn($t.keyField(),r))}return t.Te}function oe(n){let t=K(n);return t.Ie||(t.Ie=Lg(t,ni(n))),t.Ie}function Lg(n,t){if(n.limitType==="F")return Dd(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new Qn(s.field,o)});let e=n.endAt?new Kn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Kn(n.startAt.position,n.startAt.inclusive):null;return Dd(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function oc(n,t,e){return new Wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function lo(n,t){return Su(oe(n),oe(t))&&n.limitType===t.limitType}function zm(n){return`${Au(oe(n))}|lt:${n.limitType}`}function Fn(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>Vm(s)).join(", ")}]`),ao(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(c){return`${c.field.canonicalString()} (${c.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>Gn(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>Gn(s)).join(",")),`Target(${r})`}(oe(n))}; limitType=${n.limitType})`}function ho(n,t){return t.isFoundDocument()&&function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):$.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,s){for(let o of ni(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(c,l,h){let m=Sd(c,l,h);return c.inclusive?m<=0:m<0}(r.startAt,ni(r),s)||r.endAt&&!function(c,l,h){let m=Sd(c,l,h);return c.inclusive?m>=0:m>0}(r.endAt,ni(r),s))}(n,t)}function Bg(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Fm(n){return(t,e)=>{let r=!1;for(let s of ni(n)){let o=qg(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function qg(n,t,e){let r=n.field.isKeyField()?$.comparator(t.key,e.key):function(o,c,l){let h=c.data.field(o),m=l.data.field(o);return h!==null&&m!==null?$n(h,m):G(42886)}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G(19790,{direction:n.dir})}}var we=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Ke(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return wm(this.inner)}size(){return this.innerSize}};var Ug=new ft($.comparator);function Te(){return Ug}var Om=new ft($.comparator);function ti(...n){let t=Om;for(let e of n)t=t.insert(e.key,e);return t}function Mm(n){let t=Om;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Ze(){return ri()}function Lm(){return ri()}function ri(){return new we(n=>n.toString(),(n,t)=>n.isEqual(t))}var jg=new ft($.comparator),$g=new Ct($.comparator);function J(...n){let t=$g;for(let e of n)t=t.add(e);return t}var Gg=new Ct(H);function Kg(){return Gg}function xu(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ai(t)?"-0":t}}function Bm(n){return{integerValue:""+n}}function Qg(n,t){return wg(t)?Bm(t):xu(n,t)}var Hn=class{constructor(){this._=void 0}};function Wg(n,t,e){return n instanceof Xn?function(s,o){let c={fields:{[Im]:{stringValue:Tm},[bm]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Tu(o)&&(o=co(o)),o&&(c.fields[Cm]=o),{mapValue:c}}(e,t):n instanceof an?Um(n,t):n instanceof cn?jm(n,t):function(s,o){let c=qm(s,o),l=Pd(c)+Pd(s.Ee);return Ha(c)&&Ha(s.Ee)?Bm(l):xu(s.serializer,l)}(n,t)}function Hg(n,t,e){return n instanceof an?Um(n,t):n instanceof cn?jm(n,t):e}function qm(n,t){return n instanceof Yn?function(r){return Ha(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}var Xn=class extends Hn{},an=class extends Hn{constructor(t){super(),this.elements=t}};function Um(n,t){let e=$m(t);for(let r of n.elements)e.some(s=>ue(s,r))||e.push(r);return{arrayValue:{values:e}}}var cn=class extends Hn{constructor(t){super(),this.elements=t}};function jm(n,t){let e=$m(t);for(let r of n.elements)e=e.filter(s=>!ue(s,r));return{arrayValue:{values:e}}}var Yn=class extends Hn{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function Pd(n){return ht(n.integerValue||n.doubleValue)}function $m(n){return bu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Xg(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof an&&s instanceof an||r instanceof cn&&s instanceof cn?Un(r.elements,s.elements,ue):r instanceof Yn&&s instanceof Yn?ue(r.Ee,s.Ee):r instanceof Xn&&s instanceof Xn}(n.transform,t.transform)}var ac=class{constructor(t,e){this.version=t,this.transformResults=e}},ae=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function xs(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Jn=class{};function Gm(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new li(n.key,ae.none()):new un(n.key,n.data,ae.none());{let e=n.data,r=jt.empty(),s=new Ct($t.comparator);for(let o of t.fields)if(!s.has(o)){let c=e.field(o);c===null&&o.length>1&&(o=o.popLast(),c=e.field(o)),c===null?r.delete(o):r.set(o,c),s=s.add(o)}return new he(n.key,r,new Wt(s.toArray()),ae.none())}}function Yg(n,t,e){n instanceof un?function(s,o,c){let l=s.value.clone(),h=Vd(s.fieldTransforms,o,c.transformResults);l.setAll(h),o.convertToFoundDocument(c.version,l).setHasCommittedMutations()}(n,t,e):n instanceof he?function(s,o,c){if(!xs(s.precondition,o))return void o.convertToUnknownDocument(c.version);let l=Vd(s.fieldTransforms,o,c.transformResults),h=o.data;h.setAll(Km(s)),h.setAll(l),o.convertToFoundDocument(c.version,h).setHasCommittedMutations()}(n,t,e):function(s,o,c){o.convertToNoDocument(c.version).setHasCommittedMutations()}(0,t,e)}function ii(n,t,e,r){return n instanceof un?function(o,c,l,h){if(!xs(o.precondition,c))return l;let m=o.value.clone(),f=kd(o.fieldTransforms,h,c);return m.setAll(f),c.convertToFoundDocument(c.version,m).setHasLocalMutations(),null}(n,t,e,r):n instanceof he?function(o,c,l,h){if(!xs(o.precondition,c))return l;let m=kd(o.fieldTransforms,h,c),f=c.data;return f.setAll(Km(o)),f.setAll(m),c.convertToFoundDocument(c.version,f).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(v=>v.field))}(n,t,e,r):function(o,c,l){return xs(o.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):l}(n,t,e)}function Jg(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),o=qm(r.transform,s||null);o!=null&&(e===null&&(e=jt.empty()),e.set(r.field,o))}return e||null}function Nd(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Un(r,s,(o,c)=>Xg(o,c))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var un=class extends Jn{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},he=class extends Jn{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Km(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Vd(n,t,e){let r=new Map;it(n.length===e.length,32656,{Ae:e.length,Re:n.length});for(let s=0;s<e.length;s++){let o=n[s],c=o.transform,l=t.data.field(o.field);r.set(o.field,Hg(c,l,e[s]))}return r}function kd(n,t,e){let r=new Map;for(let s of n){let o=s.transform,c=e.data.field(s.field);r.set(s.field,Wg(o,c,t))}return r}var li=class extends Jn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},cc=class extends Jn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var uc=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&Yg(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=ii(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=ii(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Lm();return this.mutations.forEach(s=>{let o=t.get(s.key),c=o.overlayedDocument,l=this.applyToLocalView(c,o.mutatedFields);l=e.has(s.key)?null:l;let h=Gm(c,l);h!==null&&r.set(s.key,h),c.isValidDocument()||c.convertToNoDocument(W.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),J())}isEqual(t){return this.batchId===t.batchId&&Un(this.mutations,t.mutations,(e,r)=>Nd(e,r))&&Un(this.baseMutations,t.baseMutations,(e,r)=>Nd(e,r))}},lc=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){it(t.mutations.length===r.length,58842,{Ve:t.mutations.length,me:r.length});let s=function(){return jg}(),o=t.mutations;for(let c=0;c<o.length;c++)s=s.insert(o[c].key,r[c].version);return new n(t,e,r,s)}};var hc=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var dc=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var gt,tt;function Zg(n){switch(n){case A.OK:return G(64938);case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return G(15467,{code:n})}}function Qm(n){if(n===void 0)return _e("GRPC error has no .code"),A.UNKNOWN;switch(n){case gt.OK:return A.OK;case gt.CANCELLED:return A.CANCELLED;case gt.UNKNOWN:return A.UNKNOWN;case gt.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case gt.INTERNAL:return A.INTERNAL;case gt.UNAVAILABLE:return A.UNAVAILABLE;case gt.UNAUTHENTICATED:return A.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case gt.NOT_FOUND:return A.NOT_FOUND;case gt.ALREADY_EXISTS:return A.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return A.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case gt.ABORTED:return A.ABORTED;case gt.OUT_OF_RANGE:return A.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return A.UNIMPLEMENTED;case gt.DATA_LOSS:return A.DATA_LOSS;default:return G(39323,{code:n})}}(tt=gt||(gt={}))[tt.OK=0]="OK",tt[tt.CANCELLED=1]="CANCELLED",tt[tt.UNKNOWN=2]="UNKNOWN",tt[tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tt[tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tt[tt.NOT_FOUND=5]="NOT_FOUND",tt[tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",tt[tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",tt[tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",tt[tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tt[tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tt[tt.ABORTED=10]="ABORTED",tt[tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",tt[tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",tt[tt.INTERNAL=13]="INTERNAL",tt[tt.UNAVAILABLE=14]="UNAVAILABLE",tt[tt.DATA_LOSS=15]="DATA_LOSS";var zd=null;var ty=new ge([4294967295,4294967295],0);function Fd(n){let t=im().encode(n),e=new xa;return e.update(t),new Uint8Array(e.digest())}function Od(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new ge([e,r],0),new ge([s,o],0)]}var mc=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new tn(`Invalid padding: ${e}`);if(r<0)throw new tn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new tn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new tn(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=ge.fromNumber(this.fe)}pe(t,e,r){let s=t.add(e.multiply(ge.fromNumber(r)));return s.compare(ty)===1&&(s=new ge([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=Fd(t),[r,s]=Od(e);for(let o=0;o<this.hashCount;o++){let c=this.pe(r,s,o);if(!this.ye(c))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),c=new n(o,s,e);return r.forEach(l=>c.insert(l)),c}insert(t){if(this.fe===0)return;let e=Fd(t),[r,s]=Od(e);for(let o=0;o<this.hashCount;o++){let c=this.pe(r,s,o);this.we(c)}}we(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},tn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Os=class n{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,hi.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(W.min(),s,new ft(H),Te(),J())}},hi=class n{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,J(),J(),J())}};var Bn=class{constructor(t,e,r,s){this.Se=t,this.removedTargetIds=e,this.key=r,this.be=s}},Ms=class{constructor(t,e){this.targetId=t,this.De=e}},Ls=class{constructor(t,e,r=kt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},Bs=class{constructor(){this.ve=0,this.Ce=Md(),this.Fe=kt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=J(),e=J(),r=J();return this.Ce.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:G(38017,{changeType:o})}}),new hi(this.Fe,this.Me,t,e,r)}ke(){this.xe=!1,this.Ce=Md()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,it(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},pc=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=Te(),this.je=Cs(),this.Je=Cs(),this.He=new ft(H)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let r=this.tt(e);switch(t.state){case 0:this.nt(e)&&r.Be(t.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(t.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(r.Ke(),r.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),r.Be(t.resumeToken));break;default:G(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((r,s)=>{this.nt(s)&&e(s)})}it(t){let e=t.targetId,r=t.De.count,s=this.st(e);if(s){let o=s.target;if(sc(o))if(r===0){let c=new $(o.path);this.Xe(e,c,Zt.newNoDocument(c,W.min()))}else it(r===1,20013,{expectedCount:r});else{let c=this.ot(e);if(c!==r){let l=this._t(t),h=l?this.ut(l,t,c):1;if(h!==0){this.rt(e);let m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,m)}zd?.ct(function(f,v,C,S,L){var B,M,U,P,N,X;let xt={localCacheCount:f,existenceFilterCount:v.count,databaseId:C.database,projectId:C.projectId},st=v.unchangedNames;return st&&(xt.bloomFilter={applied:L===0,hashCount:(B=st?.hashCount)!==null&&B!==void 0?B:0,bitmapLength:(P=(U=(M=st?.bits)===null||M===void 0?void 0:M.bitmap)===null||U===void 0?void 0:U.length)!==null&&P!==void 0?P:0,padding:(X=(N=st?.bits)===null||N===void 0?void 0:N.padding)!==null&&X!==void 0?X:0,mightContain:E=>{var p;return(p=S?.mightContain(E))!==null&&p!==void 0&&p}}),xt}(c,t.De,this.We.lt(),l,h))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e,c,l;try{c=Ee(r).toUint8Array()}catch(h){if(h instanceof Vs)return Ue("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new mc(c,s,o)}catch(h){return Ue(h instanceof tn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.fe===0?null:l}ut(t,e,r){return e.De.count===r-this.ht(t,e.targetId)?0:2}ht(t,e){let r=this.We.getRemoteKeysForTarget(e),s=0;return r.forEach(o=>{let c=this.We.lt(),l=`projects/${c.projectId}/databases/${c.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.Xe(e,o,null),s++)}),s}Pt(t){let e=new Map;this.Ge.forEach((o,c)=>{let l=this.st(c);if(l){if(o.current&&sc(l.target)){let h=new $(l.target.path);this.Tt(h).has(c)||this.It(c,h)||this.Xe(c,h,Zt.newNoDocument(h,t))}o.Ne&&(e.set(c,o.Le()),o.ke())}});let r=J();this.Je.forEach((o,c)=>{let l=!0;c.forEachWhile(h=>{let m=this.st(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.ze.forEach((o,c)=>c.setReadTime(t));let s=new Os(t,e,this.He,this.ze,r);return this.ze=Te(),this.je=Cs(),this.Je=Cs(),this.He=new ft(H),s}Ze(t,e){if(!this.nt(t))return;let r=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,r),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,r){if(!this.nt(t))return;let s=this.tt(t);this.It(t,e)?s.qe(e,1):s.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),r&&(this.ze=this.ze.insert(e,r))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new Bs,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new Ct(H),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new Ct(H),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||q("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new Bs),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function Cs(){return new ft($.comparator)}function Md(){return new ft($.comparator)}var ey={asc:"ASCENDING",desc:"DESCENDING"},ny={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ry={and:"AND",or:"OR"},fc=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function gc(n,t){return n.useProto3Json||ao(t)?t:{value:t}}function qs(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Wm(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function iy(n,t){return qs(n,t.toTimestamp())}function ce(n){return it(!!n,49232),W.fromTimestamp(function(e){let r=ve(e);return new vt(r.seconds,r.nanos)}(n))}function Du(n,t){return yc(n,t).canonicalString()}function yc(n,t){let e=function(s){return new dt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Hm(n){let t=dt.fromString(n);return it(tp(t),10190,{key:t.toString()}),t}function _c(n,t){return Du(n.databaseId,t.path)}function ka(n,t){let e=Hm(t);if(e.get(1)!==n.databaseId.projectId)throw new j(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new j(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new $(Ym(e))}function Xm(n,t){return Du(n.databaseId,t)}function sy(n){let t=Hm(n);return t.length===4?dt.emptyPath():Ym(t)}function vc(n){return new dt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ym(n){return it(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Ld(n,t,e){return{name:_c(n,t),fields:e.value.mapValue.fields}}function oy(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:G(39313,{state:m})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=function(m,f){return m.useProto3Json?(it(f===void 0||typeof f=="string",58123),kt.fromBase64String(f||"")):(it(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),kt.fromUint8Array(f||new Uint8Array))}(n,t.targetChange.resumeToken),c=t.targetChange.cause,l=c&&function(m){let f=m.code===void 0?A.UNKNOWN:Qm(m.code);return new j(f,m.message||"")}(c);e=new Ls(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=ka(n,r.document.name),o=ce(r.document.updateTime),c=r.document.createTime?ce(r.document.createTime):W.min(),l=new jt({mapValue:{fields:r.document.fields}}),h=Zt.newFoundDocument(s,o,c,l),m=r.targetIds||[],f=r.removedTargetIds||[];e=new Bn(m,f,h.key,h)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=ka(n,r.document),o=r.readTime?ce(r.readTime):W.min(),c=Zt.newNoDocument(s,o),l=r.removedTargetIds||[];e=new Bn([],l,c.key,c)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=ka(n,r.document),o=r.removedTargetIds||[];e=new Bn([],o,s,null)}else{if(!("filter"in t))return G(11601,{At:t});{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:o}=r,c=new dc(s,o),l=r.targetId;e=new Ms(l,c)}}return e}function ay(n,t){let e;if(t instanceof un)e={update:Ld(n,t.key,t.value)};else if(t instanceof li)e={delete:_c(n,t.key)};else if(t instanceof he)e={update:Ld(n,t.key,t.data),updateMask:gy(t.fieldMask)};else{if(!(t instanceof cc))return G(16599,{Rt:t.type});e={verify:_c(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,c){let l=c.transform;if(l instanceof Xn)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof an)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof cn)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Yn)return{fieldPath:c.field.canonicalString(),increment:l.Ee};throw G(20930,{transform:c.transform})}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:iy(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:G(27497)}(n,t.precondition)),e}function cy(n,t){return n&&n.length>0?(it(t!==void 0,14353),n.map(e=>function(s,o){let c=s.updateTime?ce(s.updateTime):ce(o);return c.isEqual(W.min())&&(c=ce(o)),new ac(c,s.transformResults||[])}(e,t))):[]}function uy(n,t){return{documents:[Xm(n,t.path)]}}function ly(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Xm(n,s);let o=function(m){if(m.length!==0)return Zm(le.create(m,"and"))}(t.filters);o&&(e.structuredQuery.where=o);let c=function(m){if(m.length!==0)return m.map(f=>function(C){return{field:On(C.field),direction:my(C.dir)}}(f))}(t.orderBy);c&&(e.structuredQuery.orderBy=c);let l=gc(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(t.endAt)),{Vt:e,parent:s}}function hy(n){let t=sy(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){it(r===1,65062);let f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let o=[];e.where&&(o=function(v){let C=Jm(v);return C instanceof le&&Pm(C)?C.getFilters():[C]}(e.where));let c=[];e.orderBy&&(c=function(v){return v.map(C=>function(L){return new Qn(Mn(L.field),function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(C))}(e.orderBy));let l=null;e.limit&&(l=function(v){let C;return C=typeof v=="object"?v.value:v,ao(C)?null:C}(e.limit));let h=null;e.startAt&&(h=function(v){let C=!!v.before,S=v.values||[];return new Kn(S,C)}(e.startAt));let m=null;return e.endAt&&(m=function(v){let C=!v.before,S=v.values||[];return new Kn(S,C)}(e.endAt)),Og(t,s,c,o,l,"F",h,m)}function dy(n,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Jm(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Mn(e.unaryFilter.field);return Tt.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Mn(e.unaryFilter.field);return Tt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Mn(e.unaryFilter.field);return Tt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let c=Mn(e.unaryFilter.field);return Tt.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G(61313);default:return G(60726)}}(n):n.fieldFilter!==void 0?function(e){return Tt.create(Mn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G(58110);default:return G(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return le.create(e.compositeFilter.filters.map(r=>Jm(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return G(1026)}}(e.compositeFilter.op))}(n):G(30097,{filter:n})}function my(n){return ey[n]}function py(n){return ny[n]}function fy(n){return ry[n]}function On(n){return{fieldPath:n.canonicalString()}}function Mn(n){return $t.fromServerFormat(n.fieldPath)}function Zm(n){return n instanceof Tt?function(e){if(e.op==="=="){if(Ad(e.value))return{unaryFilter:{field:On(e.field),op:"IS_NAN"}};if(bd(e.value))return{unaryFilter:{field:On(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ad(e.value))return{unaryFilter:{field:On(e.field),op:"IS_NOT_NAN"}};if(bd(e.value))return{unaryFilter:{field:On(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:On(e.field),op:py(e.op),value:e.value}}}(n):n instanceof le?function(e){let r=e.getFilters().map(s=>Zm(s));return r.length===1?r[0]:{compositeFilter:{op:fy(e.op),filters:r}}}(n):G(54877,{filter:n})}function gy(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function tp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var di=class n{constructor(t,e,r,s,o=W.min(),c=W.min(),l=kt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Ec=class{constructor(t){this.gt=t}};function yy(n){let t=hy({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?oc(t,t.limit,"L"):t}var Us=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(ht(t.integerValue));else if("doubleValue"in t){let r=ht(t.doubleValue);isNaN(r)?this.Ct(e,13):(this.Ct(e,15),ai(r)?e.Ft(0):e.Ft(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Ct(e,20),typeof r=="string"&&(r=ve(r)),e.Mt(`${r.seconds||""}`),e.Ft(r.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(Ee(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Ct(e,45),e.Ft(r.latitude||0),e.Ft(r.longitude||0)}else"mapValue"in t?xm(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):Sm(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):G(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let r=t.fields||{};this.Ct(e,55);for(let s of Object.keys(r))this.xt(s,e),this.Dt(r[s],e)}Lt(t,e){var r,s;let o=t.fields||{};this.Ct(e,53);let c=jn,l=((s=(r=o[c].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.Ct(e,15),e.Ft(ht(l)),this.xt(c,e),this.Dt(o[c],e)}qt(t,e){let r=t.values||[];this.Ct(e,50);for(let s of r)this.Dt(s,e)}Bt(t,e){this.Ct(e,37),$.fromName(t).path.forEach(r=>{this.Ct(e,60),this.$t(r,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};Us.Ut=new Us;var wc=class{constructor(){this.Dn=new Tc}addToCollectionParentIndex(t,e){return this.Dn.add(e),x.resolve()}getCollectionParents(t,e){return x.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return x.resolve()}deleteFieldIndex(t,e){return x.resolve()}deleteAllFieldIndexes(t){return x.resolve()}createTargetIndexes(t,e){return x.resolve()}getDocumentsMatchingTarget(t,e){return x.resolve(null)}getIndexType(t,e){return x.resolve(0)}getFieldIndexes(t,e){return x.resolve([])}getNextCollectionGroupToUpdate(t){return x.resolve(null)}getMinOffset(t,e){return x.resolve(on.min())}getMinOffsetFromCollectionGroup(t,e){return x.resolve(on.min())}updateCollectionGroup(t,e,r){return x.resolve()}updateIndexEntries(t,e){return x.resolve()}},Tc=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new Ct(dt.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new Ct(dt.comparator)).toArray()}};var N0=new Uint8Array(0);var Bd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ep=41943040,Qt=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};Qt.DEFAULT_COLLECTION_PERCENTILE=10,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qt.DEFAULT=new Qt(ep,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qt.DISABLED=new Qt(-1,0,0);var mi=class n{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var qd="LruGarbageCollector",_y=1048576;function Ud([n,t],[e,r]){let s=H(n,e);return s===0?H(t,r):s}var Ic=class{constructor(t){this.Tr=t,this.buffer=new Ct(Ud),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Ud(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},Cc=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){q(qd,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){ir(e)?q(qd,"Ignoring IndexedDB error during garbage collection: ",e):yield rr(e)}yield this.Rr(3e5)}))}},bc=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return x.resolve(Eu.ue);let r=new Ic(e);return this.Vr.forEachTarget(t,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.gr(t,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.Vr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),x.resolve(Bd)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bd):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let r,s,o,c,l,h,m,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(v=>(v>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,c=Date.now(),this.nthSequenceNumber(t,s))).next(v=>(r=v,l=Date.now(),this.removeTargets(t,r,e))).next(v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(v=>(m=Date.now(),zn()<=re.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-f}ms
	Determined least recently used ${s} in `+(l-c)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${v} documents in `+(m-h)+`ms
Total Duration: ${m-f}ms`),x.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v})))}};function vy(n,t){return new bc(n,t)}var Ac=class{constructor(){this.changes=new we(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Zt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?x.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Sc=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var xc=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&ii(r.mutation,s,Wt.empty(),vt.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,J()).next(()=>r))}getLocalViewOfDocuments(t,e,r=J()){let s=Ze();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let c=ti();return o.forEach((l,h)=>{c=c.insert(l,h.overlayedDocument)}),c}))}getOverlayedDocuments(t,e){let r=Ze();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,J()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((c,l)=>{e.set(c,l)})})}computeViews(t,e,r,s){let o=Te(),c=ri(),l=function(){return ri()}();return e.forEach((h,m)=>{let f=r.get(m.key);s.has(m.key)&&(f===void 0||f.mutation instanceof he)?o=o.insert(m.key,m):f!==void 0?(c.set(m.key,f.mutation.getFieldMask()),ii(f.mutation,m,f.mutation.getFieldMask(),vt.now())):c.set(m.key,Wt.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((m,f)=>c.set(m,f)),e.forEach((m,f)=>{var v;return l.set(m,new Sc(f,(v=c.get(m))!==null&&v!==void 0?v:null))}),l))}recalculateAndSaveOverlays(t,e){let r=ri(),s=new ft((c,l)=>c-l),o=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(c=>{for(let l of c)l.keys().forEach(h=>{let m=e.get(h);if(m===null)return;let f=r.get(h)||Wt.empty();f=l.applyToLocalView(m,f),r.set(h,f);let v=(s.get(l.batchId)||J()).add(h);s=s.insert(l.batchId,v)})}).next(()=>{let c=[],l=s.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),m=h.key,f=h.value,v=Lm();f.forEach(C=>{if(!o.has(C)){let S=Gm(e.get(C),r.get(C));S!==null&&v.set(C,S),o=o.add(C)}}),c.push(this.documentOverlayCache.saveOverlays(t,m,v))}return x.waitFor(c)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(c){return $.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Mg(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let c=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):x.resolve(Ze()),l=oi,h=o;return c.next(m=>x.forEach(m,(f,v)=>(l<v.largestBatchId&&(l=v.largestBatchId),o.get(f)?x.resolve():this.remoteDocumentCache.getEntry(t,f).next(C=>{h=h.insert(f,C)}))).next(()=>this.populateOverlays(t,m,o)).next(()=>this.computeViews(t,h,m,J())).next(f=>({batchId:l,changes:Mm(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new $(e)).next(r=>{let s=ti();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,c=ti();return this.indexManager.getCollectionParents(t,o).next(l=>x.forEach(l,h=>{let m=function(v,C){return new Wn(C,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)}(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,m,r,s).next(f=>{f.forEach((v,C)=>{c=c.insert(v,C)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(c=>(o=c,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(c=>{o.forEach((h,m)=>{let f=m.getKey();c.get(f)===null&&(c=c.insert(f,Zt.newInvalidDocument(f)))});let l=ti();return c.forEach((h,m)=>{let f=o.get(h);f!==void 0&&ii(f.mutation,m,Wt.empty(),vt.now()),ho(e,m)&&(l=l.insert(h,m))}),l})}};var Dc=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return x.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,function(s){return{id:s.id,version:s.version,createTime:ce(s.createTime)}}(e)),x.resolve()}getNamedQuery(t,e){return x.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,function(s){return{name:s.name,query:yy(s.bundledQuery),readTime:ce(s.readTime)}}(e)),x.resolve()}};var Rc=class{constructor(){this.overlays=new ft($.comparator),this.kr=new Map}getOverlay(t,e){return x.resolve(this.overlays.get(e))}getOverlays(t,e){let r=Ze();return x.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.wt(t,e,o)}),x.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.kr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.kr.delete(r)),x.resolve()}getOverlaysForCollection(t,e,r){let s=Ze(),o=e.length+1,c=new $(e.child("")),l=this.overlays.getIteratorFrom(c);for(;l.hasNext();){let h=l.getNext().value,m=h.getKey();if(!e.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return x.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new ft((m,f)=>m-f),c=this.overlays.getIterator();for(;c.hasNext();){let m=c.getNext().value;if(m.getKey().getCollectionGroup()===e&&m.largestBatchId>r){let f=o.get(m.largestBatchId);f===null&&(f=Ze(),o=o.insert(m.largestBatchId,f)),f.set(m.getKey(),m)}}let l=Ze(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((m,f)=>l.set(m,f)),!(l.size()>=s)););return x.resolve(l)}wt(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let c=this.kr.get(s.largestBatchId).delete(r.key);this.kr.set(s.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new hc(e,r));let o=this.kr.get(e);o===void 0&&(o=J(),this.kr.set(e,o)),this.kr.set(e,o.add(r.key))}};var Pc=class{constructor(){this.sessionToken=kt.EMPTY_BYTE_STRING}getSessionToken(t){return x.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,x.resolve()}};var pi=class{constructor(){this.qr=new Ct(yt.Qr),this.$r=new Ct(yt.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let r=new yt(t,e);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Wr(new yt(t,e))}Gr(t,e){t.forEach(r=>this.removeReference(r,e))}zr(t){let e=new $(new dt([])),r=new yt(e,t),s=new yt(e,t+1),o=[];return this.$r.forEachInRange([r,s],c=>{this.Wr(c),o.push(c.key)}),o}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new $(new dt([])),r=new yt(e,t),s=new yt(e,t+1),o=J();return this.$r.forEachInRange([r,s],c=>{o=o.add(c.key)}),o}containsKey(t){let e=new yt(t,0),r=this.qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},yt=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return $.comparator(t.key,e.key)||H(t.Hr,e.Hr)}static Ur(t,e){return H(t.Hr,e.Hr)||$.comparator(t.key,e.key)}};var Nc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new Ct(yt.Qr)}checkEmpty(t){return x.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let c=new uc(o,e,r,s);this.mutationQueue.push(c);for(let l of s)this.Yr=this.Yr.add(new yt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return x.resolve(c)}lookupMutationBatch(t,e){return x.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.Xr(r),o=s<0?0:s;return x.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(this.mutationQueue.length===0?wu:this.er-1)}getAllMutationBatches(t){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new yt(e,0),s=new yt(e,Number.POSITIVE_INFINITY),o=[];return this.Yr.forEachInRange([r,s],c=>{let l=this.Zr(c.Hr);o.push(l)}),x.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Ct(H);return e.forEach(s=>{let o=new yt(s,0),c=new yt(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([o,c],l=>{r=r.add(l.Hr)})}),x.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;$.isDocumentKey(o)||(o=o.child(""));let c=new yt(new $(o),0),l=new Ct(H);return this.Yr.forEachWhile(h=>{let m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===s&&(l=l.add(h.Hr)),!0)},c),x.resolve(this.ei(l))}ei(t){let e=[];return t.forEach(r=>{let s=this.Zr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){it(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return x.forEach(e.mutations,s=>{let o=new yt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Yr=r})}rr(t){}containsKey(t,e){let r=new yt(e,0),s=this.Yr.firstAfterOrEqual(r);return x.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,x.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Vc=class{constructor(t){this.ni=t,this.docs=function(){return new ft($.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,c=this.ni(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:c}),this.size+=c-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return x.resolve(r?r.document.mutableCopy():Zt.newInvalidDocument(e))}getEntries(t,e){let r=Te();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Zt.newInvalidDocument(s))}),x.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Te(),c=e.path,l=new $(c.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:m,value:{document:f}}=h.getNext();if(!c.isPrefixOf(m.path))break;m.path.length>c.length+1||_g(yg(f),r)<=0||(s.has(f.key)||ho(e,f))&&(o=o.insert(f.key,f.mutableCopy()))}return x.resolve(o)}getAllFromCollectionGroup(t,e,r,s){G(9500)}ri(t,e){return x.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new kc(this)}getSize(t){return x.resolve(this.size)}},kc=class extends Ac{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Or.addEntry(t,s)):this.Or.removeEntry(r)}),x.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var zc=class{constructor(t){this.persistence=t,this.ii=new we(e=>Au(e),Su),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.si=0,this.oi=new pi,this.targetCount=0,this._i=mi.ar()}forEachTarget(t,e){return this.ii.forEach((r,s)=>e(s)),x.resolve()}getLastRemoteSnapshotVersion(t){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return x.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.si&&(this.si=e),x.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new mi(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,x.resolve()}updateTargetData(t,e){return this.hr(e),x.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,x.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.ii.forEach((c,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.ii.delete(c),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),x.waitFor(o).next(()=>s)}getTargetCount(t){return x.resolve(this.targetCount)}getTargetData(t,e){let r=this.ii.get(e)||null;return x.resolve(r)}addMatchingKeys(t,e,r){return this.oi.Kr(e,r),x.resolve()}removeMatchingKeys(t,e,r){this.oi.Gr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(c=>{o.push(s.markPotentiallyOrphaned(t,c))}),x.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),x.resolve()}getMatchingKeysForTargetId(t,e){let r=this.oi.Jr(e);return x.resolve(r)}containsKey(t,e){return x.resolve(this.oi.containsKey(e))}};var js=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new Eu(0),this.ci=!1,this.ci=!0,this.li=new Pc,this.referenceDelegate=t(this),this.hi=new zc(this),this.indexManager=new wc,this.remoteDocumentCache=function(s){return new Vc(s)}(r=>this.referenceDelegate.Pi(r)),this.serializer=new Ec(e),this.Ti=new Dc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Rc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ai[t.toKey()];return r||(r=new Nc(e,this.referenceDelegate),this.ai[t.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,r){q("MemoryPersistence","Starting transaction:",t);let s=new Fc(this.ui.next());return this.referenceDelegate.Ii(),r(s).next(o=>this.referenceDelegate.di(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ei(t,e){return x.or(Object.values(this.ai).map(r=>()=>r.containsKey(t,e)))}},Fc=class extends Ka{constructor(t){super(),this.currentSequenceNumber=t}},Oc=class n{constructor(t){this.persistence=t,this.Ai=new pi,this.Ri=null}static Vi(t){return new n(t)}get mi(){if(this.Ri)return this.Ri;throw G(60996)}addReference(t,e,r){return this.Ai.addReference(r,e),this.mi.delete(r.toString()),x.resolve()}removeReference(t,e,r){return this.Ai.removeReference(r,e),this.mi.add(r.toString()),x.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),x.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(s=>this.mi.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.mi.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.mi,r=>{let s=$.fromPath(r);return this.fi(t,s).next(o=>{o||e.removeEntry(s,W.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(r=>{r?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return x.or([()=>x.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},$s=class n{constructor(t,e){this.persistence=t,this.gi=new we(r=>Tg(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=vy(this,e)}static Vi(t,e){return new n(t,e)}Ii(){}di(t){return x.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}yr(t){let e=0;return this.gr(t,r=>{e++}).next(()=>e)}gr(t,e){return x.forEach(this.gi,(r,s)=>this.Sr(t,r,s).next(o=>o?x.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ri(t,c=>this.Sr(t,c,e).next(l=>{l||(r++,o.removeEntry(c,W.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),x.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.gi.set(r,t.currentSequenceNumber),x.resolve()}removeReference(t,e,r){return this.gi.set(r,t.currentSequenceNumber),x.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),x.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=As(t.data.value)),e}Sr(t,e,r){return x.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.gi.get(e);return x.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Mc=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Is=r,this.ds=s}static Es(t,e){let r=J(),s=J();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var Lc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Bc=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Rh()?8:Eg(Dh())>0?6:4}()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.ps(t,e).next(c=>{o.result=c}).next(()=>{if(!o.result)return this.ys(t,e,s,r).next(c=>{o.result=c})}).next(()=>{if(o.result)return;let c=new Lc;return this.ws(t,e,c).next(l=>{if(o.result=l,this.Rs)return this.Ss(t,e,c,l.size)})}).next(()=>o.result)}Ss(t,e,r,s){return r.documentReadCount<this.Vs?(zn()<=re.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",Fn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),x.resolve()):(zn()<=re.DEBUG&&q("QueryEngine","Query:",Fn(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.fs*s?(zn()<=re.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",Fn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,oe(e))):x.resolve())}ps(t,e){if(Rd(e))return x.resolve(null);let r=oe(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=oc(e,null,"F"),r=oe(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let c=J(...o);return this.gs.getDocuments(t,c).next(l=>this.indexManager.getMinOffset(t,r).next(h=>{let m=this.bs(e,l);return this.Ds(e,m,c,h.readTime)?this.ps(t,oc(e,null,"F")):this.vs(t,m,e,h)}))})))}ys(t,e,r,s){return Rd(e)||s.isEqual(W.min())?x.resolve(null):this.gs.getDocuments(t,r).next(o=>{let c=this.bs(e,o);return this.Ds(e,c,r,s)?x.resolve(null):(zn()<=re.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Fn(e)),this.vs(t,c,e,gg(s,oi)).next(l=>l))})}bs(t,e){let r=new Ct(Fm(t));return e.forEach((s,o)=>{ho(t,o)&&(r=r.add(o))}),r}Ds(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ws(t,e,r){return zn()<=re.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",Fn(e)),this.gs.getDocumentsMatchingQuery(t,e,on.min(),r)}vs(t,e,r,s){return this.gs.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(c=>{o=o.insert(c.key,c)}),o))}};var Ru="LocalStore",Ey=3e8,qc=class{constructor(t,e,r,s){this.persistence=t,this.Cs=e,this.serializer=s,this.Fs=new ft(H),this.Ms=new we(o=>Au(o),Su),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(r)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new xc(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function wy(n,t,e,r){return new qc(n,t,e,r)}function np(n,t){return V(this,null,function*(){let e=K(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.Ns(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let c=[],l=[],h=J();for(let m of s){c.push(m.batchId);for(let f of m.mutations)h=h.add(f.key)}for(let m of o){l.push(m.batchId);for(let f of m.mutations)h=h.add(f.key)}return e.localDocuments.getDocuments(r,h).next(m=>({Bs:m,removedBatchIds:c,addedBatchIds:l}))})})})}function Ty(n,t){let e=K(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),o=e.Os.newChangeBuffer({trackRemovals:!0});return function(l,h,m,f){let v=m.batch,C=v.keys(),S=x.resolve();return C.forEach(L=>{S=S.next(()=>f.getEntry(h,L)).next(B=>{let M=m.docVersions.get(L);it(M!==null,48541),B.version.compareTo(M)<0&&(v.applyToRemoteDocument(B,m),B.isValidDocument()&&(B.setReadTime(m.commitVersion),f.addEntry(B)))})}),S.next(()=>l.mutationQueue.removeMutationBatch(h,v))}(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=J();for(let m=0;m<l.mutationResults.length;++m)l.mutationResults[m].transformResults.length>0&&(h=h.add(l.batch.mutations[m].key));return h}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function rp(n){let t=K(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function Iy(n,t){let e=K(n),r=t.snapshotVersion,s=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let c=e.Os.newChangeBuffer({trackRemovals:!0});s=e.Fs;let l=[];t.targetChanges.forEach((f,v)=>{let C=s.get(v);if(!C)return;l.push(e.hi.removeMatchingKeys(o,f.removedDocuments,v).next(()=>e.hi.addMatchingKeys(o,f.addedDocuments,v)));let S=C.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(v)!==null?S=S.withResumeToken(kt.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,r)),s=s.insert(v,S),function(B,M,U){return B.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=Ey?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(C,S,f)&&l.push(e.hi.updateTargetData(o,S))});let h=Te(),m=J();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,f))}),l.push(Cy(o,c,t.documentUpdates).next(f=>{h=f.Ls,m=f.ks})),!r.isEqual(W.min())){let f=e.hi.getLastRemoteSnapshotVersion(o).next(v=>e.hi.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(f)}return x.waitFor(l).next(()=>c.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,m)).next(()=>h)}).then(o=>(e.Fs=s,o))}function Cy(n,t,e){let r=J(),s=J();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let c=Te();return e.forEach((l,h)=>{let m=o.get(l);h.isFoundDocument()!==m.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(W.min())?(t.removeEntry(l,h.readTime),c=c.insert(l,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(t.addEntry(h),c=c.insert(l,h)):q(Ru,"Ignoring outdated watch update for ",l,". Current version:",m.version," Watch version:",h.version)}),{Ls:c,ks:s}})}function by(n,t){let e=K(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=wu),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function Ay(n,t){let e=K(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.hi.getTargetData(r,t).next(o=>o?(s=o,x.resolve(s)):e.hi.allocateTargetId(r).next(c=>(s=new di(t,c,"TargetPurposeListen",r.currentSequenceNumber),e.hi.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.Fs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(r.targetId,r),e.Ms.set(t,r.targetId)),r})}function Uc(n,t,e){return V(this,null,function*(){let r=K(n),s=r.Fs.get(t),o=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",o,c=>r.persistence.referenceDelegate.removeTarget(c,s)))}catch(c){if(!ir(c))throw c;q(Ru,`Failed to update sequence numbers for target ${t}: ${c}`)}r.Fs=r.Fs.remove(t),r.Ms.delete(s.target)})}function jd(n,t,e){let r=K(n),s=W.min(),o=J();return r.persistence.runTransaction("Execute query","readwrite",c=>function(h,m,f){let v=K(h),C=v.Ms.get(f);return C!==void 0?x.resolve(v.Fs.get(C)):v.hi.getTargetData(m,f)}(r,c,oe(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(c,l.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(c,t,e?s:W.min(),e?o:J())).next(l=>(Sy(r,Bg(t),l),{documents:l,qs:o})))}function Sy(n,t,e){let r=n.xs.get(t)||W.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.xs.set(t,r)}var Gs=class{constructor(){this.activeTargetIds=Kg()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var jc=class{constructor(){this.Fo=new Gs,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,r){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new Gs,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var $c=class{xo(t){}shutdown(){}};var $d="ConnectivityMonitor",Ks=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){q($d,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){q($d,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var bs=null;function Gc(){return bs===null?bs=function(){return 268435456+Math.round(2147483648*Math.random())}():bs++,"0x"+bs.toString(16)}var za="RestConnection",xy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Kc=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${r}/databases/${s}`,this.Ko=this.databaseId.database===ks?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(t,e,r,s,o){let c=Gc(),l=this.Go(t,e.toUriEncodedString());q(za,`Sending RPC '${t}' ${c}:`,l,r);let h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(h,s,o);let{host:m}=new URL(l),f=Ta(m);return this.jo(t,l,h,r,f).then(v=>(q(za,`Received RPC '${t}' ${c}: `,v),v),v=>{throw Ue(za,`RPC '${t}' ${c} failed with error: `,v,"url: ",l,"request:",r),v})}Jo(t,e,r,s,o,c){return this.Wo(t,e,r,s,o)}zo(t,e,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+nr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}Go(t,e){let r=xy[t];return`${this.$o}/v1/${e}:${r}`}terminate(){}};var Qc=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Vt="WebChannelConnection",Wc=class extends Kc{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,r,s,o){let c=Gc();return new Promise((l,h)=>{let m=new Da;m.setWithCredentials(!0),m.listenOnce(Ra.COMPLETE,()=>{try{switch(m.getLastErrorCode()){case Zr.NO_ERROR:let v=m.getResponseJson();q(Vt,`XHR for RPC '${t}' ${c} received:`,JSON.stringify(v)),l(v);break;case Zr.TIMEOUT:q(Vt,`RPC '${t}' ${c} timed out`),h(new j(A.DEADLINE_EXCEEDED,"Request time out"));break;case Zr.HTTP_ERROR:let C=m.getStatus();if(q(Vt,`RPC '${t}' ${c} failed with status:`,C,"response text:",m.getResponseText()),C>0){let S=m.getResponseJson();Array.isArray(S)&&(S=S[0]);let L=S?.error;if(L&&L.status&&L.message){let B=function(U){let P=U.toLowerCase().replace(/_/g,"-");return Object.values(A).indexOf(P)>=0?P:A.UNKNOWN}(L.status);h(new j(B,L.message))}else h(new j(A.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new j(A.UNAVAILABLE,"Connection failed."));break;default:G(9055,{c_:t,streamId:c,l_:m.getLastErrorCode(),h_:m.getLastError()})}}finally{q(Vt,`RPC '${t}' ${c} completed.`)}});let f=JSON.stringify(s);q(Vt,`RPC '${t}' ${c} sending request:`,s),m.send(e,"POST",f,r,15)})}P_(t,e,r){let s=Gc(),o=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],c=Va(),l=Na(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.zo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;let f=o.join("");q(Vt,`Creating RPC '${t}' stream ${s}: ${f}`,h);let v=c.createWebChannel(f,h);this.T_(v);let C=!1,S=!1,L=new Qc({Ho:M=>{S?q(Vt,`Not sending because RPC '${t}' stream ${s} is closed:`,M):(C||(q(Vt,`Opening RPC '${t}' stream ${s} transport.`),v.open(),C=!0),q(Vt,`RPC '${t}' stream ${s} sending:`,M),v.send(M))},Yo:()=>v.close()}),B=(M,U,P)=>{M.listen(U,N=>{try{P(N)}catch(X){setTimeout(()=>{throw X},0)}})};return B(v,kn.EventType.OPEN,()=>{S||(q(Vt,`RPC '${t}' stream ${s} transport opened.`),L.s_())}),B(v,kn.EventType.CLOSE,()=>{S||(S=!0,q(Vt,`RPC '${t}' stream ${s} transport closed`),L.__(),this.I_(v))}),B(v,kn.EventType.ERROR,M=>{S||(S=!0,Ue(Vt,`RPC '${t}' stream ${s} transport errored. Name:`,M.name,"Message:",M.message),L.__(new j(A.UNAVAILABLE,"The operation could not be completed")))}),B(v,kn.EventType.MESSAGE,M=>{var U;if(!S){let P=M.data[0];it(!!P,16349);let N=P,X=N?.error||((U=N[0])===null||U===void 0?void 0:U.error);if(X){q(Vt,`RPC '${t}' stream ${s} received error:`,X);let xt=X.status,st=function(g){let _=gt[g];if(_!==void 0)return Qm(_)}(xt),E=X.message;st===void 0&&(st=A.INTERNAL,E="Unknown error status: "+xt+" with message "+X.message),S=!0,L.__(new j(st,E)),v.close()}else q(Vt,`RPC '${t}' stream ${s} received:`,P),L.a_(P)}}),B(l,Pa.STAT_EVENT,M=>{M.stat===Ts.PROXY?q(Vt,`RPC '${t}' stream ${s} detected buffering proxy`):M.stat===Ts.NOPROXY&&q(Vt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{L.o_()},0),L}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function Fa(){return typeof document<"u"?document:null}function mo(n){return new fc(n,!0)}var Qs=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Fi=t,this.timerId=e,this.d_=r,this.E_=s,this.A_=o,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),s=Math.max(0,e-r);s>0&&q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Gd="PersistentStream",Ws=class{constructor(t,e,r,s,o,c,l,h){this.Fi=t,this.w_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Qs(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return V(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}L_(){return V(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return V(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===A.RESOURCE_EXHAUSTED?(_e(e.toString()),_e("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===A.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.n_(e)})}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.b_===e&&this.W_(r,s)},r=>{t(()=>{let s=new j(A.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(s)})})}W_(t,e){let r=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(s=>{r(()=>this.G_(s))}),this.stream.onMessage(s=>{r(()=>++this.C_==1?this.j_(s):this.onNext(s))})}O_(){this.state=5,this.F_.g_(()=>V(this,null,function*(){this.state=0,this.start()}))}G_(t){return q(Gd,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(q(Gd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Hc=class extends Ws{constructor(t,e,r,s,o,c){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,c),this.serializer=o}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=oy(this.serializer,t),r=function(o){if(!("targetChange"in o))return W.min();let c=o.targetChange;return c.targetIds&&c.targetIds.length?W.min():c.readTime?ce(c.readTime):W.min()}(t);return this.listener.J_(e,r)}H_(t){let e={};e.database=vc(this.serializer),e.addTarget=function(o,c){let l,h=c.target;if(l=sc(h)?{documents:uy(o,h)}:{query:ly(o,h).Vt},l.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){l.resumeToken=Wm(o,c.resumeToken);let m=gc(o,c.expectedCount);m!==null&&(l.expectedCount=m)}else if(c.snapshotVersion.compareTo(W.min())>0){l.readTime=qs(o,c.snapshotVersion.toTimestamp());let m=gc(o,c.expectedCount);m!==null&&(l.expectedCount=m)}return l}(this.serializer,t);let r=dy(this.serializer,t);r&&(e.labels=r),this.k_(e)}Y_(t){let e={};e.database=vc(this.serializer),e.removeTarget=t,this.k_(e)}},Xc=class extends Ws{constructor(t,e,r,s,o,c){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,c),this.serializer=o}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return it(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,it(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){it(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=cy(t.writeResults,t.commitTime),r=ce(t.commitTime);return this.listener.ta(r,e)}na(){let t={};t.database=vc(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>ay(this.serializer,r))};this.k_(e)}};var Yc=class{},Jc=class extends Yc{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new j(A.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,r,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Wo(t,yc(e,r),s,o,c)).catch(o=>{throw o.name==="FirebaseError"?(o.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new j(A.UNKNOWN,o.toString())})}Jo(t,e,r,s,o){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,l])=>this.connection.Jo(t,yc(e,r),s,c,l,o)).catch(c=>{throw c.name==="FirebaseError"?(c.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new j(A.UNKNOWN,c.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Zc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(_e(e),this._a=!1):q("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var ln="RemoteStore",tu=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=o,this.Ea.xo(c=>{r.enqueueAndForget(()=>V(this,null,function*(){hn(this)&&(q(ln,"Restarting streams for network reachability change."),yield function(h){return V(this,null,function*(){let m=K(h);m.Ia.add(4),yield wi(m),m.Aa.set("Unknown"),m.Ia.delete(4),yield po(m)})}(this))}))}),this.Aa=new Zc(r,s)}};function po(n){return V(this,null,function*(){if(hn(n))for(let t of n.da)yield t(!0)})}function wi(n){return V(this,null,function*(){for(let t of n.da)yield t(!1)})}function ip(n,t){let e=K(n);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),ku(e)?Vu(e):sr(e).x_()&&Nu(e,t))}function Pu(n,t){let e=K(n),r=sr(e);e.Ta.delete(t),r.x_()&&sp(e,t),e.Ta.size===0&&(r.x_()?r.B_():hn(e)&&e.Aa.set("Unknown"))}function Nu(n,t){if(n.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(W.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}sr(n).H_(t)}function sp(n,t){n.Ra.$e(t),sr(n).Y_(t)}function Vu(n){n.Ra=new pc({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>n.Ta.get(t)||null,lt:()=>n.datastore.serializer.databaseId}),sr(n).start(),n.Aa.aa()}function ku(n){return hn(n)&&!sr(n).M_()&&n.Ta.size>0}function hn(n){return K(n).Ia.size===0}function op(n){n.Ra=void 0}function Dy(n){return V(this,null,function*(){n.Aa.set("Online")})}function Ry(n){return V(this,null,function*(){n.Ta.forEach((t,e)=>{Nu(n,t)})})}function Py(n,t){return V(this,null,function*(){op(n),ku(n)?(n.Aa.la(t),Vu(n)):n.Aa.set("Unknown")})}function Ny(n,t,e){return V(this,null,function*(){if(n.Aa.set("Online"),t instanceof Ls&&t.state===2&&t.cause)try{yield function(s,o){return V(this,null,function*(){let c=o.cause;for(let l of o.targetIds)s.Ta.has(l)&&(yield s.remoteSyncer.rejectListen(l,c),s.Ta.delete(l),s.Ra.removeTarget(l))})}(n,t)}catch(r){q(ln,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Hs(n,r)}else if(t instanceof Bn?n.Ra.Ye(t):t instanceof Ms?n.Ra.it(t):n.Ra.et(t),!e.isEqual(W.min()))try{let r=yield rp(n.localStore);e.compareTo(r)>=0&&(yield function(o,c){let l=o.Ra.Pt(c);return l.targetChanges.forEach((h,m)=>{if(h.resumeToken.approximateByteSize()>0){let f=o.Ta.get(m);f&&o.Ta.set(m,f.withResumeToken(h.resumeToken,c))}}),l.targetMismatches.forEach((h,m)=>{let f=o.Ta.get(h);if(!f)return;o.Ta.set(h,f.withResumeToken(kt.EMPTY_BYTE_STRING,f.snapshotVersion)),sp(o,h);let v=new di(f.target,h,m,f.sequenceNumber);Nu(o,v)}),o.remoteSyncer.applyRemoteEvent(l)}(n,e))}catch(r){q(ln,"Failed to raise snapshot:",r),yield Hs(n,r)}})}function Hs(n,t,e){return V(this,null,function*(){if(!ir(t))throw t;n.Ia.add(1),yield wi(n),n.Aa.set("Offline"),e||(e=()=>rp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>V(null,null,function*(){q(ln,"Retrying IndexedDB access"),yield e(),n.Ia.delete(1),yield po(n)}))})}function ap(n,t){return t().catch(e=>Hs(n,e,t))}function fo(n){return V(this,null,function*(){let t=K(n),e=$e(t),r=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:wu;for(;Vy(t);)try{let s=yield by(t.localStore,r);if(s===null){t.Pa.length===0&&e.B_();break}r=s.batchId,ky(t,s)}catch(s){yield Hs(t,s)}cp(t)&&up(t)})}function Vy(n){return hn(n)&&n.Pa.length<10}function ky(n,t){n.Pa.push(t);let e=$e(n);e.x_()&&e.Z_&&e.X_(t.mutations)}function cp(n){return hn(n)&&!$e(n).M_()&&n.Pa.length>0}function up(n){$e(n).start()}function zy(n){return V(this,null,function*(){$e(n).na()})}function Fy(n){return V(this,null,function*(){let t=$e(n);for(let e of n.Pa)t.X_(e.mutations)})}function Oy(n,t,e){return V(this,null,function*(){let r=n.Pa.shift(),s=lc.from(r,t,e);yield ap(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield fo(n)})}function My(n,t){return V(this,null,function*(){t&&$e(n).Z_&&(yield function(r,s){return V(this,null,function*(){if(function(c){return Zg(c)&&c!==A.ABORTED}(s.code)){let o=r.Pa.shift();$e(r).N_(),yield ap(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield fo(r)}})}(n,t)),cp(n)&&up(n)})}function Kd(n,t){return V(this,null,function*(){let e=K(n);e.asyncQueue.verifyOperationInProgress(),q(ln,"RemoteStore received new credentials");let r=hn(e);e.Ia.add(3),yield wi(e),r&&e.Aa.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),yield po(e)})}function Ly(n,t){return V(this,null,function*(){let e=K(n);t?(e.Ia.delete(2),yield po(e)):t||(e.Ia.add(2),yield wi(e),e.Aa.set("Unknown"))})}function sr(n){return n.Va||(n.Va=function(e,r,s){let o=K(e);return o.ia(),new Hc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:Dy.bind(null,n),e_:Ry.bind(null,n),n_:Py.bind(null,n),J_:Ny.bind(null,n)}),n.da.push(t=>V(null,null,function*(){t?(n.Va.N_(),ku(n)?Vu(n):n.Aa.set("Unknown")):(yield n.Va.stop(),op(n))}))),n.Va}function $e(n){return n.ma||(n.ma=function(e,r,s){let o=K(e);return o.ia(),new Xc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:zy.bind(null,n),n_:My.bind(null,n),ea:Fy.bind(null,n),ta:Oy.bind(null,n)}),n.da.push(t=>V(null,null,function*(){t?(n.ma.N_(),yield fo(n)):(yield n.ma.stop(),n.Pa.length>0&&(q(ln,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var eu=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let c=Date.now()+r,l=new n(t,e,c,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new j(A.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function zu(n,t){if(_e("AsyncQueue",`${t}: ${n}`),ir(n))return new j(A.UNAVAILABLE,`${t}: ${n}`);throw n}var Xs=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||$.comparator(e.key,r.key):(e,r)=>$.comparator(e.key,r.key),this.keyedMap=ti(),this.sortedSet=new ft(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Ys=class{constructor(){this.fa=new ft($.comparator)}track(t){let e=t.doc.key,r=this.fa.get(e);r?t.type!==0&&r.type===3?this.fa=this.fa.insert(e,t):t.type===3&&r.type!==1?this.fa=this.fa.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.fa=this.fa.remove(e):t.type===1&&r.type===2?this.fa=this.fa.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):G(63341,{At:t,ga:r}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,r)=>{t.push(r)}),t}},Zn=class n{constructor(t,e,r,s,o,c,l,h,m){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=c,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(t,e,r,s,o){let c=[];return e.forEach(l=>{c.push({type:0,doc:l})}),new n(t,e,Xs.emptySet(e),c,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&lo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var nu=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},ru=class{constructor(){this.queries=Qd(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,r){let s=K(e),o=s.queries;s.queries=Qd(),o.forEach((c,l)=>{for(let h of l.wa)h.onError(r)})})(this,new j(A.ABORTED,"Firestore shutting down"))}};function Qd(){return new we(n=>zm(n),lo)}function Fu(n,t){return V(this,null,function*(){let e=K(n),r=3,s=t.query,o=e.queries.get(s);o?!o.Sa()&&t.ba()&&(r=2):(o=new nu,r=t.ba()?0:1);try{switch(r){case 0:o.ya=yield e.onListen(s,!0);break;case 1:o.ya=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(c){let l=zu(c,`Initialization of query '${Fn(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.wa.push(t),t.va(e.onlineState),o.ya&&t.Ca(o.ya)&&Mu(e)})}function Ou(n,t){return V(this,null,function*(){let e=K(n),r=t.query,s=3,o=e.queries.get(r);if(o){let c=o.wa.indexOf(t);c>=0&&(o.wa.splice(c,1),o.wa.length===0?s=t.ba()?0:1:!o.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function By(n,t){let e=K(n),r=!1;for(let s of t){let o=s.query,c=e.queries.get(o);if(c){for(let l of c.wa)l.Ca(s)&&(r=!0);c.ya=s}}r&&Mu(e)}function qy(n,t,e){let r=K(n),s=r.queries.get(t);if(s)for(let o of s.wa)o.onError(e);r.queries.delete(t)}function Mu(n){n.Da.forEach(t=>{t.next()})}var iu,Wd;(Wd=iu||(iu={})).Fa="default",Wd.Cache="cache";var fi=class{constructor(t,e,r){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new Zn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let r=e!=="Offline";return(!this.options.ka||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=Zn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==iu.Cache}};var Js=class{constructor(t){this.key=t}},Zs=class{constructor(t){this.key=t}},su=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=J(),this.mutatedKeys=J(),this.Xa=Fm(t),this.eu=new Xs(this.Xa)}get tu(){return this.Ha}nu(t,e){let r=e?e.ru:new Ys,s=e?e.eu:this.eu,o=e?e.mutatedKeys:this.mutatedKeys,c=s,l=!1,h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,m=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,v)=>{let C=s.get(f),S=ho(this.query,v)?v:null,L=!!C&&this.mutatedKeys.has(C.key),B=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),M=!1;C&&S?C.data.isEqual(S.data)?L!==B&&(r.track({type:3,doc:S}),M=!0):this.iu(C,S)||(r.track({type:2,doc:S}),M=!0,(h&&this.Xa(S,h)>0||m&&this.Xa(S,m)<0)&&(l=!0)):!C&&S?(r.track({type:0,doc:S}),M=!0):C&&!S&&(r.track({type:1,doc:C}),M=!0,(h||m)&&(l=!0)),M&&(S?(c=c.add(S),o=B?o.add(f):o.delete(f)):(c=c.delete(f),o=o.delete(f)))}),this.query.limit!==null)for(;c.size>this.query.limit;){let f=this.query.limitType==="F"?c.last():c.first();c=c.delete(f.key),o=o.delete(f.key),r.track({type:1,doc:f})}return{eu:c,ru:r,Ds:l,mutatedKeys:o}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let o=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let c=t.ru.pa();c.sort((f,v)=>function(S,L){let B=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G(20277,{At:M})}};return B(S)-B(L)}(f.type,v.type)||this.Xa(f.doc,v.doc)),this.su(r),s=s!=null&&s;let l=e&&!s?this.ou():[],h=this.Za.size===0&&this.current&&!s?1:0,m=h!==this.Ya;return this.Ya=h,c.length!==0||m?{snapshot:new Zn(this.query,t.eu,o,c,t.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:l}:{_u:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Ys,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=J(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let e=[];return t.forEach(r=>{this.Za.has(r)||e.push(new Zs(r))}),this.Za.forEach(r=>{t.has(r)||e.push(new Js(r))}),e}uu(t){this.Ha=t.qs,this.Za=J();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return Zn.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Lu="SyncEngine",ou=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},au=class{constructor(t){this.key=t,this.lu=!1}},cu=class{constructor(t,e,r,s,o,c){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=c,this.hu={},this.Pu=new we(l=>zm(l),lo),this.Tu=new Map,this.Iu=new Set,this.du=new ft($.comparator),this.Eu=new Map,this.Au=new pi,this.Ru={},this.Vu=new Map,this.mu=mi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function Uy(n,t,e=!0){return V(this,null,function*(){let r=fp(n),s,o=r.Pu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.cu()):s=yield lp(r,t,e,!0),s})}function jy(n,t){return V(this,null,function*(){let e=fp(n);yield lp(e,t,!0,!1)})}function lp(n,t,e,r){return V(this,null,function*(){let s=yield Ay(n.localStore,oe(t)),o=s.targetId,c=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=yield $y(n,t,o,c==="current",s.resumeToken)),n.isPrimaryClient&&e&&ip(n.remoteStore,s),l})}function $y(n,t,e,r,s){return V(this,null,function*(){n.gu=(v,C,S)=>function(B,M,U,P){return V(this,null,function*(){let N=M.view.nu(U);N.Ds&&(N=yield jd(B.localStore,M.query,!1).then(({documents:E})=>M.view.nu(E,N)));let X=P&&P.targetChanges.get(M.targetId),xt=P&&P.targetMismatches.get(M.targetId)!=null,st=M.view.applyChanges(N,B.isPrimaryClient,X,xt);return Xd(B,M.targetId,st._u),st.snapshot})}(n,v,C,S);let o=yield jd(n.localStore,t,!0),c=new su(t,o.qs),l=c.nu(o.documents),h=hi.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),m=c.applyChanges(l,n.isPrimaryClient,h);Xd(n,e,m._u);let f=new ou(t,e,c);return n.Pu.set(t,f),n.Tu.has(e)?n.Tu.get(e).push(t):n.Tu.set(e,[t]),m.snapshot})}function Gy(n,t,e){return V(this,null,function*(){let r=K(n),s=r.Pu.get(t),o=r.Tu.get(s.targetId);if(o.length>1)return r.Tu.set(s.targetId,o.filter(c=>!lo(c,t))),void r.Pu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Uc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Pu(r.remoteStore,s.targetId),uu(r,s.targetId)}).catch(rr))):(uu(r,s.targetId),yield Uc(r.localStore,s.targetId,!0))})}function Ky(n,t){return V(this,null,function*(){let e=K(n),r=e.Pu.get(t),s=e.Tu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Pu(e.remoteStore,r.targetId))})}function Qy(n,t,e){return V(this,null,function*(){let r=t_(n);try{let s=yield function(c,l){let h=K(c),m=vt.now(),f=l.reduce((S,L)=>S.add(L.key),J()),v,C;return h.persistence.runTransaction("Locally write mutations","readwrite",S=>{let L=Te(),B=J();return h.Os.getEntries(S,f).next(M=>{L=M,L.forEach((U,P)=>{P.isValidDocument()||(B=B.add(U))})}).next(()=>h.localDocuments.getOverlayedDocuments(S,L)).next(M=>{v=M;let U=[];for(let P of l){let N=Jg(P,v.get(P.key).overlayedDocument);N!=null&&U.push(new he(P.key,N,Dm(N.value.mapValue),ae.exists(!0)))}return h.mutationQueue.addMutationBatch(S,m,U,l)}).next(M=>{C=M;let U=M.applyToLocalDocumentSet(v,B);return h.documentOverlayCache.saveOverlays(S,M.batchId,U)})}).then(()=>({batchId:C.batchId,changes:Mm(v)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(c,l,h){let m=c.Ru[c.currentUser.toKey()];m||(m=new ft(H)),m=m.insert(l,h),c.Ru[c.currentUser.toKey()]=m}(r,s.batchId,e),yield Ti(r,s.changes),yield fo(r.remoteStore)}catch(s){let o=zu(s,"Failed to persist write");e.reject(o)}})}function hp(n,t){return V(this,null,function*(){let e=K(n);try{let r=yield Iy(e.localStore,t);t.targetChanges.forEach((s,o)=>{let c=e.Eu.get(o);c&&(it(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?c.lu=!0:s.modifiedDocuments.size>0?it(c.lu,14607):s.removedDocuments.size>0&&(it(c.lu,42227),c.lu=!1))}),yield Ti(e,r,t)}catch(r){yield rr(r)}})}function Hd(n,t,e){let r=K(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.Pu.forEach((o,c)=>{let l=c.view.va(t);l.snapshot&&s.push(l.snapshot)}),function(c,l){let h=K(c);h.onlineState=l;let m=!1;h.queries.forEach((f,v)=>{for(let C of v.wa)C.va(l)&&(m=!0)}),m&&Mu(h)}(r.eventManager,t),s.length&&r.hu.J_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Wy(n,t,e){return V(this,null,function*(){let r=K(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Eu.get(t),o=s&&s.key;if(o){let c=new ft($.comparator);c=c.insert(o,Zt.newNoDocument(o,W.min()));let l=J().add(o),h=new Os(W.min(),new Map,new ft(H),c,l);yield hp(r,h),r.du=r.du.remove(o),r.Eu.delete(t),Bu(r)}else yield Uc(r.localStore,t,!1).then(()=>uu(r,t,e)).catch(rr)})}function Hy(n,t){return V(this,null,function*(){let e=K(n),r=t.batch.batchId;try{let s=yield Ty(e.localStore,t);mp(e,r,null),dp(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Ti(e,s)}catch(s){yield rr(s)}})}function Xy(n,t,e){return V(this,null,function*(){let r=K(n);try{let s=yield function(c,l){let h=K(c);return h.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let f;return h.mutationQueue.lookupMutationBatch(m,l).next(v=>(it(v!==null,37113),f=v.keys(),h.mutationQueue.removeMutationBatch(m,v))).next(()=>h.mutationQueue.performConsistencyCheck(m)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(m,f,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,f)).next(()=>h.localDocuments.getDocuments(m,f))})}(r.localStore,t);mp(r,t,e),dp(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Ti(r,s)}catch(s){yield rr(s)}})}function dp(n,t){(n.Vu.get(t)||[]).forEach(e=>{e.resolve()}),n.Vu.delete(t)}function mp(n,t,e){let r=K(n),s=r.Ru[r.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Ru[r.currentUser.toKey()]=s}}function uu(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Tu.get(t))n.Pu.delete(r),e&&n.hu.pu(r,e);n.Tu.delete(t),n.isPrimaryClient&&n.Au.zr(t).forEach(r=>{n.Au.containsKey(r)||pp(n,r)})}function pp(n,t){n.Iu.delete(t.path.canonicalString());let e=n.du.get(t);e!==null&&(Pu(n.remoteStore,e),n.du=n.du.remove(t),n.Eu.delete(e),Bu(n))}function Xd(n,t,e){for(let r of e)r instanceof Js?(n.Au.addReference(r.key,t),Yy(n,r)):r instanceof Zs?(q(Lu,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,t),n.Au.containsKey(r.key)||pp(n,r.key)):G(19791,{yu:r})}function Yy(n,t){let e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Iu.has(r)||(q(Lu,"New document in limbo: "+e),n.Iu.add(r),Bu(n))}function Bu(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let t=n.Iu.values().next().value;n.Iu.delete(t);let e=new $(dt.fromString(t)),r=n.mu.next();n.Eu.set(r,new au(e)),n.du=n.du.insert(e,r),ip(n.remoteStore,new di(oe(uo(e.path)),r,"TargetPurposeLimboResolution",Eu.ue))}}function Ti(n,t,e){return V(this,null,function*(){let r=K(n),s=[],o=[],c=[];r.Pu.isEmpty()||(r.Pu.forEach((l,h)=>{c.push(r.gu(h,t,e).then(m=>{var f;if((m||e)&&r.isPrimaryClient){let v=m?!m.fromCache:(f=e?.targetChanges.get(h.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(h.targetId,v?"current":"not-current")}if(m){s.push(m);let v=Mc.Es(h.targetId,m);o.push(v)}}))}),yield Promise.all(c),r.hu.J_(s),yield function(h,m){return V(this,null,function*(){let f=K(h);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>x.forEach(m,C=>x.forEach(C.Is,S=>f.persistence.referenceDelegate.addReference(v,C.targetId,S)).next(()=>x.forEach(C.ds,S=>f.persistence.referenceDelegate.removeReference(v,C.targetId,S)))))}catch(v){if(!ir(v))throw v;q(Ru,"Failed to update sequence numbers: "+v)}for(let v of m){let C=v.targetId;if(!v.fromCache){let S=f.Fs.get(C),L=S.snapshotVersion,B=S.withLastLimboFreeSnapshotVersion(L);f.Fs=f.Fs.insert(C,B)}}})}(r.localStore,o))})}function Jy(n,t){return V(this,null,function*(){let e=K(n);if(!e.currentUser.isEqual(t)){q(Lu,"User change. New user:",t.toKey());let r=yield np(e.localStore,t);e.currentUser=t,function(o,c){o.Vu.forEach(l=>{l.forEach(h=>{h.reject(new j(A.CANCELLED,c))})}),o.Vu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Ti(e,r.Bs)}})}function Zy(n,t){let e=K(n),r=e.Eu.get(t);if(r&&r.lu)return J().add(r.key);{let s=J(),o=e.Tu.get(t);if(!o)return s;for(let c of o){let l=e.Pu.get(c);s=s.unionWith(l.view.tu)}return s}}function fp(n){let t=K(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=hp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zy.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wy.bind(null,t),t.hu.J_=By.bind(null,t.eventManager),t.hu.pu=qy.bind(null,t.eventManager),t}function t_(n){let t=K(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Hy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Xy.bind(null,t),t}var gp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=mo(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)})}Cu(e,r){return null}Fu(e,r){return null}vu(e){return wy(this.persistence,new Bc,e.initialUser,this.serializer)}Du(e){return new js(Oc.Vi,this.serializer)}bu(e){return new jc}terminate(){return V(this,null,function*(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),lu=class extends gp{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){it(this.persistence.referenceDelegate instanceof $s,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Cc(r,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new js(r=>$s.Vi(r,e),this.serializer)}};var e_=(()=>{class n{initialize(e,r){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Hd(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jy.bind(null,this.syncEngine),yield Ly(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new ru}()}createDatastore(e){let r=mo(e.databaseInfo.databaseId),s=function(c){return new Wc(c)}(e.databaseInfo);return function(c,l,h,m){return new Jc(c,l,h,m)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,o,c,l,h){return new tu(s,o,c,l,h)}(this.localStore,this.datastore,e.asyncQueue,r=>Hd(this.syncEngine,r,0),function(){return Ks.C()?new Ks:new $c}())}createSyncEngine(e,r){return function(o,c,l,h,m,f,v){let C=new cu(o,c,l,h,m,f);return v&&(C.fu=!0),C}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return V(this,null,function*(){var e,r;yield function(o){return V(this,null,function*(){let c=K(o);q(ln,"RemoteStore shutting down."),c.Ia.add(5),yield wi(c),c.Ea.shutdown(),c.Aa.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var gi=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):_e("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Ge="FirestoreClient",hu=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=It.UNAUTHENTICATED,this.clientId=si.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,c=>V(this,null,function*(){q(Ge,"Received user=",c.uid),yield this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,c=>(q(Ge,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=zu(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Oa(n,t){return V(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),q(Ge,"Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(s=>V(null,null,function*(){r.isEqual(s)||(yield np(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>{Ue("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{q("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(s=>{Ue("Terminating Firestore due to IndexedDb database deletion failed",s)})}),n._offlineComponents=t})}function Yd(n,t){return V(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield n_(n);q(Ge,"Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Kd(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Kd(t.remoteStore,s)),n._onlineComponents=t})}function n_(n){return V(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){q(Ge,"Using user provided OfflineComponentProvider");try{yield Oa(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===A.FAILED_PRECONDITION||s.code===A.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Ue("Error using user provided cache. Falling back to memory cache: "+e),yield Oa(n,new gp)}}else q(Ge,"Using default OfflineComponentProvider"),yield Oa(n,new lu(void 0));return n._offlineComponents})}function yp(n){return V(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(q(Ge,"Using user provided OnlineComponentProvider"),yield Yd(n,n._uninitializedComponentsProvider._online)):(q(Ge,"Using default OnlineComponentProvider"),yield Yd(n,new e_))),n._onlineComponents})}function r_(n){return yp(n).then(t=>t.syncEngine)}function to(n){return V(this,null,function*(){let t=yield yp(n),e=t.eventManager;return e.onListen=Uy.bind(null,t.syncEngine),e.onUnlisten=Gy.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=jy.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Ky.bind(null,t.syncEngine),e})}function i_(n,t,e={}){let r=new Jt;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(o,c,l,h,m){let f=new gi({next:C=>{f.Ou(),c.enqueueAndForget(()=>Ou(o,v));let S=C.docs.has(l);!S&&C.fromCache?m.reject(new j(A.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&C.fromCache&&h&&h.source==="server"?m.reject(new j(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(C)},error:C=>m.reject(C)}),v=new fi(uo(l.path),f,{includeMetadataChanges:!0,ka:!0});return Fu(o,v)}(yield to(n),n.asyncQueue,t,e,r)})),r.promise}function s_(n,t,e={}){let r=new Jt;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(o,c,l,h,m){let f=new gi({next:C=>{f.Ou(),c.enqueueAndForget(()=>Ou(o,v)),C.fromCache&&h.source==="server"?m.reject(new j(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(C)},error:C=>m.reject(C)}),v=new fi(l,f,{includeMetadataChanges:!0,ka:!0});return Fu(o,v)}(yield to(n),n.asyncQueue,t,e,r)})),r.promise}function _p(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Jd=new Map;var vp="firestore.googleapis.com",Zd=!0,eo=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new j(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vp,this.ssl=Zd}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:Zd;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=ep;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<_y)throw new j(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}fg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_p((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new j(A.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new j(A.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new j(A.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},tr=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new eo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new j(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new j(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new eo(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ma;switch(r.type){case"firstParty":return new Ua(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new j(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Jd.get(e);r&&(q("ComponentProvider","Removing Datastore"),Jd.delete(e),r.terminate())}(this),Promise.resolve()}};function Ep(n,t,e,r={}){var s;n=Lt(n,tr);let o=Ta(t),c=n._getSettings(),l=Object.assign(Object.assign({},c),{emulatorOptions:n._getEmulatorOptions()}),h=`${t}:${e}`;o&&(Ah(`https://${h}`),xh("Firestore",!0)),c.host!==vp&&c.host!==h&&Ue("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let m=Object.assign(Object.assign({},c),{host:h,ssl:o,emulatorOptions:r});if(!Nh(m,l)&&(n._setSettings(m),r.mockUserToken)){let f,v;if(typeof r.mockUserToken=="string")f=r.mockUserToken,v=It.MOCK_USER;else{f=Sh(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);let C=r.mockUserToken.sub||r.mockUserToken.user_id;if(!C)throw new j(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");v=new It(C)}n._authCredentials=new La(new Ds(f,v))}}var yi=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},bt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Me(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Ei(e,n._jsonSchema))return new n(t,r||null,new $(dt.fromString(e.referencePath)))}};bt._jsonSchemaVersion="firestore/documentReference/1.0",bt._jsonSchema={type:_t("string",bt._jsonSchemaVersion),referencePath:_t("string")};var Me=class n extends yi{constructor(t,e,r){super(t,e,uo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new bt(this.firestore,null,new $(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function wp(n,t,...e){if(n=ne(n),sm("collection","path",t),n instanceof tr){let r=dt.fromString(t,...e);return _d(r),new Me(n,null,r)}{if(!(n instanceof bt||n instanceof Me))throw new j(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(dt.fromString(t,...e));return _d(r),new Me(n.firestore,null,r)}}function qu(n,t,...e){if(n=ne(n),arguments.length===1&&(t=si.newId()),sm("doc","path",t),n instanceof tr){let r=dt.fromString(t,...e);return yd(r),new bt(n,null,new $(r))}{if(!(n instanceof bt||n instanceof Me))throw new j(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(dt.fromString(t,...e));return yd(r),new bt(n.firestore,n instanceof Me?n.converter:null,new $(r))}}var tm="AsyncQueue",no=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Qs(this,"async_queue_retry"),this.oc=()=>{let r=Fa();r&&q(tm,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=t;let e=Fa();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=Fa();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new Jt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}cc(){return V(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!ir(t))throw t;q(tm,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(r=>{throw this.tc=r,this.nc=!1,_e("INTERNAL UNHANDLED ERROR: ",em(r)),r}).then(r=>(this.nc=!1,r))));return this._c=e,e}enqueueAfterDelay(t,e,r){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let s=eu.createAndSchedule(this,t,e,r,o=>this.lc(o));return this.ec.push(s),s}ac(){this.tc&&G(47125,{hc:em(this.tc)})}verifyOperationInProgress(){}Pc(){return V(this,null,function*(){let t;do t=this._c,yield t;while(t!==this._c)})}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function em(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function nm(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let s=e;for(let o of r)if(o in s&&typeof s[o]=="function")return!0;return!1}(n,["next","error","complete"])}var te=class extends tr{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new no,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new no(t),this._firestoreClient=void 0,yield t}})}};function Tp(n,t){let e=typeof n=="object"?n:Lh(),r=typeof n=="string"?n:t||ks,s=Fh(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=bh("firestore");o&&Ep(s,...o)}return s}function go(n){if(n._terminated)throw new j(A.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||o_(n),n._firestoreClient}function o_(n){var t,e,r;let s=n._freezeSettings(),o=function(l,h,m,f){return new Qa(l,h,m,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,_p(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new hu(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(l){let h=l?._online.build();return{_offline:l?._offline.build(h),_online:h}}(n._componentsProvider))}var Le=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(kt.fromBase64String(t))}catch(e){throw new j(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(kt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Ei(t,n._jsonSchema))return n.fromBase64String(t.bytes)}};Le._jsonSchemaVersion="firestore/bytes/1.0",Le._jsonSchema={type:_t("string",Le._jsonSchemaVersion),bytes:_t("string")};var er=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new j(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $t(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var _i=class{constructor(t){this._methodName=t}};var Be=class n{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new j(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new j(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return H(this._lat,t._lat)||H(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(t){if(Ei(t,n._jsonSchema))return new n(t.latitude,t.longitude)}};Be._jsonSchemaVersion="firestore/geoPoint/1.0",Be._jsonSchema={type:_t("string",Be._jsonSchemaVersion),latitude:_t("number"),longitude:_t("number")};var qe=class n{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,t._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Ei(t,n._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new n(t.vectorValues);throw new j(A.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};qe._jsonSchemaVersion="firestore/vectorValue/1.0",qe._jsonSchema={type:_t("string",qe._jsonSchemaVersion),vectorValues:_t("object")};var a_=/^__.*__$/,du=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new he(t,this.data,this.fieldMask,e,this.fieldTransforms):new un(t,this.data,e,this.fieldTransforms)}},ro=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new he(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Ip(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G(40011,{Ec:n})}}var mu=class n{constructor(t,e,r,s,o,c){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Ac(),this.fieldTransforms=o||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:r,mc:!1});return s.fc(t),s}gc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:r,mc:!1});return s.Ac(),s}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return so(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(Ip(this.Ec)&&a_.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},pu=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||mo(t)}Dc(t,e,r,s=!1){return new mu({Ec:t,methodName:e,bc:r,path:$t.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Uu(n){let t=n._freezeSettings(),e=mo(n._databaseId);return new pu(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Cp(n,t,e,r,s,o={}){let c=n.Dc(o.merge||o.mergeFields?2:0,t,e,s);ju("Data must be an object, but it was:",c,r);let l=bp(r,c),h,m;if(o.merge)h=new Wt(c.fieldMask),m=c.fieldTransforms;else if(o.mergeFields){let f=[];for(let v of o.mergeFields){let C=fu(t,v,e);if(!c.contains(C))throw new j(A.INVALID_ARGUMENT,`Field '${C}' is specified in your field mask but missing from your input data.`);Sp(f,C)||f.push(C)}h=new Wt(f),m=c.fieldTransforms.filter(v=>h.covers(v.field))}else h=null,m=c.fieldTransforms;return new du(new jt(l),h,m)}var io=class n extends _i{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function c_(n,t,e,r){let s=n.Dc(1,t,e);ju("Data must be an object, but it was:",s,r);let o=[],c=jt.empty();Ke(r,(h,m)=>{let f=$u(t,h,e);m=ne(m);let v=s.gc(f);if(m instanceof io)o.push(f);else{let C=yo(m,v);C!=null&&(o.push(f),c.set(f,C))}});let l=new Wt(o);return new ro(c,l,s.fieldTransforms)}function u_(n,t,e,r,s,o){let c=n.Dc(1,t,e),l=[fu(t,r,e)],h=[s];if(o.length%2!=0)throw new j(A.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let C=0;C<o.length;C+=2)l.push(fu(t,o[C])),h.push(o[C+1]);let m=[],f=jt.empty();for(let C=l.length-1;C>=0;--C)if(!Sp(m,l[C])){let S=l[C],L=h[C];L=ne(L);let B=c.gc(S);if(L instanceof io)m.push(S);else{let M=yo(L,B);M!=null&&(m.push(S),f.set(S,M))}}let v=new Wt(m);return new ro(f,v,c.fieldTransforms)}function yo(n,t){if(Ap(n=ne(n)))return ju("Unsupported field value:",t,n),bp(n,t);if(n instanceof _i)return function(r,s){if(!Ip(s.Ec))throw s.wc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return function(r,s){let o=[],c=0;for(let l of r){let h=yo(l,s.yc(c));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),c++}return{arrayValue:{values:o}}}(n,t)}return function(r,s){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Qg(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=vt.fromDate(r);return{timestampValue:qs(s.serializer,o)}}if(r instanceof vt){let o=new vt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qs(s.serializer,o)}}if(r instanceof Be)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Le)return{bytesValue:Wm(s.serializer,r._byteString)};if(r instanceof bt){let o=s.databaseId,c=r.firestore._databaseId;if(!c.isEqual(o))throw s.wc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Du(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof qe)return function(c,l){return{mapValue:{fields:{[Iu]:{stringValue:Cu},[jn]:{arrayValue:{values:c.toArray().map(m=>{if(typeof m!="number")throw l.wc("VectorValues must only contain numeric values.");return xu(l.serializer,m)})}}}}}}(r,s);throw s.wc(`Unsupported field value: ${vu(r)}`)}(n,t)}function bp(n,t){let e={};return wm(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ke(n,(r,s)=>{let o=yo(s,t.Vc(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function Ap(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof vt||n instanceof Be||n instanceof Le||n instanceof bt||n instanceof _i||n instanceof qe)}function ju(n,t,e){if(!Ap(e)||!om(e)){let r=vu(e);throw r==="an object"?t.wc(n+" a custom object"):t.wc(n+" "+r)}}function fu(n,t,e){if((t=ne(t))instanceof er)return t._internalPath;if(typeof t=="string")return $u(n,t);throw so("Field path arguments must be of type string or ",n,!1,void 0,e)}var l_=new RegExp("[~\\*/\\[\\]]");function $u(n,t,e){if(t.search(l_)>=0)throw so(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new er(...t.split("."))._internalPath}catch{throw so(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function so(n,t,e,r,s){let o=r&&!r.isEmpty(),c=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||c)&&(h+=" (found",o&&(h+=` in field ${r}`),c&&(h+=` in document ${s}`),h+=")"),new j(A.INVALID_ARGUMENT,l+n+h)}function Sp(n,t){return n.some(e=>e.isEqual(t))}var oo=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new bt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new gu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(xp("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},gu=class extends oo{data(){return super.data()}};function xp(n,t){return typeof t=="string"?$u(n,t):t instanceof er?t._internalPath:t._delegate._internalPath}function Dp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new j(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var yu=class{convertValue(t,e="none"){switch(je(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ht(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ee(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw G(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return Ke(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){var e,r,s;let o=(s=(r=(e=t.fields)===null||e===void 0?void 0:e[jn].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(c=>ht(c.doubleValue));return new qe(o)}convertGeoPoint(t){return new Be(ht(t.latitude),ht(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=co(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(ci(t));default:return null}}convertTimestamp(t){let e=ve(t);return new vt(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=dt.fromString(t);it(tp(r),9688,{name:t});let s=new zs(r.get(1),r.get(3)),o=new $(r.popFirst(5));return s.isEqual(e)||_e(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function Rp(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var en=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},nn=class n extends oo{constructor(t,e,r,s,o,c){super(t,e,r,s,c),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new qn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(xp("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new j(A.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=n._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};nn._jsonSchemaVersion="firestore/documentSnapshot/1.0",nn._jsonSchema={type:_t("string",nn._jsonSchemaVersion),bundleSource:_t("string","DocumentSnapshot"),bundleName:_t("string"),bundle:_t("string")};var qn=class extends nn{data(t={}){return super.data(t)}},rn=class n{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new en(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new qn(this._firestore,this._userDataWriter,r.key,r,new en(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new j(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let c=0;return s._snapshot.docChanges.map(l=>{let h=new qn(s._firestore,s._userDataWriter,l.doc.key,l.doc,new en(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:c++}})}{let c=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new qn(s._firestore,s._userDataWriter,l.doc.key,l.doc,new en(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),m=-1,f=-1;return l.type!==0&&(m=c.indexOf(l.doc.key),c=c.delete(l.doc.key)),l.type!==1&&(c=c.add(l.doc),f=c.indexOf(l.doc.key)),{type:h_(l.type),doc:h,oldIndex:m,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new j(A.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=n._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=si.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function h_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G(61501,{type:n})}}function Pp(n){n=Lt(n,bt);let t=Lt(n.firestore,te);return i_(go(t),n._key).then(e=>Op(t,n,e))}rn._jsonSchemaVersion="firestore/querySnapshot/1.0",rn._jsonSchema={type:_t("string",rn._jsonSchemaVersion),bundleSource:_t("string","QuerySnapshot"),bundleName:_t("string"),bundle:_t("string")};var vi=class extends yu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Le(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new bt(this.firestore,null,e)}};function Np(n){n=Lt(n,yi);let t=Lt(n.firestore,te),e=go(t),r=new vi(t);return Dp(n._query),s_(e,n._query).then(s=>new rn(t,r,n,s))}function Vp(n,t,e){n=Lt(n,bt);let r=Lt(n.firestore,te),s=Rp(n.converter,t,e);return _o(r,[Cp(Uu(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,ae.none())])}function kp(n,t,e,...r){n=Lt(n,bt);let s=Lt(n.firestore,te),o=Uu(s),c;return c=typeof(t=ne(t))=="string"||t instanceof er?u_(o,"updateDoc",n._key,t,e,r):c_(o,"updateDoc",n._key,t),_o(s,[c.toMutation(n._key,ae.exists(!0))])}function zp(n){return _o(Lt(n.firestore,te),[new li(n._key,ae.none())])}function Fp(n,t){let e=Lt(n.firestore,te),r=qu(n),s=Rp(n.converter,t);return _o(e,[Cp(Uu(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,ae.exists(!1))]).then(()=>r)}function Gu(n,...t){var e,r,s;n=ne(n);let o={includeMetadataChanges:!1,source:"default"},c=0;typeof t[c]!="object"||nm(t[c])||(o=t[c++]);let l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(nm(t[c])){let v=t[c];t[c]=(e=v.next)===null||e===void 0?void 0:e.bind(v),t[c+1]=(r=v.error)===null||r===void 0?void 0:r.bind(v),t[c+2]=(s=v.complete)===null||s===void 0?void 0:s.bind(v)}let h,m,f;if(n instanceof bt)m=Lt(n.firestore,te),f=uo(n._key.path),h={next:v=>{t[c]&&t[c](Op(m,n,v))},error:t[c+1],complete:t[c+2]};else{let v=Lt(n,yi);m=Lt(v.firestore,te),f=v._query;let C=new vi(m);h={next:S=>{t[c]&&t[c](new rn(m,C,v,S))},error:t[c+1],complete:t[c+2]},Dp(n._query)}return function(C,S,L,B){let M=new gi(B),U=new fi(S,M,L);return C.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Fu(yield to(C),U)})),()=>{M.Ou(),C.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Ou(yield to(C),U)}))}}(go(m),f,l,h)}function _o(n,t){return function(r,s){let o=new Jt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Qy(yield r_(r),s,o)})),o.promise}(go(n),t)}function Op(n,t,e){let r=e.docs.get(t._key),s=new vi(n);return new nn(n,s,t._key,r,new en(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(s){nr=s})(Mh),zh(new Vh("firestore",(r,{instanceIdentifier:s,options:o})=>{let c=r.getProvider("app").getImmediate(),l=new te(new Ba(r.getProvider("auth-internal")),new ja(c,r.getProvider("app-check-internal")),function(m,f){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new j(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zs(m.options.projectId,f)}(c,s),c);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),Hr(md,pd,t),Hr(md,pd,"esm2017")})();var vo=function(){return vo=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},vo.apply(this,arguments)};var p_={includeMetadataChanges:!1};function Ku(n,t){return t===void 0&&(t=p_),new eh(function(e){var r=Gu(n,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:r}})}function Mp(n){return Ku(n,{includeMetadataChanges:!0})}function Lp(n,t){return t===void 0&&(t={}),Mp(n).pipe(ee(function(e){return Qu(e,t)}))}function Qu(n,t){var e;t===void 0&&(t={});var r=n.data(t);return!n.exists()||typeof r!="object"||r===null||!t.idField?r:vo(vo({},r),(e={},e[t.idField]=n.id,e))}function Bp(n){return Ku(n,{includeMetadataChanges:!0}).pipe(ee(function(t){return t.docs}))}function qp(n,t){return t===void 0&&(t={}),Bp(n).pipe(ee(function(e){return e.map(function(r){return Qu(r,t)})}))}var Ie=class{constructor(t){return t}},Up="firestore",Wu=class{constructor(){return Uh(Up)}};var Hu=new Je("angularfire2.firestore-instances");function f_(n,t){let e=qh(Up,n,t);return e&&new Ie(e)}function g_(n){return(t,e)=>{let r=t.runOutsideAngular(()=>n(e));return new Ie(r)}}var y_={provide:Wu,deps:[[new Gr,Hu]]},__={provide:Ie,useFactory:f_,deps:[[new Gr,Hu],$h]};function Jv(n,...t){return Hr("angularfire",Bh.full,"fst"),ih([__,y_,{provide:Hu,useFactory:g_(n),multi:!0,deps:[Qr,Ki,jh,Gh,[new Gr,Qh],[new Gr,Kh],...t]}])}var jp=Kt(qp,!0);var $p=Kt(Lp,!0);var Gp=Kt(Fp,!0,2);var Ii=Kt(wp,!0,2);var Eo=Kt(zp,!0,2);var Ce=Kt(qu,!0,2);var Kp=Kt(Pp,!0);var Qp=Kt(Np,!0);var Zv=Kt(Tp,!0);var Wp=Kt(Vp,!0,2);var wo=Kt(kp,!0,2);var dn=class dn{constructor(){this.firestore=Q(Ie);this.collectionName="contracts"}getAll(){let t=Ii(this.firestore,this.collectionName);return jp(t,{idField:"id"})}getById(t){let e=Ce(this.firestore,this.collectionName,t);return $p(e,{idField:"id"})}create(t){return V(this,null,function*(){let e=Ce(this.firestore,this.collectionName,t.contractNumber),r=ca(vn({},t),{id:t.contractNumber,createdAt:new Date,updatedAt:new Date});return yield Wp(e,r),t.contractNumber})}update(t,e){return V(this,null,function*(){let r=Ce(this.firestore,this.collectionName,t),s=ca(vn({},e),{updatedAt:new Date});yield wo(r,s)})}delete(t){return V(this,null,function*(){let e=Ce(this.firestore,this.collectionName,t);yield Eo(e)})}};dn.\u0275fac=function(e){return new(e||dn)},dn.\u0275prov=De({token:dn,factory:dn.\u0275fac,providedIn:"root"});var To=dn;var Xu=new Je("ContractRepository"),lE=[{provide:Xu,useClass:To}];var or=class{static create(t){let e=new Date;return{contractNumber:this.generateContractNumber(e),contractName:t.contractName,contractType:t.contractType,status:t.status||"draft",riskLevel:t.riskLevel||"low",clientCompany:t.clientCompany,clientRepresentative:t.clientRepresentative,clientContact:t.clientContact||"",clientEmail:t.clientEmail||"",startDate:e,endDate:t.endDate,totalAmount:t.totalAmount,currency:t.currency,paymentStatus:t.paymentStatus||"pending",paidAmount:t.paidAmount||0,paymentSchedule:t.paymentSchedule||[],approvalStatus:t.approvalStatus||{status:"pending",currentStep:1,totalSteps:3},approvers:t.approvers||[],documents:t.documents||[],risks:t.risks||[],createdAt:e,updatedAt:e}}static generateContractNumber(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return`${e}${r}${s}${o}${c}`}};var mn=class mn{constructor(){this.contractRepository=Q(Xu)}getContracts(){return this.contractRepository.getAll()}getContractById(t){return this.contractRepository.getById(t)}createContract(t){return V(this,null,function*(){if(!t.contractName)throw new Error("\u5408\u7D04\u540D\u7A31\u70BA\u5FC5\u586B\u9805\u76EE");if(t.totalAmount<=0)throw new Error("\u7E3D\u91D1\u984D\u5FC5\u9808\u5927\u65BC0");if(!t.endDate)throw new Error("\u7D50\u675F\u65E5\u671F\u70BA\u5FC5\u586B\u9805\u76EE");let e=new Date;if(t.endDate<=e)throw new Error("\u7D50\u675F\u65E5\u671F\u5FC5\u9808\u5728\u672A\u4F86");let r=or.create(t);return this.contractRepository.create(r)})}updateContract(t,e){return V(this,null,function*(){if(e.totalAmount!==void 0&&e.totalAmount<=0)throw new Error("\u7E3D\u91D1\u984D\u5FC5\u9808\u5927\u65BC0");return this.contractRepository.update(t,e)})}deleteContract(t){return V(this,null,function*(){return this.contractRepository.delete(t)})}};mn.\u0275fac=function(e){return new(e||mn)},mn.\u0275prov=De({token:mn,factory:mn.\u0275fac,providedIn:"root"});var ar=mn;function v_(n){if(!/^\d{12}$/.test(n))return!1;let e=parseInt(n.substring(0,4)),r=parseInt(n.substring(4,6)),s=parseInt(n.substring(6,8)),o=parseInt(n.substring(8,10)),c=parseInt(n.substring(10,12));return!(e<2020||e>2030||r<1||r>12||s<1||s>31||o<0||o>23||c<0||c>59)}function Hp(n){if(!v_(n))return n;let t=n.substring(0,4),e=n.substring(4,6),r=n.substring(6,8),s=n.substring(8,10),o=n.substring(10,12);return`${t}-${e}-${r} ${s}:${o}`}function T_(n,t){if(n&1){let e=Gt();z(0,"button",30),ct("click",function(){Et(e);let s=ut();return wt(s.toggleAdvanced())}),R(1),O()}if(n&2){let e=ut();D(),Mt(" ",e.showAdvanced?"\u7C21\u5316":"\u9AD8\u7D1A"," ")}}var cr=class cr{constructor(){this.search=new St;this.reset=new St;this.fb=Q(cs);this.showAdvanced=!1;this.initForm()}initForm(){this.searchForm=this.fb.group({keyword:[""],status:[null],contractType:[null],riskLevel:[null],startDate:[null],endDate:[null],clientCompany:[""]})}onSearch(){if(this.searchForm.valid){let t=this.searchForm.value;this.search.emit(t)}}onReset(){this.searchForm.reset(),this.reset.emit()}toggleAdvanced(){this.showAdvanced=!this.showAdvanced}};cr.\u0275fac=function(e){return new(e||cr)},cr.\u0275cmp=Y({type:cr,selectors:[["app-contract-search"]],outputs:{search:"search",reset:"reset"},decls:63,vars:11,consts:[["extraTemplate",""],["nzTitle","\u641C\u7D22\u689D\u4EF6",3,"nzExtra"],["nz-form","",3,"formGroup"],["nz-row","",3,"nzGutter"],[3,"nzSpan"],["nz-input","","formControlName","keyword","placeholder","\u5408\u7D04\u7DE8\u865F\u3001\u540D\u7A31\u3001\u5BA2\u6236\u516C\u53F8"],["formControlName","status","placeholder","\u8ACB\u9078\u64C7\u72C0\u614B","nzAllowClear",""],["nzValue","draft","nzLabel","\u8349\u7A3F"],["nzValue","pending_approval","nzLabel","\u5F85\u5BE9\u6279"],["nzValue","approved","nzLabel","\u5DF2\u5BE9\u6279"],["nzValue","active","nzLabel","\u57F7\u884C\u4E2D"],["nzValue","completed","nzLabel","\u5DF2\u5B8C\u6210"],["nzValue","terminated","nzLabel","\u5DF2\u7D42\u6B62"],["nzValue","expired","nzLabel","\u5DF2\u904E\u671F"],["formControlName","contractType","placeholder","\u8ACB\u9078\u64C7\u985E\u578B","nzAllowClear",""],["nzValue","pure_labor","nzLabel","\u7D14\u5DE5"],["nzValue","material_included","nzLabel","\u5E36\u6599"],["nzValue","subcontract","nzLabel","\u5206\u5305"],["nzValue","outsourcing","nzLabel","\u5916\u5305"],["formControlName","riskLevel","placeholder","\u8ACB\u9078\u64C7\u98A8\u96AA\u7B49\u7D1A","nzAllowClear",""],["nzValue","low","nzLabel","\u4F4E\u98A8\u96AA"],["nzValue","medium","nzLabel","\u4E2D\u98A8\u96AA"],["nzValue","high","nzLabel","\u9AD8\u98A8\u96AA"],["nzValue","critical","nzLabel","\u6975\u9AD8\u98A8\u96AA"],["formControlName","startDate",2,"width","100%"],["formControlName","endDate",2,"width","100%"],["nz-row",""],[2,"text-align","center",3,"nzSpan"],["nz-button","","nzType","primary",3,"click"],["nz-button","",2,"margin-left","8px",3,"click"],["nz-button","","nzSize","small",3,"click"]],template:function(e,r){if(e&1){let s=Gt();z(0,"nz-card",1)(1,"form",2)(2,"div",3)(3,"nz-col",4)(4,"nz-form-item")(5,"nz-form-label"),R(6,"\u95DC\u9375\u5B57"),O(),z(7,"nz-form-control"),ot(8,"input",5),O()()(),z(9,"nz-col",4)(10,"nz-form-item")(11,"nz-form-label"),R(12,"\u5408\u7D04\u72C0\u614B"),O(),z(13,"nz-form-control")(14,"nz-select",6),ot(15,"nz-option",7)(16,"nz-option",8)(17,"nz-option",9)(18,"nz-option",10)(19,"nz-option",11)(20,"nz-option",12)(21,"nz-option",13),O()()()(),z(22,"nz-col",4)(23,"nz-form-item")(24,"nz-form-label"),R(25,"\u5408\u7D04\u985E\u578B"),O(),z(26,"nz-form-control")(27,"nz-select",14),ot(28,"nz-option",15)(29,"nz-option",16)(30,"nz-option",17)(31,"nz-option",18),O()()()()(),z(32,"div",3)(33,"nz-col",4)(34,"nz-form-item")(35,"nz-form-label"),R(36,"\u98A8\u96AA\u7B49\u7D1A"),O(),z(37,"nz-form-control")(38,"nz-select",19),ot(39,"nz-option",20)(40,"nz-option",21)(41,"nz-option",22)(42,"nz-option",23),O()()()(),z(43,"nz-col",4)(44,"nz-form-item")(45,"nz-form-label"),R(46,"\u958B\u59CB\u65E5\u671F"),O(),z(47,"nz-form-control"),ot(48,"nz-date-picker",24),O()()(),z(49,"nz-col",4)(50,"nz-form-item")(51,"nz-form-label"),R(52,"\u7D50\u675F\u65E5\u671F"),O(),z(53,"nz-form-control"),ot(54,"nz-date-picker",25),O()()()(),z(55,"div",26)(56,"nz-col",27)(57,"button",28),ct("click",function(){return Et(s),wt(r.onSearch())}),R(58," \u641C\u7D22 "),O(),z(59,"button",29),ct("click",function(){return Et(s),wt(r.onReset())}),R(60," \u91CD\u7F6E "),O()()()()(),Yt(61,T_,2,1,"ng-template",null,0,Yi)}if(e&2){let s=wn(62);F("nzExtra",s),D(),F("formGroup",r.searchForm),D(),F("nzGutter",16),D(),F("nzSpan",8),D(6),F("nzSpan",8),D(13),F("nzSpan",8),D(10),F("nzGutter",16),D(),F("nzSpan",8),D(10),F("nzSpan",8),D(6),F("nzSpan",8),D(7),F("nzSpan",24)}},dependencies:[Z,us,ss,rs,xn,is,os,as,vs,ke,Ve,gs,fs,_s,ys,Vn,Nn,Pn,Dn,Rn,ms,ds,Sn,An,Cn,bn,Oe,Fe,ze],encapsulation:2});var Ci=cr;var ur=class ur{getStatusColor(){return{draft:"default",pending_approval:"orange",approved:"blue",active:"green",completed:"cyan",terminated:"red",expired:"volcano"}[this.status]||"default"}getStatusText(){return{draft:"\u8349\u7A3F",pending_approval:"\u5F85\u5BE9\u6279",approved:"\u5DF2\u5BE9\u6279",active:"\u57F7\u884C\u4E2D",completed:"\u5DF2\u5B8C\u6210",terminated:"\u5DF2\u7D42\u6B62",expired:"\u5DF2\u904E\u671F"}[this.status]||"\u672A\u77E5"}};ur.\u0275fac=function(e){return new(e||ur)},ur.\u0275cmp=Y({type:ur,selectors:[["app-contract-status-badge"]],inputs:{status:"status"},decls:2,vars:2,consts:[[3,"nzColor"]],template:function(e,r){e&1&&(z(0,"nz-tag",0),R(1),O()),e&2&&(F("nzColor",r.getStatusColor()),D(),Mt(" ",r.getStatusText()," "))},dependencies:[Z,hs,ls],encapsulation:2});var bi=ur;var A_=()=>[10,20,50];function S_(n,t){if(n&1){let e=Gt();z(0,"tr")(1,"td")(2,"span",7),R(3),O()(),z(4,"td"),R(5),O(),z(6,"td")(7,"nz-tag",8),R(8),O()(),z(9,"td"),R(10),O(),z(11,"td"),R(12),O(),z(13,"td"),R(14),dh(15,"currency"),O(),z(16,"td"),ot(17,"app-contract-status-badge",9),O(),z(18,"td")(19,"nz-space")(20,"button",10),ct("click",function(){let s=Et(e).$implicit,o=ut();return wt(o.viewContract(s))}),R(21," \u67E5\u770B "),O(),z(22,"button",11),ct("click",function(){let s=Et(e).$implicit,o=ut();return wt(o.editContract(s))}),R(23," \u7DE8\u8F2F "),O(),z(24,"button",12),ct("click",function(){let s=Et(e).$implicit,o=ut();return wt(o.deleteContract(s))}),R(25," \u522A\u9664 "),O()()()()}if(n&2){let e=t.$implicit,r=ut();D(2),F("nzTooltipTitle",e.contractNumber),D(),Mt(" ",r.formatContractNumber(e.contractNumber)," "),D(2),Wr(e.contractName),D(2),F("nzColor",r.getContractTypeColor(e.contractType)),D(),Mt(" ",r.getContractTypeText(e.contractType)," "),D(2),Wr(e.clientCompany),D(2),Wr(e.clientRepresentative),D(2),Wr(mh(15,9,e.totalAmount,"TWD","symbol","1.0-0")),D(3),F("status",e.status)}}var lr=class lr{constructor(){this.contractService=Q(ar);this.router=Q(ts);this.message=Q(ns);this.contracts$=this.contractService.getContracts();this.loading=!1;this.displayContracts=[];this.allContracts=[]}ngOnInit(){this.loadContracts()}loadContracts(){this.loading=!0,this.contracts$.subscribe({next:t=>{this.allContracts=t,this.displayContracts=t,this.loading=!1},error:t=>{console.error("Error loading contracts:",t),this.message.error("\u8F09\u5165\u5408\u7D04\u5217\u8868\u5931\u6557"),this.loading=!1}})}createContract(){this.router.navigate(["/dashboard/contract-management/create"])}viewContract(t){this.router.navigate(["/dashboard/contract-management",t.id])}editContract(t){this.router.navigate(["/dashboard/contract-management",t.id,"edit"])}deleteContract(t){return V(this,null,function*(){try{yield this.contractService.deleteContract(t.id),this.message.success("\u5408\u7D04\u522A\u9664\u6210\u529F"),this.loadContracts()}catch(e){console.error("Error deleting contract:",e),this.message.error("\u5408\u7D04\u522A\u9664\u5931\u6557")}})}formatContractNumber(t){return Hp(t)}getContractTypeText(t){return{pure_labor:"\u7D14\u5DE5",material_included:"\u5E36\u6599",subcontract:"\u5206\u5305",outsourcing:"\u5916\u5305"}[t]||"\u672A\u77E5"}getContractTypeColor(t){return{pure_labor:"blue",material_included:"green",subcontract:"orange",outsourcing:"purple"}[t]||"default"}onSearch(t){this.displayContracts=this.allContracts.filter(e=>{if(t.keyword){let r=t.keyword.toLowerCase();if(!(e.contractNumber.toLowerCase().includes(r)||e.contractName.toLowerCase().includes(r)||e.clientCompany.toLowerCase().includes(r)))return!1}return!(t.status&&e.status!==t.status||t.contractType&&e.contractType!==t.contractType||t.riskLevel&&e.riskLevel!==t.riskLevel||t.startDate&&e.startDate<t.startDate||t.endDate&&e.endDate>t.endDate||t.clientCompany&&!e.clientCompany.toLowerCase().includes(t.clientCompany.toLowerCase()))})}onReset(){this.displayContracts=this.allContracts}};lr.\u0275fac=function(e){return new(e||lr)},lr.\u0275cmp=Y({type:lr,selectors:[["app-contract-list"]],decls:31,vars:7,consts:[["basicTable",""],["nz-row","","nzJustify","space-between","nzAlign","middle",1,"mb-4"],["nz-typography",""],["nz-button","","nzType","primary",3,"click"],[3,"search","reset"],["nzShowSizeChanger","","nzShowQuickJumper","",3,"nzData","nzLoading","nzTotal","nzPageSize","nzPageSizeOptions"],[4,"ngFor","ngForOf"],["nz-tooltip","",3,"nzTooltipTitle"],[3,"nzColor"],[3,"status"],["nz-button","","nzSize","small",3,"click"],["nz-button","","nzSize","small","nzType","primary",3,"click"],["nz-button","","nzSize","small","nzDanger","",3,"click"]],template:function(e,r){if(e&1){let s=Gt();z(0,"nz-card")(1,"div",1)(2,"nz-col")(3,"h2",2),R(4,"\u5408\u7D04\u7BA1\u7406"),O()(),z(5,"nz-col")(6,"button",3),ct("click",function(){return Et(s),wt(r.createContract())}),R(7," \u65B0\u589E\u5408\u7D04 "),O()()(),z(8,"app-contract-search",4),ct("search",function(c){return Et(s),wt(r.onSearch(c))})("reset",function(){return Et(s),wt(r.onReset())}),O(),z(9,"nz-table",5,0)(11,"thead")(12,"tr")(13,"th"),R(14,"\u5408\u7D04\u7DE8\u865F"),O(),z(15,"th"),R(16,"\u5408\u7D04\u540D\u7A31"),O(),z(17,"th"),R(18,"\u5408\u7D04\u985E\u578B"),O(),z(19,"th"),R(20,"\u5BA2\u6236\u516C\u53F8"),O(),z(21,"th"),R(22,"\u5BA2\u6236\u4EE3\u8868"),O(),z(23,"th"),R(24,"\u7E3D\u91D1\u984D"),O(),z(25,"th"),R(26,"\u72C0\u614B"),O(),z(27,"th"),R(28,"\u64CD\u4F5C"),O()()(),z(29,"tbody"),Yt(30,S_,26,14,"tr",6),O()()()}if(e&2){let s=wn(10);D(9),F("nzData",r.displayContracts)("nzLoading",r.loading)("nzTotal",r.displayContracts.length)("nzPageSize",10)("nzPageSizeOptions",lh(6,A_)),D(21),F("ngForOf",s.data)}},dependencies:[Z,Zi,rd,td,Yh,Jh,nd,Zh,ed,Sn,An,Cn,bn,Th,wh,Oe,Fe,Es,Jr,ze,ke,Ve,Yr,Xr,hs,ls,bi,Ci,gh],styles:[".mb-4[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Io=lr;function x_(n,t){if(n&1&&ot(0,"nz-option",2),n&2){let e=t.$implicit;F("nzValue",e.value)("nzLabel",e.label)}}var hr=class hr{constructor(){this.placeholder="\u8ACB\u9078\u64C7\u5408\u7D04\u985E\u578B";this.allowClear=!0;this.valueChange=new St;this.contractTypes=[{value:"pure_labor",label:"\u7D14\u5DE5"},{value:"material_included",label:"\u5E36\u6599"},{value:"subcontract",label:"\u5206\u5305"},{value:"outsourcing",label:"\u5916\u5305"}]}onChange(t){this.valueChange.emit(t)}};hr.\u0275fac=function(e){return new(e||hr)},hr.\u0275cmp=Y({type:hr,selectors:[["app-contract-type-select"]],inputs:{value:"value",placeholder:"placeholder",allowClear:"allowClear"},outputs:{valueChange:"valueChange"},decls:2,vars:4,consts:[[3,"ngModelChange","ngModel","nzPlaceHolder","nzAllowClear"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"]],template:function(e,r){e&1&&(z(0,"nz-select",0),ct("ngModelChange",function(o){return r.onChange(o)}),Yt(1,x_,1,2,"nz-option",1),O()),e&2&&(F("ngModel",r.value)("nzPlaceHolder",r.placeholder)("nzAllowClear",r.allowClear),D(),F("ngForOf",r.contractTypes))},dependencies:[Z,Zi,Xh,xn,Hh,Pn,Dn,Rn],encapsulation:2});var Ai=hr;function D_(n,t){n&1&&ot(0,"nz-alert",2)}var dr=class dr{constructor(){this.loading=!1;this.isEdit=!1;this.submit=new St;this.cancel=new St;this.fb=Q(cs)}ngOnInit(){this.initForm()}initForm(){this.contractForm=this.fb.group({contractName:["",[ie.required]],contractType:["pure_labor",[ie.required]],riskLevel:["low",[ie.required]],clientCompany:["",[ie.required]],clientRepresentative:["",[ie.required]],clientContact:[""],clientEmail:[""],endDate:[null,[ie.required]],totalAmount:[null,[ie.required,ie.min(0)]],currency:["TWD",[ie.required]],status:["draft"],paymentStatus:["pending"],paidAmount:[0],paymentSchedule:[[]],approvalStatus:[{status:"pending",currentStep:1,totalSteps:3}],approvers:[[]],documents:[[]],risks:[[]]}),this.contract&&this.contractForm.patchValue(this.contract)}onSubmit(){if(this.contractForm.valid){let t=this.contractForm.value;if(this.isEdit&&this.contract){let e=vn(vn({},this.contract),t);this.submit.emit(e)}else{let e={contractName:t.contractName,contractType:t.contractType,riskLevel:t.riskLevel,clientCompany:t.clientCompany,clientRepresentative:t.clientRepresentative,clientContact:t.clientContact,clientEmail:t.clientEmail,endDate:t.endDate,totalAmount:t.totalAmount,currency:t.currency,paymentStatus:t.paymentStatus,paidAmount:t.paidAmount,paymentSchedule:t.paymentSchedule,approvalStatus:t.approvalStatus,approvers:t.approvers,documents:t.documents,risks:t.risks},r=or.create(e);this.submit.emit(r)}}else Object.values(this.contractForm.controls).forEach(t=>{t.invalid&&t.markAsTouched()})}onCancel(){this.cancel.emit()}};dr.\u0275fac=function(e){return new(e||dr)},dr.\u0275cmp=Y({type:dr,selectors:[["app-contract-form"]],inputs:{contract:"contract",loading:"loading",isEdit:"isEdit"},outputs:{submit:"submit",cancel:"cancel"},decls:83,vars:44,consts:[["nz-form","",3,"ngSubmit","formGroup"],[3,"nzTitle"],["nzType","info","nzMessage","\u5408\u7D04\u7DE8\u865F\u5C07\u81EA\u52D5\u751F\u6210","nzDescription","\u683C\u5F0F\uFF1AYYYYMMDDHHMM (\u5E74+\u6708+\u65E5+\u6642\u5206)",1,"mb-4"],["nz-row","",3,"nzGutter"],[3,"nzSpan"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u8F38\u5165\u5408\u7D04\u540D\u7A31",3,"nzSpan"],["nz-input","","formControlName","contractName","placeholder","\u8ACB\u8F38\u5165\u5408\u7D04\u540D\u7A31"],["nzErrorTip","\u8ACB\u9078\u64C7\u5408\u7D04\u985E\u578B",3,"nzSpan"],["formControlName","contractType","placeholder","\u8ACB\u9078\u64C7\u5408\u7D04\u985E\u578B"],["nzErrorTip","\u8ACB\u9078\u64C7\u98A8\u96AA\u7B49\u7D1A",3,"nzSpan"],["formControlName","riskLevel","placeholder","\u8ACB\u9078\u64C7\u98A8\u96AA\u7B49\u7D1A"],["nzValue","low","nzLabel","\u4F4E\u98A8\u96AA"],["nzValue","medium","nzLabel","\u4E2D\u98A8\u96AA"],["nzValue","high","nzLabel","\u9AD8\u98A8\u96AA"],["nzValue","critical","nzLabel","\u6975\u9AD8\u98A8\u96AA"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BA2\u6236\u516C\u53F8",3,"nzSpan"],["nz-input","","formControlName","clientCompany","placeholder","\u8ACB\u8F38\u5165\u5BA2\u6236\u516C\u53F8"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BA2\u6236\u4EE3\u8868",3,"nzSpan"],["nz-input","","formControlName","clientRepresentative","placeholder","\u8ACB\u8F38\u5165\u5BA2\u6236\u4EE3\u8868"],["nz-input","","formControlName","clientContact","placeholder","\u8ACB\u8F38\u5165\u806F\u7E6B\u96FB\u8A71"],["nz-input","","formControlName","clientEmail","placeholder","\u8ACB\u8F38\u5165\u96FB\u5B50\u90F5\u4EF6"],["nzErrorTip","\u8ACB\u9078\u64C7\u7D50\u675F\u65E5\u671F",3,"nzSpan"],["formControlName","endDate",2,"width","100%"],["nzErrorTip","\u8ACB\u8F38\u5165\u7E3D\u91D1\u984D",3,"nzSpan"],["formControlName","totalAmount","placeholder","\u8ACB\u8F38\u5165\u7E3D\u91D1\u984D",2,"width","100%",3,"nzMin","nzStep"],["nzErrorTip","\u8ACB\u9078\u64C7\u5E63\u7A2E",3,"nzSpan"],["formControlName","currency","placeholder","\u8ACB\u9078\u64C7\u5E63\u7A2E"],["nzValue","TWD","nzLabel","\u65B0\u53F0\u5E63"],["nzValue","USD","nzLabel","\u7F8E\u5143"],["nzValue","EUR","nzLabel","\u6B50\u5143"],["nzValue","JPY","nzLabel","\u65E5\u5713"],["nz-row",""],[2,"text-align","center",3,"nzSpan"],["nz-button","","nzType","primary","type","submit",3,"nzLoading"],["nz-button","","type","button",2,"margin-left","8px",3,"click"]],template:function(e,r){e&1&&(z(0,"form",0),ct("ngSubmit",function(){return r.onSubmit()}),z(1,"nz-card",1),qt(2,D_,1,0,"nz-alert",2),z(3,"div",3)(4,"nz-col",4)(5,"nz-form-item")(6,"nz-form-label",5),R(7,"\u5408\u7D04\u540D\u7A31"),O(),z(8,"nz-form-control",6),ot(9,"input",7),O()()(),z(10,"nz-col",4)(11,"nz-form-item")(12,"nz-form-label",5),R(13,"\u5408\u7D04\u985E\u578B"),O(),z(14,"nz-form-control",8),ot(15,"app-contract-type-select",9),O()()()(),z(16,"div",3)(17,"nz-col",4)(18,"nz-form-item")(19,"nz-form-label",5),R(20,"\u98A8\u96AA\u7B49\u7D1A"),O(),z(21,"nz-form-control",10)(22,"nz-select",11),ot(23,"nz-option",12)(24,"nz-option",13)(25,"nz-option",14)(26,"nz-option",15),O()()()()(),z(27,"div",3)(28,"nz-col",4)(29,"nz-form-item")(30,"nz-form-label",5),R(31,"\u5BA2\u6236\u516C\u53F8"),O(),z(32,"nz-form-control",16),ot(33,"input",17),O()()(),z(34,"nz-col",4)(35,"nz-form-item")(36,"nz-form-label",5),R(37,"\u5BA2\u6236\u4EE3\u8868"),O(),z(38,"nz-form-control",18),ot(39,"input",19),O()()()(),z(40,"div",3)(41,"nz-col",4)(42,"nz-form-item")(43,"nz-form-label",4),R(44,"\u806F\u7E6B\u96FB\u8A71"),O(),z(45,"nz-form-control",4),ot(46,"input",20),O()()(),z(47,"nz-col",4)(48,"nz-form-item")(49,"nz-form-label",4),R(50,"\u96FB\u5B50\u90F5\u4EF6"),O(),z(51,"nz-form-control",4),ot(52,"input",21),O()()()(),z(53,"div",3)(54,"nz-col",4)(55,"nz-form-item")(56,"nz-form-label",5),R(57,"\u7D50\u675F\u65E5\u671F"),O(),z(58,"nz-form-control",22),ot(59,"nz-date-picker",23),O()()(),z(60,"nz-col",4)(61,"nz-form-item")(62,"nz-form-label",5),R(63,"\u7E3D\u91D1\u984D"),O(),z(64,"nz-form-control",24),ot(65,"nz-input-number",25),O()()()(),z(66,"div",3)(67,"nz-col",4)(68,"nz-form-item")(69,"nz-form-label",5),R(70,"\u5E63\u7A2E"),O(),z(71,"nz-form-control",26)(72,"nz-select",27),ot(73,"nz-option",28)(74,"nz-option",29)(75,"nz-option",30)(76,"nz-option",31),O()()()()(),z(77,"div",32)(78,"nz-col",33)(79,"button",34),R(80),O(),z(81,"button",35),ct("click",function(){return r.onCancel()}),R(82," \u53D6\u6D88 "),O()()()()()),e&2&&(F("formGroup",r.contractForm),D(),F("nzTitle",r.isEdit?"\u7DE8\u8F2F\u5408\u7D04":"\u65B0\u589E\u5408\u7D04"),D(),Ut(r.isEdit?-1:2),D(),F("nzGutter",16),D(),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzGutter",16),D(),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(6),F("nzGutter",16),D(),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzGutter",16),D(),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzGutter",16),D(),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(2),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(),F("nzMin",0)("nzStep",1e3),D(),F("nzGutter",16),D(),F("nzSpan",12),D(2),F("nzSpan",6),D(2),F("nzSpan",18),D(7),F("nzSpan",24),D(),F("nzLoading",r.loading),D(),Mt(" ",r.isEdit?"\u66F4\u65B0\u5408\u7D04":"\u65B0\u589E\u5408\u7D04"," "))},dependencies:[Z,us,ss,rs,xn,is,os,as,vs,ke,Ve,gs,fs,_s,ys,Vn,Nn,sd,id,ms,ds,Pn,Dn,Rn,Sn,An,Cn,bn,Oe,Fe,ze,ad,od,Ai],styles:[".mb-4[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Si=dr;var mr=class mr{constructor(){this.loading=!1;this.contractService=Q(ar);this.router=Q(ts);this.message=Q(ns)}onSubmit(t){return V(this,null,function*(){this.loading=!0;try{let e={contractName:t.contractName,contractType:t.contractType,riskLevel:t.riskLevel,clientCompany:t.clientCompany,clientRepresentative:t.clientRepresentative,clientContact:t.clientContact,clientEmail:t.clientEmail,endDate:t.endDate,totalAmount:t.totalAmount,currency:t.currency,paymentStatus:t.paymentStatus,paidAmount:t.paidAmount,paymentSchedule:t.paymentSchedule,approvalStatus:t.approvalStatus,approvers:t.approvers,documents:t.documents,risks:t.risks},r=yield this.contractService.createContract(e);this.message.success(`\u5408\u7D04\u65B0\u589E\u6210\u529F\uFF0C\u5408\u7D04\u7DE8\u865F\uFF1A${r}`),this.router.navigate(["/dashboard/contract-management"])}catch(e){console.error("Error creating contract:",e),this.message.error(`\u5408\u7D04\u65B0\u589E\u5931\u6557\uFF1A${e.message}`)}finally{this.loading=!1}})}goBack(){this.router.navigate(["/dashboard/contract-management"])}};mr.\u0275fac=function(e){return new(e||mr)},mr.\u0275cmp=Y({type:mr,selectors:[["app-contract-create"]],decls:9,vars:1,consts:[["nz-row","","nzJustify","space-between","nzAlign","middle",1,"mb-4"],["nz-typography",""],["nz-button","",3,"click"],[3,"submit","cancel","loading"]],template:function(e,r){e&1&&(z(0,"nz-card")(1,"div",0)(2,"nz-col")(3,"h2",1),R(4,"\u65B0\u589E\u5408\u7D04"),O()(),z(5,"nz-col")(6,"button",2),ct("click",function(){return r.goBack()}),R(7," \u8FD4\u56DE\u5217\u8868 "),O()()(),z(8,"app-contract-form",3),ct("submit",function(o){return r.onSubmit(o)})("cancel",function(){return r.goBack()}),O()()),e&2&&(D(8),F("loading",r.loading))},dependencies:[Z,Oe,Fe,Es,Jr,ze,ke,Ve,Si],styles:[".mb-4[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Co=mr;var pr=class pr{constructor(){}};pr.\u0275fac=function(e){return new(e||pr)},pr.\u0275cmp=Y({type:pr,selectors:[["app-contract-detail"]],decls:6,vars:0,consts:[[1,"contract-detail-container"],[1,"contract-detail-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5408\u7D04\u8A73\u60C5"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5408\u7D04\u8A73\u60C5\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".contract-detail-container[_ngcontent-%COMP%]{padding:24px}.contract-detail-content[_ngcontent-%COMP%]{margin-top:16px}"]});var bo=pr;var fr=class fr{constructor(){}};fr.\u0275fac=function(e){return new(e||fr)},fr.\u0275cmp=Y({type:fr,selectors:[["app-contract-edit"]],decls:6,vars:0,consts:[[1,"contract-edit-container"],[1,"contract-edit-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5408\u7D04\u7DE8\u8F2F"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5408\u7D04\u7DE8\u8F2F\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".contract-edit-container[_ngcontent-%COMP%]{padding:24px}.contract-edit-content[_ngcontent-%COMP%]{margin-top:16px}"]});var Ao=fr;var gr=class gr{constructor(){}};gr.\u0275fac=function(e){return new(e||gr)},gr.\u0275cmp=Y({type:gr,selectors:[["app-personnel-list"]],decls:6,vars:0,consts:[[1,"personnel-list-container"],[1,"personnel-list-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u4EBA\u54E1\u7BA1\u7406"),nt(),et(3,"div",1)(4,"p"),R(5,"\u4EBA\u54E1\u5217\u8868\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".personnel-list-container[_ngcontent-%COMP%]{padding:24px}.personnel-list-content[_ngcontent-%COMP%]{margin-top:16px}"]});var So=gr;var yr=class yr{constructor(){}};yr.\u0275fac=function(e){return new(e||yr)},yr.\u0275cmp=Y({type:yr,selectors:[["app-personnel-detail"]],decls:6,vars:0,consts:[[1,"personnel-detail-container"],[1,"personnel-detail-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u4EBA\u54E1\u8A73\u60C5"),nt(),et(3,"div",1)(4,"p"),R(5,"\u4EBA\u54E1\u8A73\u60C5\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".personnel-detail-container[_ngcontent-%COMP%]{padding:24px}.personnel-detail-content[_ngcontent-%COMP%]{margin-top:16px}"]});var xo=yr;var _r=class _r{constructor(){}};_r.\u0275fac=function(e){return new(e||_r)},_r.\u0275cmp=Y({type:_r,selectors:[["app-personnel-edit"]],decls:6,vars:0,consts:[[1,"personnel-edit-container"],[1,"personnel-edit-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u4EBA\u54E1\u7DE8\u8F2F"),nt(),et(3,"div",1)(4,"p"),R(5,"\u4EBA\u54E1\u7DE8\u8F2F\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".personnel-edit-container[_ngcontent-%COMP%]{padding:24px}.personnel-edit-content[_ngcontent-%COMP%]{margin-top:16px}"]});var Do=_r;var yI=[];var vr=class vr{constructor(){}};vr.\u0275fac=function(e){return new(e||vr)},vr.\u0275cmp=Y({type:vr,selectors:[["app-project-list"]],decls:6,vars:0,consts:[[1,"project-list-container"],[1,"project-list-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5C08\u6848\u7BA1\u7406"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5C08\u6848\u5217\u8868\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".project-list-container[_ngcontent-%COMP%]{padding:24px}.project-list-content[_ngcontent-%COMP%]{margin-top:16px}"]});var Ro=vr;var Er=class Er{constructor(){}};Er.\u0275fac=function(e){return new(e||Er)},Er.\u0275cmp=Y({type:Er,selectors:[["app-project-detail"]],decls:6,vars:0,consts:[[1,"project-detail-container"],[1,"project-detail-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5C08\u6848\u8A73\u60C5"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5C08\u6848\u8A73\u60C5\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".project-detail-container[_ngcontent-%COMP%]{padding:24px}.project-detail-content[_ngcontent-%COMP%]{margin-top:16px}"]});var Po=Er;var wr=class wr{constructor(){}};wr.\u0275fac=function(e){return new(e||wr)},wr.\u0275cmp=Y({type:wr,selectors:[["app-project-edit"]],decls:6,vars:0,consts:[[1,"project-edit-container"],[1,"project-edit-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5C08\u6848\u7DE8\u8F2F"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5C08\u6848\u7DE8\u8F2F\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".project-edit-container[_ngcontent-%COMP%]{padding:24px}.project-edit-content[_ngcontent-%COMP%]{margin-top:16px}"]});var No=wr;var MI=[];var Tr=class Tr{constructor(){}};Tr.\u0275fac=function(e){return new(e||Tr)},Tr.\u0275cmp=Y({type:Tr,selectors:[["app-site-list"]],decls:6,vars:0,consts:[[1,"site-list-container"],[1,"site-list-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5834\u5730\u7BA1\u7406"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5834\u5730\u5217\u8868\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".site-list-container[_ngcontent-%COMP%]{padding:24px}.site-list-content[_ngcontent-%COMP%]{margin-top:16px}"]});var Vo=Tr;var Ir=class Ir{constructor(){}};Ir.\u0275fac=function(e){return new(e||Ir)},Ir.\u0275cmp=Y({type:Ir,selectors:[["app-site-detail"]],decls:6,vars:0,consts:[[1,"site-detail-container"],[1,"site-detail-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5834\u5730\u8A73\u60C5"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5834\u5730\u8A73\u60C5\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".site-detail-container[_ngcontent-%COMP%]{padding:24px}.site-detail-content[_ngcontent-%COMP%]{margin-top:16px}"]});var ko=Ir;var Cr=class Cr{constructor(){}};Cr.\u0275fac=function(e){return new(e||Cr)},Cr.\u0275cmp=Y({type:Cr,selectors:[["app-site-edit"]],decls:6,vars:0,consts:[[1,"site-edit-container"],[1,"site-edit-content"]],template:function(e,r){e&1&&(et(0,"div",0)(1,"h2"),R(2,"\u5834\u5730\u7DE8\u8F2F"),nt(),et(3,"div",1)(4,"p"),R(5,"\u5834\u5730\u7DE8\u8F2F\u9801\u9762 - DDD\u67B6\u69CB"),nt()()())},dependencies:[Z],styles:[".site-edit-container[_ngcontent-%COMP%]{padding:24px}.site-edit-content[_ngcontent-%COMP%]{margin-top:16px}"]});var zo=Cr;var sC=[];var nf=new Je("CompanyRepository");var xi=class n{constructor(t,e,r,s,o,c="active",l="low",h="",m="",f=[],v=new Date,C=new Date){this.id=t;this.companyName=e;this.businessRegistrationNumber=r;this.address=s;this.businessPhone=o;this.status=c;this.riskLevel=l;this.fax=h;this.website=m;this.contacts=f;this.createdAt=v;this.updatedAt=C}static create(t){if(!t.companyName?.trim())throw new Error("Company name is required");if(!t.businessRegistrationNumber?.trim())throw new Error("Business registration number is required");if(!t.address?.trim())throw new Error("Address is required");if(!t.businessPhone?.trim())throw new Error("Business phone is required");return new n(this.generateId(),t.companyName.trim(),t.businessRegistrationNumber.trim(),t.address.trim(),t.businessPhone.trim(),t.status||"active",t.riskLevel||"low",t.fax?.trim()||"",t.website?.trim()||"",t.contacts||[])}update(t){return new n(this.id,t.companyName?.trim()||this.companyName,t.businessRegistrationNumber?.trim()||this.businessRegistrationNumber,t.address?.trim()||this.address,t.businessPhone?.trim()||this.businessPhone,t.status||this.status,t.riskLevel||this.riskLevel,t.fax?.trim()??this.fax,t.website?.trim()??this.website,t.contacts||this.contacts,this.createdAt,new Date)}addContact(t){let e=[...this.contacts];return t.isPrimary&&e.forEach(r=>r.isPrimary=!1),e.push(t),new n(this.id,this.companyName,this.businessRegistrationNumber,this.address,this.businessPhone,this.status,this.riskLevel,this.fax,this.website,e,this.createdAt,new Date)}updateContact(t,e){let r=[...this.contacts];return t>=0&&t<r.length&&(r[t]=e),new n(this.id,this.companyName,this.businessRegistrationNumber,this.address,this.businessPhone,this.status,this.riskLevel,this.fax,this.website,r,this.createdAt,new Date)}removeContact(t){let e=[...this.contacts];return t>=0&&t<e.length&&e.splice(t,1),new n(this.id,this.companyName,this.businessRegistrationNumber,this.address,this.businessPhone,this.status,this.riskLevel,this.fax,this.website,e,this.createdAt,new Date)}isActive(){return this.status==="active"}isHighRisk(){return this.riskLevel==="high"}getPrimaryContact(){return this.contacts.find(t=>t.isPrimary)||null}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}toPlainObject(){return{id:this.id,companyName:this.companyName,businessRegistrationNumber:this.businessRegistrationNumber,address:this.address,businessPhone:this.businessPhone,status:this.status,riskLevel:this.riskLevel,fax:this.fax,website:this.website,contacts:this.contacts,createdAt:this.createdAt.toISOString(),updatedAt:this.updatedAt.toISOString()}}};var pn=class pn{constructor(){this.firestore=Q(Ie);this.collectionName="companies"}getAll(){let t=Ii(this.firestore,this.collectionName);return Ye(Qp(t)).pipe(ee(e=>e.docs.map(r=>this.mapDocToCompany(r))))}getById(t){let e=Ce(this.firestore,this.collectionName,t);return Ye(Kp(e)).pipe(ee(r=>{if(!r.exists())throw new Error(`Company with id ${t} not found`);return this.mapDocToCompany(r)}))}save(t){return!t.id||t.id===""?this.create(t):this.update(t)}create(t){let e=Ii(this.firestore,this.collectionName),r=t.toPlainObject();return delete r.id,Ye(Gp(e,r)).pipe(ee(s=>new xi(s.id,t.companyName,t.businessRegistrationNumber,t.address,t.businessPhone,t.status,t.riskLevel,t.fax,t.website,t.contacts,t.createdAt,new Date)))}update(t){let e=Ce(this.firestore,this.collectionName,t.id),r=t.toPlainObject();return delete r.id,Ye(wo(e,r)).pipe(ee(()=>t))}delete(t){let e=Ce(this.firestore,this.collectionName,t);return Ye(Eo(e))}search(t){return this.getAll().pipe(ee(e=>e.filter(r=>r.companyName.toLowerCase().includes(t.toLowerCase())||r.businessRegistrationNumber.includes(t))))}mapDocToCompany(t){let e=t.data();return new xi(t.id,e.companyName,e.businessRegistrationNumber,e.address,e.businessPhone,e.status,e.riskLevel,e.fax||"",e.website||"",e.contacts||[],new Date(e.createdAt),new Date(e.updatedAt))}};pn.\u0275fac=function(e){return new(e||pn)},pn.\u0275prov=De({token:pn,factory:pn.\u0275fac,providedIn:"root"});var Fo=pn;var CC=[{provide:nf,useClass:Fo}];export{Jv as a,Zv as b,nf as c,xi as d,CC as e,lE as f,Io as g,Co as h,So as i,yI as j,Ro as k,MI as l,Vo as m,sC as n};
