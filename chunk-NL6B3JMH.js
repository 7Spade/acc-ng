import{l as ve,o as ye}from"./chunk-YQMWIKIV.js";import{f as pe,g as de,h as fe,i as ze,j as he}from"./chunk-WVPDNXYH.js";import{C as ee,E as te,G as ie,H as oe,I as ae,O as me,T as ue,b as j,c as i,e as $,f as H,l as U,o as W,p as J,q as K,r as Q,t as X,v as Y,x as Z}from"./chunk-Q27INKBG.js";import{a as re,b as ne,c as se,d as le,e as ce}from"./chunk-JHA3YXM4.js";import{d as O}from"./chunk-EAEFT3AC.js";import{Ab as C,Eg as V,Gg as R,Ha as o,Hg as q,Kb as B,Ma as c,Oa as E,Pb as u,Rb as P,Sc as w,Ua as S,Xh as Ce,Yh as ge,db as N,fb as _,gb as x,hb as A,ib as g,jb as v,ka as F,kb as a,la as b,lb as t,lc as T,mb as n,nb as s,ng as L,og as k,ra as h,sd as M,ub as D,wd as I,xb as f,xg as G}from"./chunk-WYL5GNHD.js";import{i as z}from"./chunk-57BLH6QZ.js";function be(l,m){if(l&1&&s(0,"nz-option",10),l&2){let r=m.$implicit;a("nzValue",r)("nzLabel",r)}}function Ee(l,m){if(l&1){let r=D();t(0,"button",33),f("click",function(){F(r);let d=C(2).$index,y=C();return b(y.removeContact(d))}),s(1,"nz-icon",34),u(2," \u79FB\u9664 "),n()}}function Se(l,m){if(l&1&&N(0,Ee,3,0,"button",32),l&2){let r=C(2);_(r.contactsArray.length>1?0:-1)}}function Ne(l,m){if(l&1&&(t(0,"nz-card",16),S(1,Se,1,1,"ng-template",null,0,T),t(3,"div",3)(4,"div",4)(5,"nz-form-item")(6,"nz-form-label",5),u(7,"\u59D3\u540D"),n(),t(8,"nz-form-control",23),s(9,"input",24),n()()(),t(10,"div",4)(11,"nz-form-item")(12,"nz-form-label",5),u(13,"\u8077\u4F4D"),n(),t(14,"nz-form-control",25),s(15,"input",26),n()()()(),t(16,"div",3)(17,"div",4)(18,"nz-form-item")(19,"nz-form-label",5),u(20,"\u96FB\u5B50\u90F5\u4EF6"),n(),t(21,"nz-form-control",27),s(22,"input",28),n()()(),t(23,"div",4)(24,"nz-form-item")(25,"nz-form-label"),u(26,"\u96FB\u8A71"),n(),t(27,"nz-form-control"),s(28,"input",29),n()()()(),t(29,"div",30)(30,"label",31),u(31," \u8A2D\u70BA\u4E3B\u8981\u806F\u7D61\u4EBA "),n()()()),l&2){let r=m.$index,e=B(2);a("formGroupName",r)("nzTitle","\u806F\u7D61\u4EBA "+(r+1))("nzExtra",e),o(3),a("nzGutter",16),o(),a("nzSpan",12),o(6),a("nzSpan",12),o(6),a("nzGutter",16),o(),a("nzSpan",12),o(6),a("nzSpan",12)}}var p=class p{constructor(m,r,e,d,y){this.fb=m;this.partnerService=r;this.router=e;this.route=d;this.message=y;this.loading=h(!1);this.isEdit=h(!1);this.partnerId=h(null);this.industries=ve;this.maxContacts=10;this.form=this.fb.group({companyName:["",[i.required,i.minLength(2),i.maxLength(100)]],industry:["",i.required],website:[""],address:["",i.maxLength(500)],contacts:this.fb.array([this.createContactForm()])})}ngOnInit(){return z(this,null,function*(){let m=this.route.snapshot.paramMap.get("id");m&&(this.isEdit.set(!0),this.partnerId.set(m),yield this.loadPartner(m))})}get contactsArray(){return this.form.get("contacts")}createContactForm(){return this.fb.group({name:["",[i.required,i.maxLength(50)]],email:["",[i.required,i.email,i.maxLength(100)]],role:["",[i.required,i.maxLength(50)]],phone:["",i.maxLength(20)],isPrimary:[!1]})}addContact(){this.contactsArray.length<this.maxContacts&&this.contactsArray.push(this.createContactForm())}removeContact(m){this.contactsArray.length>1?this.contactsArray.removeAt(m):this.message.warning("\u81F3\u5C11\u9700\u8981\u4FDD\u7559\u4E00\u500B\u806F\u7D61\u4EBA")}loadPartner(m){return z(this,null,function*(){try{this.loading.set(!0);let r=yield this.partnerService.getPartnerById(m);if(r){for(;this.contactsArray.length;)this.contactsArray.removeAt(0);r.contacts.forEach(e=>{this.contactsArray.push(this.fb.group({name:[e.name,[i.required,i.maxLength(50)]],email:[e.email,[i.required,i.email,i.maxLength(100)]],role:[e.role,[i.required,i.maxLength(50)]],phone:[e.phone||"",i.maxLength(20)],isPrimary:[e.isPrimary]}))}),this.form.patchValue({companyName:r.companyName,industry:r.industry,website:r.website||"",address:r.address||""})}else this.message.error("\u627E\u4E0D\u5230\u6307\u5B9A\u7684\u5408\u4F5C\u5925\u4F34"),this.router.navigate(["/business-partners"])}catch(r){console.error("Load partner error:",r),this.message.error("\u8F09\u5165\u5408\u4F5C\u5925\u4F34\u8CC7\u6599\u5931\u6557"),this.router.navigate(["/business-partners"])}finally{this.loading.set(!1)}})}onSubmit(){return z(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.message.warning("\u8ACB\u6AA2\u67E5\u8868\u55AE\u5167\u5BB9\u4E26\u4FEE\u6B63\u932F\u8AA4");return}let m=this.form.value.contacts||[];!m.some(e=>e.isPrimary)&&m.length>0&&this.contactsArray.at(0).patchValue({isPrimary:!0}),this.loading.set(!0);try{let e=this.form.value;this.isEdit()?(yield this.partnerService.updatePartner(this.partnerId(),{companyName:e.companyName,industry:e.industry,website:e.website||void 0,address:e.address||void 0,contacts:e.contacts}),this.message.success("\u5408\u4F5C\u5925\u4F34\u5DF2\u6210\u529F\u66F4\u65B0")):(yield this.partnerService.createPartner({companyName:e.companyName,industry:e.industry,website:e.website||void 0,address:e.address||void 0,contacts:e.contacts}),this.message.success("\u5408\u4F5C\u5925\u4F34\u5DF2\u6210\u529F\u5EFA\u7ACB")),this.router.navigate(["/business-partners"])}catch(e){console.error("Save partner error:",e),this.message.error(this.isEdit()?"\u66F4\u65B0\u5408\u4F5C\u5925\u4F34\u5931\u6557":"\u5EFA\u7ACB\u5408\u4F5C\u5925\u4F34\u5931\u6557")}finally{this.loading.set(!1)}})}cancel(){this.router.navigate(["/business-partners"])}getContactsErrorTip(){return this.form.get("contacts")?.hasError("required")?"\u81F3\u5C11\u9700\u8981\u4E00\u500B\u806F\u7D61\u4EBA":""}};p.\u0275fac=function(r){return new(r||p)(c(Y),c(ye),c(I),c(M),c(O))},p.\u0275cmp=E({type:p,selectors:[["app-partner-form"]],decls:49,vars:14,consts:[["contactCardExtra",""],[3,"nzTitle"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzRequired",""],["nzErrorTip","\u8ACB\u8F38\u5165\u516C\u53F8\u540D\u7A31"],["nz-input","","formControlName","companyName","placeholder","\u8ACB\u8F38\u5165\u516C\u53F8\u540D\u7A31","maxlength","100"],["nzErrorTip","\u8ACB\u9078\u64C7\u884C\u696D\u985E\u5225"],["formControlName","industry","nzPlaceHolder","\u8ACB\u9078\u64C7\u884C\u696D\u985E\u5225","nzShowSearch",""],[3,"nzValue","nzLabel"],["nz-input","","formControlName","website","placeholder","https://example.com","type","url"],["nz-input","","formControlName","address","rows","3","placeholder","\u8ACB\u8F38\u5165\u516C\u53F8\u5730\u5740","maxlength","500"],["nzText","\u806F\u7D61\u4EBA\u8CC7\u8A0A"],[3,"nzErrorTip"],["formArrayName","contacts",1,"space-y-4"],["nzSize","small",1,"contact-card",3,"formGroupName","nzTitle","nzExtra"],["nz-button","","nzType","dashed","type","button",1,"w-full","mt-4",3,"click","disabled"],["nzType","plus"],[1,"mt-6"],[1,"flex","gap-4"],["nz-button","","nzType","primary","type","submit",1,"min-w-24",3,"nzLoading","disabled"],["nz-button","","type","button",3,"click","disabled"],["nzErrorTip","\u8ACB\u8F38\u5165\u806F\u7D61\u4EBA\u59D3\u540D"],["nz-input","","formControlName","name","placeholder","\u8ACB\u8F38\u5165\u59D3\u540D","maxlength","50"],["nzErrorTip","\u8ACB\u8F38\u5165\u8077\u4F4D"],["nz-input","","formControlName","role","placeholder","\u8ACB\u8F38\u5165\u8077\u4F4D","maxlength","50"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u96FB\u5B50\u90F5\u4EF6"],["nz-input","","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u96FB\u5B50\u90F5\u4EF6","type","email","maxlength","100"],["nz-input","","formControlName","phone","placeholder","\u8ACB\u8F38\u5165\u96FB\u8A71\u865F\u78BC","maxlength","20"],[1,"mt-4"],["nz-checkbox","","formControlName","isPrimary"],["nz-button","","nzType","text","nzDanger","","nzSize","small","type","button"],["nz-button","","nzType","text","nzDanger","","nzSize","small","type","button",3,"click"],["nzType","delete"]],template:function(r,e){r&1&&(t(0,"nz-card",1)(1,"form",2),f("ngSubmit",function(){return e.onSubmit()}),t(2,"div",3)(3,"div",4)(4,"nz-form-item")(5,"nz-form-label",5),u(6,"\u516C\u53F8\u540D\u7A31"),n(),t(7,"nz-form-control",6),s(8,"input",7),n()()(),t(9,"div",4)(10,"nz-form-item")(11,"nz-form-label",5),u(12,"\u884C\u696D\u985E\u5225"),n(),t(13,"nz-form-control",8)(14,"nz-select",9),g(15,be,1,2,"nz-option",10,A),n()()()()(),t(17,"div",3)(18,"div",4)(19,"nz-form-item")(20,"nz-form-label"),u(21,"\u7DB2\u7AD9"),n(),t(22,"nz-form-control"),s(23,"input",11),n()()(),t(24,"div",4)(25,"nz-form-item")(26,"nz-form-label"),u(27,"\u5730\u5740"),n(),t(28,"nz-form-control")(29,"textarea",12),u(30,"                "),n()()()()(),s(31,"nz-divider",13),t(32,"nz-form-item")(33,"nz-form-label",5),u(34,"\u806F\u7D61\u4EBA"),n(),t(35,"nz-form-control",14)(36,"div",15),g(37,Ne,32,9,"nz-card",16,x),n(),t(39,"button",17),f("click",function(){return e.addContact()}),s(40,"nz-icon",18),u(41," \u65B0\u589E\u806F\u7D61\u4EBA "),n()()(),t(42,"nz-form-item",19)(43,"nz-form-control")(44,"div",20)(45,"button",21),u(46),n(),t(47,"button",22),f("click",function(){return e.cancel()}),u(48," \u53D6\u6D88 "),n()()()()()()),r&2&&(a("nzTitle",e.isEdit()?"\u7DE8\u8F2F\u5408\u4F5C\u5925\u4F34":"\u65B0\u589E\u5408\u4F5C\u5925\u4F34"),o(),a("formGroup",e.form),o(),a("nzGutter",16),o(),a("nzSpan",12),o(6),a("nzSpan",12),o(6),v(e.industries),o(2),a("nzGutter",16),o(),a("nzSpan",12),o(6),a("nzSpan",12),o(11),a("nzErrorTip",e.getContactsErrorTip()),o(2),v(e.contactsArray.controls),o(2),a("disabled",e.contactsArray.length>=e.maxContacts),o(6),a("nzLoading",e.loading())("disabled",e.form.invalid),o(),P(" ",e.isEdit()?"\u66F4\u65B0":"\u5EFA\u7ACB"," "),o(),a("disabled",e.loading()))},dependencies:[w,Z,U,j,$,H,X,W,Q,J,K,ge,Ce,he,le,se,de,pe,ze,fe,ue,me,ae,ie,oe,q,R,G,V,te,ee,k,L,ce,ne,re],styles:[".contact-card[_ngcontent-%COMP%]{border:1px solid #d9d9d9;border-radius:6px}.space-y-4[_ngcontent-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-top:1rem}.min-w-24[_ngcontent-%COMP%]{min-width:6rem}"],changeDetection:0});var Fe=p;export{Fe as a};
