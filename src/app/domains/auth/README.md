# ğŸ” Firebase Auth èˆ‡ @delon/auth æ•´åˆæ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–¹æ¡ˆå¯¦ç¾äº† Firebase Authentication èˆ‡ @delon/auth çš„ç„¡ç¸«æ•´åˆï¼Œæä¾›å¤šç¨®èªè­‰æ–¹å¼ï¼ŒåŒæ™‚ä¿æŒèˆ‡ç¾æœ‰ç³»çµ±çš„å®Œå…¨å…¼å®¹æ€§ã€‚

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### æ ¸å¿ƒåŸå‰‡
- **ä¿æŒ @delon/auth ä½œç‚ºä¸»è¦èªè­‰ç®¡ç†å™¨** - ç¢ºä¿èˆ‡ç¾æœ‰ç³»çµ±çš„å…¼å®¹æ€§
- **ä½¿ç”¨ Firebase Auth ä½œç‚ºèªè­‰æä¾›è€…** - æä¾›çœŸå¯¦çš„ç”¨æˆ¶èªè­‰æœå‹™
- **æ©‹æ¥æœå‹™æ¨¡å¼** - å°‡ Firebase Auth çµæœè½‰æ›ç‚º @delon/auth æ ¼å¼
- **æ¼¸é€²å¼é·ç§»** - æ”¯æ´ç¾æœ‰ç®¡ç†å“¡å¸³è™Ÿï¼ŒåŒæ™‚æ·»åŠ  Firebase èªè­‰

### æ¶æ§‹å±¤æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           EnhancedLoginComponent                        â”‚â”‚
â”‚  â”‚  â€¢ éƒµç®±å¯†ç¢¼ç™»å…¥  â€¢ Google ç™»å…¥  â€¢ ç®¡ç†å“¡å¿«é€Ÿç™»å…¥          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              AuthBridgeService                          â”‚â”‚
â”‚  â”‚  â€¢ Firebase Auth â†” @delon/auth è½‰æ›                    â”‚â”‚
â”‚  â”‚  â€¢ çµ±ä¸€èªè­‰ä»‹é¢                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                LoginUseCase                             â”‚â”‚
â”‚  â”‚  â€¢ ç™»å…¥æ¥­å‹™é‚è¼¯å”èª¿                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Infrastructure Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚           FirebaseAuthInterceptor                       â”‚â”‚
â”‚  â”‚  â€¢ æ””æˆª /login/account è«‹æ±‚                             â”‚â”‚
â”‚  â”‚  â€¢ ä½¿ç”¨ Firebase Auth è™•ç†èªè­‰                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                 User Entity                             â”‚â”‚
â”‚  â”‚  â€¢ ç”¨æˆ¶æ¥­å‹™é‚è¼¯  â€¢ Firebase â†” @delon è½‰æ›               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚            Value Objects                                â”‚â”‚
â”‚  â”‚  â€¢ UserId  â€¢ Email  â€¢ UserProfile                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. ç®¡ç†å“¡ç™»å…¥ï¼ˆå‘å¾Œå…¼å®¹ï¼‰

```typescript
// åœ¨ç™»å…¥é é¢ä½¿ç”¨
email: 'admin@company.com'
password: '123456'
```

é€™çµ„å¸³è™Ÿå¯†ç¢¼åœ¨é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒéƒ½å¯ä»¥ä½¿ç”¨ï¼Œç„¡éœ€é¡å¤–é…ç½®ã€‚

### 2. Firebase éƒµç®±ç™»å…¥

```typescript
// ç”¨æˆ¶éœ€è¦å…ˆåœ¨ Firebase Console ä¸­å‰µå»ºå¸³è™Ÿ
email: 'user@example.com'
password: 'userPassword'
```

### 3. Google ç™»å…¥

é»æ“Š "Sign in with Google" æŒ‰éˆ•ï¼Œä½¿ç”¨ Google å¸³è™Ÿç™»å…¥ã€‚

## ğŸ”§ é…ç½®èªªæ˜

### Firebase é…ç½®

Firebase é…ç½®å·²åœ¨ `app.config.ts` ä¸­å®Œæˆï¼š

```typescript
provideFirebaseApp(() => initializeApp({
  projectId: "ng-acc",
  appId: "1:289956121604:web:4dd9d608a2db962aeaf951",
  // ... å…¶ä»–é…ç½®
})),
provideAuth(() => getAuth()),
```

### ç’°å¢ƒé…ç½®

#### é–‹ç™¼ç’°å¢ƒ (`environment.ts`)
```typescript
export const environment = {
  production: false,
  // ... å…¶ä»–é…ç½®
  providers: [provideMockConfig({ data: MOCKDATA })],
  interceptorFns: [mockInterceptor]
};
```

#### ç”Ÿç”¢ç’°å¢ƒ (`environment.prod.ts`)
```typescript
export const environment = {
  production: true,
  // ... å…¶ä»–é…ç½®
  interceptorFns: [firebaseAuthInterceptor]
};
```

## ğŸ“± çµ„ä»¶ä½¿ç”¨

### æ›¿æ›ç¾æœ‰ç™»å…¥çµ„ä»¶

```typescript
// åœ¨è·¯ç”±é…ç½®ä¸­
{
  path: 'login',
  component: EnhancedLoginComponent // æ›¿æ›åŸæœ‰çš„ UserLoginComponent
}
```

### åœ¨å…¶ä»–çµ„ä»¶ä¸­ä½¿ç”¨èªè­‰æœå‹™

```typescript
import { AuthBridgeService } from '@app/domains/auth/application/services/auth-bridge.service';

@Component({...})
export class MyComponent {
  private authBridge = inject(AuthBridgeService);

  // ç²å–ç•¶å‰ç”¨æˆ¶
  getCurrentUser() {
    return this.authBridge.getCurrentUser();
  }

  // ç›£è½èªè­‰ç‹€æ…‹
  ngOnInit() {
    this.authBridge.authState$.subscribe(user => {
      console.log('User state changed:', user);
    });
  }

  // ç™»å‡º
  logout() {
    this.authBridge.signOut().subscribe(() => {
      console.log('Logged out');
    });
  }
}
```

## ğŸ”„ é·ç§»æŒ‡å—

### å¾ Mock èªè­‰é·ç§»

1. **ä¿æŒç¾æœ‰åŠŸèƒ½**ï¼šç®¡ç†å“¡å¸³è™Ÿ `admin@company.com/123456` ç¹¼çºŒå¯ç”¨
2. **æ·»åŠ  Firebase ç”¨æˆ¶**ï¼šåœ¨ Firebase Console ä¸­å‰µå»ºæ–°ç”¨æˆ¶
3. **æ¼¸é€²å¼æ›¿æ›**ï¼šé€æ­¥å°‡ç™»å…¥é é¢æ›¿æ›ç‚º `EnhancedLoginComponent`

### é·ç§»æ­¥é©Ÿ

1. **æ›´æ–°è·¯ç”±é…ç½®**
```typescript
// routes.ts
{
  path: 'login',
  component: EnhancedLoginComponent
}
```

2. **æ›´æ–°ç’°å¢ƒé…ç½®**ï¼ˆå·²å®Œæˆï¼‰
3. **æ¸¬è©¦èªè­‰åŠŸèƒ½**
4. **éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ**

## ğŸ›¡ï¸ å®‰å…¨è€ƒæ…®

### Token ç®¡ç†
- Firebase ID Token è‡ªå‹•ç®¡ç†éæœŸæ™‚é–“
- @delon/auth Token è¨­ç½® 24 å°æ™‚éæœŸ
- æ”¯æ´è‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶

### ç®¡ç†å“¡å¸³è™Ÿå®‰å…¨
```typescript
// å»ºè­°åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ä¿®æ”¹ç®¡ç†å“¡å¯†ç¢¼
const DEFAULT_AUTH_CONFIG = {
  adminEmail: 'admin@yourcompany.com',
  adminPassword: 'your-secure-password'
};
```

## ğŸ§ª æ¸¬è©¦

### å–®å…ƒæ¸¬è©¦ç¯„ä¾‹

```typescript
describe('AuthBridgeService', () => {
  let service: AuthBridgeService;

  beforeEach(() => {
    TestBed.configureTestingModule({
      providers: [AuthBridgeService]
    });
    service = TestBed.inject(AuthBridgeService);
  });

  it('should handle admin login', async () => {
    const result = await service.signInWithEmailPassword(
      'admin@company.com', 
      '123456'
    ).toPromise();
    
    expect(result.msg).toBe('ok');
    expect(result.user.isAdmin).toBe(true);
  });
});
```

## ğŸ“Š ç›£æ§å’Œæ—¥èªŒ

### èªè­‰äº‹ä»¶ç›£æ§

```typescript
// åœ¨ AuthBridgeService ä¸­æ·»åŠ æ—¥èªŒ
signInWithEmailPassword(email: string, password: string) {
  console.log('Login attempt:', { email, timestamp: new Date() });
  
  return from(signInWithEmailAndPassword(this.firebaseAuth, email, password)).pipe(
    tap(result => {
      console.log('Login success:', { email, uid: result.user.uid });
    }),
    catchError(error => {
      console.error('Login failed:', { email, error: error.message });
      throw error;
    })
  );
}
```

## ğŸ”® æœªä¾†æ“´å±•

### è¨ˆåŠƒåŠŸèƒ½
1. **å¤šå› ç´ èªè­‰ (MFA)**
2. **ç¤¾äº¤ç™»å…¥æ“´å±•**ï¼ˆFacebook, GitHub ç­‰ï¼‰
3. **ä¼æ¥­ SSO æ•´åˆ**
4. **ç”¨æˆ¶è§’è‰²ç®¡ç†**
5. **èªè­‰å¯©è¨ˆæ—¥èªŒ**

### æ“´å±•ç¯„ä¾‹

```typescript
// æ·»åŠ  Facebook ç™»å…¥
signInWithFacebook(): Observable<any> {
  const provider = new FacebookAuthProvider();
  return from(signInWithPopup(this.firebaseAuth, provider)).pipe(
    map(credential => {
      const user = User.fromFirebaseUser(credential.user);
      return this.setDelonAuthToken(user);
    })
  );
}
```

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **Firebase é…ç½®éŒ¯èª¤**
   - æª¢æŸ¥ `app.config.ts` ä¸­çš„ Firebase é…ç½®
   - ç¢ºèª Firebase å°ˆæ¡ˆè¨­å®šæ­£ç¢º

2. **Google ç™»å…¥å¤±æ•—**
   - æª¢æŸ¥ Firebase Console ä¸­çš„ Google ç™»å…¥è¨­å®š
   - ç¢ºèªæˆæ¬ŠåŸŸåé…ç½®

3. **ç®¡ç†å“¡å¸³è™Ÿç„¡æ³•ç™»å…¥**
   - æª¢æŸ¥ `AuthBridgeService` ä¸­çš„ç®¡ç†å“¡å¸³è™Ÿé…ç½®
   - ç¢ºèªæ””æˆªå™¨æ­£ç¢ºé…ç½®

### èª¿è©¦æŠ€å·§

```typescript
// å•Ÿç”¨è©³ç´°æ—¥èªŒ
localStorage.setItem('debug', 'auth:*');

// æª¢æŸ¥ @delon/auth token
console.log('Current token:', this.tokenService.get());

// æª¢æŸ¥ Firebase ç”¨æˆ¶ç‹€æ…‹
this.firebaseAuth.onAuthStateChanged(user => {
  console.log('Firebase user:', user);
});
```

## ğŸ“š ç›¸é—œæ–‡æª”

- [Firebase Authentication æ–‡æª”](https://firebase.google.com/docs/auth)
- [@delon/auth æ–‡æª”](https://ng-alain.com/auth)
- [AngularFire æ–‡æª”](https://github.com/angular/angularfire)
- [å°ˆæ¡ˆ DDD æ¶æ§‹æŒ‡å—](../../../docs/DDD_DEVELOPMENT_STANDARDS.md)

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€å¾Œæ›´æ–°**: 2024å¹´12æœˆ  
**ç¶­è­·è€…**: NG-AC Development Team