import{a as At}from"./chunk-AO65FQTJ.js";import{$ as vt,A as mt,Ab as Jt,Ba as Ct,C as dt,Cb as Gt,Da as Dt,F as ut,Ga as Mt,H as ft,J as ht,Ka as It,Pa as Nt,Q as gt,Ra as Et,Ta as wt,Ua as Pt,Va as C,Ya as jt,Z as Tt,Za as kt,_a as D,cb as Ft,eb as Rt,fa as xt,hb as Bt,ia as zt,kb as $t,mb as Wt,pb as Lt,qa as St,sa as yt,va as _t,w as pt,x as bt,yb as Ut}from"./chunk-R2TQUHLO.js";import{$ as j,Ea as b,F as P,Gc as J,Hb as A,Hc as G,Ic as H,Jc as V,Kh as lt,La as z,Mb as S,Mc as q,Md as tt,Nb as W,Nd as et,Pa as B,Pc as K,Ra as u,Uh as ct,V as v,d as w,da as x,dg as ot,e as I,eg as y,hb as a,hi as Ot,ia as k,ib as n,ic as L,id as Y,ja as F,jb as s,jh as nt,kb as N,mg as rt,ng as it,qd as Z,rb as $,td as Q,ua as R,ub as O,ud as X,vg as at,wg as _,xb as f,yh as st,zc as U}from"./chunk-GG7EQGVV.js";import{a as g,b as T}from"./chunk-57BLH6QZ.js";function ae(r,t=2){return typeof r=="number"&&(r=r.toFixed(t)),`&yen ${r}`}var l=class l extends Pt{ngOnInit(){console.warn("init test widget")}};l.KEY="test",l.\u0275fac=(()=>{let t;return function(o){return(t||(t=R(l)))(o||l)}})(),l.\u0275cmp=z({type:l,selectors:[["test"]],features:[B],decls:2,vars:6,consts:[[3,"id","schema","ui","showError","error","showTitle"]],template:function(e,o){e&1&&(n(0,"sf-item-wrap",0),S(1," test widget "),s()),e&2&&a("id",o.id)("schema",o.schema)("ui",o.ui)("showError",o.showError)("error",o.error)("showTitle",o.schema.title)},dependencies:[C,wt],encapsulation:2,changeDetection:0});var h=l;var be=[{KEY:h.KEY,type:h}];var de=[];var fe=[];var Vt=class{constructor(t){this.props=Object.freeze(t)}equals(t){return t==null?!1:this===t?!0:JSON.stringify(this.props)===JSON.stringify(t.props)}};var qt=class{constructor(){this.occurredOn=new Date,this.eventId=this.generateEventId()}generateEventId(){return`${this.constructor.name}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}};var Kt=class{constructor(t){this._domainEvents=[];this.id=t}addDomainEvent(t){this._domainEvents.push(t)}clearDomainEvents(){this._domainEvents=[]}get domainEvents(){return[...this._domainEvents]}};var Yt=[C,Mt,$t,Bt,Rt,et,tt,At];var Zt=[_,Tt,It,dt,ht,Jt,xt,y,mt,Wt,nt,St,st,D,Ct,Dt,_t,yt,ft,Ft,Ut,Et,ut,Nt,Lt,zt,Ot,gt,Gt,vt,rt];var go=[pt,bt,X,Z,H,lt,q,ct,V,...Yt,...Zt];var p=class p{constructor(){this.tabsSubject=new I([]);this.activeTabSubject=new I(null);this.loadTabs()}get tabs$(){return this.tabsSubject.asObservable()}get activeTab$(){return this.activeTabSubject.asObservable()}get tabs(){return this.tabsSubject.value}get activeTab(){return this.activeTabSubject.value}createTab(t,e,o,i=!0){let c=this.tabs.find(Xt=>Xt.url===e);if(c)return this.activateTab(c.id),c;let d={id:`tab_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,title:t,url:e,icon:o,closable:i,active:!1},E=[...this.tabs,d];return this.tabsSubject.next(E),this.saveTabs(E),this.activateTab(d.id),d}activateTab(t){let e=this.tabs.map(o=>T(g({},o),{active:o.id===t}));this.tabsSubject.next(e),this.activeTabSubject.next(e.find(o=>o.active)||null),this.saveTabs(e)}closeTab(t){let e=this.tabs.filter(i=>i.id!==t);if(e.length===0){this.tabsSubject.next([]),this.activeTabSubject.next(null),this.saveTabs([]);return}if(this.activeTab?.id===t){let i=e[0];e[0]=T(g({},i),{active:!0})}this.tabsSubject.next(e),this.activeTabSubject.next(e.find(i=>i.active)||null),this.saveTabs(e)}loadTabs(){try{let t=localStorage.getItem("ng_ac_tabs");if(t){let e=JSON.parse(t);this.tabsSubject.next(e),this.activeTabSubject.next(e.find(o=>o.active)||null)}}catch(t){console.error("Error loading tabs:",t)}}saveTabs(t){try{localStorage.setItem("ng_ac_tabs",JSON.stringify(t))}catch(e){console.error("Error saving tabs:",e)}}getRouteData(t){return{"/dashboard":{title:"\u5100\u8868\u677F",icon:"dashboard",closable:!0},"/dashboard/v1":{title:"\u5100\u8868\u677F",icon:"dashboard",closable:!0},"/dashboard/analysis":{title:"\u5206\u6790",icon:"bar-chart",closable:!0},"/dashboard/monitor":{title:"\u76E3\u63A7",icon:"monitor",closable:!0},"/dashboard/workplace":{title:"\u5DE5\u4F5C\u53F0",icon:"desktop",closable:!0},"/dashboard/contract-management":{title:"\u5408\u7D04\u7BA1\u7406",icon:"file-text",closable:!0},"/dashboard/task-management":{title:"\u4EFB\u52D9\u7BA1\u7406",icon:"check-square",closable:!0},"/dashboard/budget-management":{title:"\u9810\u7B97\u7BA1\u7406",icon:"dollar",closable:!0},"/dashboard/business-partner":{title:"\u5408\u4F5C\u5925\u4F34",icon:"user",closable:!0}}[t]||{title:"\u65B0\u9801\u9762",closable:!0}}updateAllTabsClosable(){let t=this.tabs.map(e=>{let o=this.getRouteData(e.url);return T(g({},e),{closable:o?.closable??!0})});this.tabsSubject.next(t),this.saveTabs(t)}};p.\u0275fac=function(e){return new(e||p)},p.\u0275prov=j({token:p,factory:p.\u0275fac,providedIn:"root"});var M=p;function ee(r,t){if(r&1&&N(0,"i",8),r&2){let e=f(2).$implicit;a("nzType",e.icon)}}function oe(r,t){if(r&1){let e=$();n(0,"button",9),O("click",function(i){k(e);let c=f(2).$implicit,d=f();return F(d.onCustomTabClose(i,c))}),N(1,"i",10),s()}}function re(r,t){if(r&1&&(n(0,"div",5),u(1,ee,1,1,"i",6),n(2,"span"),S(3),s(),u(4,oe,2,0,"button",7),s()),r&2){let e=f().$implicit;b(),a("ngIf",e.icon),b(2),W(e.title),b(),a("ngIf",e.closable)}}function ie(r,t){if(r&1&&(n(0,"nz-tab",4),u(1,re,5,3,"ng-template",null,0,L),s()),r&2){let e=A(2);a("nzTitle",e)("nzClosable",!1)}}var m=class m{constructor(){this.tabs=[];this.destroy$=new w;this.tabService=x(M);this.router=x(Q);this.cdr=x(U)}ngOnInit(){this.tabService.updateAllTabsClosable(),this.subscribeToTabs(),this.subscribeToRouter()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get activeTabIndex(){if(!this.activeTabId)return 0;let t=this.tabs.findIndex(e=>e.id===this.activeTabId);return t>=0?t:0}trackByTabId(t,e){return e.id}onTabChange(t){let e=this.tabs[t];e&&(this.tabService.activateTab(e.id),this.router.navigateByUrl(e.url))}onTabClose(t){this.tabService.closeTab(t.id);let e=this.tabs.find(o=>o.active);e&&this.router.navigateByUrl(e.url)}onCustomTabClose(t,e){t.stopPropagation(),this.onTabClose(e)}subscribeToTabs(){this.tabService.tabs$.pipe(v(this.destroy$)).subscribe(t=>{this.tabs=t,this.cdr.markForCheck()}),this.tabService.activeTab$.pipe(v(this.destroy$)).subscribe(t=>{this.activeTabId=t?.id,this.cdr.markForCheck()})}subscribeToRouter(){this.router.events.pipe(v(this.destroy$),P(t=>t instanceof Y)).subscribe(()=>{this.handleRouteChange()})}handleRouteChange(){let t=this.router.url,e=this.tabs.find(o=>o.url===t);if(e)this.tabService.activateTab(e.id);else{let o=this.tabService.getRouteData(t);o&&this.tabService.createTab(o.title,t,o.icon,o.closable)}}};m.\u0275fac=function(e){return new(e||m)},m.\u0275cmp=z({type:m,selectors:[["app-tab-bar"]],decls:3,vars:6,consts:[["tabTitle",""],[1,"tab-bar"],[3,"nzSelectedIndexChange","nzSelectedIndex","nzType","nzAnimated","nzTabBarGutter"],[3,"nzTitle","nzClosable",4,"ngFor","ngForOf","ngForTrackBy"],[3,"nzTitle","nzClosable"],[1,"tab-title"],["nz-icon","",3,"nzType",4,"ngIf"],["class","custom-close-btn","nz-button","","nzType","text","nzSize","small","title","\u95DC\u9589\u6A19\u7C64",3,"click",4,"ngIf"],["nz-icon","",3,"nzType"],["nz-button","","nzType","text","nzSize","small","title","\u95DC\u9589\u6A19\u7C64",1,"custom-close-btn",3,"click"],["nz-icon","","nzType","close","nzTheme","outline"]],template:function(e,o){e&1&&(n(0,"div",1)(1,"nz-tabset",2),O("nzSelectedIndexChange",function(c){return o.onTabChange(c)}),u(2,ie,3,2,"nz-tab",3),s()()),e&2&&(b(),a("nzSelectedIndex",o.activeTabIndex)("nzType","card")("nzAnimated",!1)("nzTabBarGutter",0),b(),a("ngForOf",o.tabs)("ngForTrackBy",o.trackByTabId))},dependencies:[K,J,G,D,kt,jt,y,ot,_,at,it],styles:[".tab-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;min-width:0;max-width:200px}.tab-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;min-width:0}[_nghost-%COMP%]     .ant-tabs-content-holder{display:none}[_nghost-%COMP%]     .ant-tabs-tab-remove{display:flex!important;align-items:center;justify-content:center;width:16px;height:16px;margin-left:8px;border-radius:2px;transition:all .2s}[_nghost-%COMP%]     .ant-tabs-tab-remove:hover{background-color:#0000000f;color:#ff4d4f}[_nghost-%COMP%]     .ant-tabs-tab-remove .anticon{font-size:12px}[_nghost-%COMP%]     .ant-tabs-tab[data-node-key] .ant-tabs-tab-remove{opacity:1;visibility:visible}.custom-close-btn[_ngcontent-%COMP%]{display:flex!important;align-items:center;justify-content:center;width:16px;height:16px;min-width:16px;max-width:16px;padding:0;margin-left:8px;border:none;border-radius:2px;background:transparent;color:#00000073;transition:all .2s;flex-shrink:0;z-index:10}.custom-close-btn[_ngcontent-%COMP%]:hover{background-color:#0000000f;color:#ff4d4f}.custom-close-btn[_ngcontent-%COMP%]   .anticon[_ngcontent-%COMP%]{font-size:10px}"],changeDetection:0});var Qt=m;export{ae as a,Vt as b,qt as c,Kt as d,be as e,de as f,fe as g,Qt as h};
